#!/bin/bash

# master-file

java_prefix="@DESTDIR@/opt/java"

echo "Search latest linux JDK6 bin file..."
    index=http://download.java.net/jdk6/latest_binaries/
    latest_file=`wget -qO- $index | grep lin32JDKbin | grep -o -m1 'jdk-.*.bin' `
    if [ -z "$latest_file" ]; then
        echo "Not found. "
        exit 1
    fi

url=`urljoin "$index" "$latest_file"`
echo "Download $url..."
    if ! file=`wgetc -m755 "$url"`; then
        echo "Failed to download. "
    fi

javahome=`grep -a -m1 javahome= $file`
javahome=${javahome#*=}
instdir="$java_prefix/$javahome"

echo "Install $file to $instdir..."

    install -d -m 755 -o root -g dev $java_prefix
    cd "$java_prefix"

    "$file"

echo "Link jdk-6 to $javahome"
    ln -snf $javahome jdk-6

echo "$instdir" >"@DESTDIR@@pkgdatadir@/instdir"
