#!/bin/sh

# master-file

domaindir=/node/domains/seccaj

if [ ! -d $domaindir/applications ]; then

    echo "Create seccaj domain"
    echo "    (Purge $domaindir if necessary)"

    if [ -d $domaindir ]; then
        echo "    Backup existing domain data $domaindir"
        mv $domaindir $domaindir.bak
    fi

    echox sudo -uappserv /opt/java/glassfish/bin/asadmin \
        create-domain \
            --savelogin \
            --domaindir /node/domains \
            --adminport 1090 \
            seccaj

    if [ -d $domaindir.bak ]; then
        echo "    Overwrite with the old domain data"
        cp -RT $domaindir.bak $domaindir
        rm -fr $domaindir.bak
    fi

    mv -f ~appserv/.asadminpass ~appserv/.seccaj.asadminpass

fi

cd /opt/java/glassfish/glassfish/domains
    sudo -uappserv ln -snf $domaindir .

echo "Setup sysv init"
    update-rc.d seccajctl defaults

echo "Start seccaj..."
    # initctl start seccaj
    /etc/init.d/seccajctl start

