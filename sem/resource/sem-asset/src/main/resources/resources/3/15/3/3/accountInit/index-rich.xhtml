<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:pc="http://bee32.com/plover/core"
    xmlns:sem="http://bee32.com/sem/functions" xmlns:p="http://primefaces.org/ui"
    xmlns:t="http://myfaces.apache.org/tomahawk">
<ui:composition template="/template/primefaces.xhtml">

    <ui:define name="title">资产初始化</ui:define>

    <ui:define name="content">

		<h:form id="mainForm">
            <p:commandButton
                update="itemForm:itemPanel"
                value="新增" onclick="itemDialog.show()"
                actionListener="#{accountInitAdminBean.newItem}"/>

            <p:dataTable id="init" var="item"
                    value="#{accountInitAdminBean.items}" resizableColumns="true"
                    rowIndexVar="rowIndex">

                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="序号" />
                        </f:facet>
                        <h:outputText value="#{rowIndex + 1}" />
                    </p:column>

                    <p:column headerText="会计科目">
                        <h:outputText value="#{item.subject.label}" />
                    </p:column>

                    <p:column headerText="二级科目">
                        <h:outputText value="#{item.party.displayName}" />
                    </p:column>

                    <p:column headerText="借贷方向">
                        <p:selectOneMenu
                            value="#{item.debitSide}" disabled="#{true}"
                            style="width:200px;">
                            <f:selectItem itemValue="true"
                                itemLabel="借方" />
                            <f:selectItem itemValue="false"
                                itemLabel="贷方" />
                        </p:selectOneMenu>
                    </p:column>

                    <p:column headerText="币种">
                        <h:outputText value="#{item.valueCurrency}" />
                    </p:column>

                    <p:column headerText="金额">
                        <h:outputText value="#{item.valueDigit}" />
                    </p:column>

                    <p:column>
                        <f:facet name="header">操作</f:facet>
                        <t:panelGroup>
                            <p:commandLink
                                update="itemForm:itemPanel"
                                actionListener="#{accountInitAdminBean.modifyItem}"
                                oncomplete="itemDialog.show()" value="修改">
                                <f:setPropertyActionListener value="#{item}"
                                    target="#{accountInitAdminBean.accountTicketItem}" />
                            </p:commandLink>
                            <p:spacer width="10" />
                            <p:commandLink
                                oncomplete="deleteItemConfirmDialog.show()" value="删除">
                                <f:setPropertyActionListener value="#{item}"
                                    target="#{accountInitAdminBean.accountTicketItem}" />
                            </p:commandLink>
                        </t:panelGroup>
                    </p:column>
                </p:dataTable>
		</h:form>

        <h:form id="itemForm">
            <p:dialog header="凭证项目编辑" widgetVar="itemDialog" modal="true"
                height="500" width="640">
                <h:panelGroup id="itemPanel">
                    <t:panelGrid columns="4"
                        columnClasses="detail_col_title,detail_col_value,detail_col_title,detail_col_value">

                        <h:outputLabel value="会计科目" />
                        <t:panelGroup colspan="3">
                            <p:inputText id="accountSubject" value="#{accountInitAdminBean.accountTicketItem.subject.label}" readonly="true"/>
                            <p:commandButton value="..." onclick="accountSubjectDialog.show();"/>
                        </t:panelGroup>

                        <h:outputLabel value="二级科目" />
                        <t:panelGroup colspan="3">
                            <p:inputText id="party" value="#{accountInitAdminBean.accountTicketItem.party.name}" readonly="true"/>
                            <p:commandButton value="..." onclick="partyDialog.show();"/>
                        </t:panelGroup>

                        <h:outputLabel value="借贷方向" />
                        <t:panelGroup colspan="3">
                            <p:selectOneMenu value="#{accountInitAdminBean.accountTicketItem.debitSide}" disabled="true" style="width:200px;">
                                <f:selectItem itemValue="true" itemLabel="借方" />
                                <f:selectItem itemValue="false" itemLabel="贷方" />
                            </p:selectOneMenu>
                        </t:panelGroup>


                        <h:outputLabel value="金额" />
                        <p:inputText value="#{accountInitAdminBean.accountTicketItem.valueDigit}" />
                        <h:outputLabel value="币种" />
                        <p:selectOneMenu value="#{accountInitAdminBean.accountTicketItem.valueCurrency}" style="width:200px;">
                            <f:selectItem itemValue="" itemLabel="--选择币种--" />
                            <f:selectItems value="#{accountInitAdminBean.currencies}" />
                        </p:selectOneMenu>

                        <h:panelGroup />
                        <t:panelGroup colspan="2">
                            <t:panelGrid columns="2">
                                <p:commandButton value="保存"
                                    actionListener="#{accountInitAdminBean.saveItem}"
                                    oncomplete="itemDialog.hide();" async="true"
                                    update="mainForm" />
                                <p:commandButton value="取消"
                                    oncomplete="itemDialog.hide();" />
                            </t:panelGrid>
                        </t:panelGroup>
                        <h:panelGroup />

                    </t:panelGrid>
                </h:panelGroup>

            </p:dialog>
        </h:form>

        <h:form id="deleteItemConfirmForm">
            <p:confirmDialog message="确定要删除吗?" width="200" header="删除明细条目确认"
                severity="alert" widgetVar="deleteItemConfirmDialog" modal="true">

                <p:commandButton value="确定"
                    update="mainForm"
                    actionListener="#{accountInitAdminBean.deleteItem}"
                    oncomplete="deleteItemConfirmDialog.hide()" />
                <p:commandButton value="取消" onclick="deleteItemConfirmDialog.hide()"
                    type="button" />

            </p:confirmDialog>
        </h:form>

        <h:form id="accountSubjectForm">
            <p:dialog header="选择科目" widgetVar="accountSubjectDialog" modal="true"
                height="500" width="840">
                <h:panelGroup>

                    <h:panelGrid columns="5">
                        <h:outputLabel value="科目代码的全部或部份:" />
                        <p:inputText value="#{accountInitAdminBean.accountSubjectCodePattern}" />
                        <h:outputLabel value="科目名称全部或部份:" />
                        <p:inputText value="#{accountInitAdminBean.accountSubjectNamePattern}" />
                        <p:commandButton value="查找"
                            actionListener="#{accountInitAdminBean.findAccountSubject}" update="accountSubjects"
                            async="true" />
                    </h:panelGrid>
                    <p:dataTable id="accountSubjects" var="accountSubject"
                        value="#{accountInitAdminBean.accountSubjects}" resizableColumns="true"
                        rowIndexVar="rowIndex"
                        scrollable="true" scrollWidth="600" scrollHeight="350">

                        <p:column headerText="序号">
                            <h:outputText value="#{rowIndex + 1}" />
                        </p:column>

                        <p:column headerText="科目编码">
                            <h:outputText value="#{accountSubject.name}" />
                        </p:column>

                        <p:column headerText="科目名称">
                            <h:outputText value="#{accountSubject.label}" />
                        </p:column>

                        <p:column headerText="动作">
                            <p:commandLink
                                oncomplete="accountSubjectDialog.hide()"
                                action="#{accountInitAdminBean.chooseAccountSubject}"
                                update="itemForm:itemPanel" value="挑选">
                                <f:setPropertyActionListener
                                    value="#{accountSubject}"
                                    target="#{accountInitAdminBean.selectedAccountSubject}" />
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                    <p:commandButton value="取消" oncomplete="accountSubjectDialog.hide()" />
                </h:panelGroup>
            </p:dialog>
        </h:form>


        <h:form id="partyForm">
            <p:dialog header="选择客户" widgetVar="partyDialog" modal="true"
                height="500" width="840">
                <h:panelGroup>

                    <h:panelGrid columns="3">
                        <h:outputLabel value="名称全部或部份:" />
                        <p:inputText value="#{accountInitAdminBean.partyPattern}" />
                        <p:commandButton value="查找"
                            actionListener="#{accountInitAdminBean.findParty}" update="parties"
                            async="true" />
                    </h:panelGrid>
                    <p:dataTable id="parties" var="party"
                        value="#{accountInitAdminBean.parties}" resizableColumns="true"
                        rowIndexVar="rowIndex"
                        scrollable="true" scrollWidth="600" scrollHeight="350">

                        <p:column headerText="序号">
                            <h:outputText value="#{rowIndex + 1}" />
                        </p:column>

                        <p:column headerText="名称">
                            <h:outputText value="#{party.name}" />
                        </p:column>

                        <p:column headerText="标签">
                            <p:dataList value="#{party.tags}" var="tag" type="definition">
                                <f:facet name="description">
                                    <h:outputText value="#{tag.label}"/>
                                </f:facet>
                            </p:dataList>
                        </p:column>

                        <p:column headerText="成立日期/生日">
                            <h:outputText value="#{party.birthday}">
                                <f:convertDateTime pattern="yyyy-MM-dd"
                                    timeZone="Asia/Shanghai" />
                            </h:outputText>
                        </p:column>

                        <p:column headerText="税务登记号/证件号">
                            <h:outputText value="#{party.sid}" />
                        </p:column>

                        <p:column headerText="创建日期">
                            <h:outputText value="#{party.createdDate}">
                                <f:convertDateTime pattern="yyyy-MM-dd"
                                    timeZone="Asia/Shanghai" />
                            </h:outputText>
                        </p:column>
                        <p:column headerText="动作">
                            <p:commandLink
                                oncomplete="partyDialog.hide()"
                                action="#{accountInitAdminBean.chooseParty}"
                                update="itemForm:party" value="挑选">
                                <f:setPropertyActionListener
                                    value="#{party}"
                                    target="#{accountInitAdminBean.selectedParty}" />
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                    <p:commandButton value="取消" oncomplete="partyDialog.hide();" />
                </h:panelGroup>
            </p:dialog>
        </h:form>
	</ui:define>
</ui:composition>
</html>
