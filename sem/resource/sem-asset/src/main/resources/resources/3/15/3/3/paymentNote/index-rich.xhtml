<ui:composition template="/template/scroll-verifiable-entity.xhtml" xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk"
    xmlns:sem="http://java.sun.com/jsf/composite/3/15">

    <ui:param name="title" value="付款单" />
    <ui:param name="bean" value="#{paymentNoteAdminBean}" />
    <ui:param name="obj" value="#{bean.openedObject}" />
    <ui:param name="monetary" value="#{monetaryDictsBean}" />

    <ui:define name="toolbar.left">
        <p:separator />
        <p:commandButton id="pay" value="付款" update=":payForm:whoPay" actionListener="#{bean.showPayDialog}"
            onclick="waitbox.show();" oncomplete="waitbox.hide();payDialog.show();" disabled="${bean.editing or not bean.selected or not bean.selectionEditable}" />
        <p:separator />
    </ui:define>


    <ui:define name="editDialogContent">
        <p:panel header="付款单管理">
            <t:panelGrid id="info" columns="4">
                <h:outputText value="创建时间:" />
                <h:outputText value="#{obj.createdDate}">
                    <f:convertDateTime pattern="yyyy-MM-dd" timeZone="Asia/Shanghai" />
                </h:outputText>
                <h:outputText value="所有者:" />
                <p:inputText value="#{obj.owner.displayName}" readonly="true" style="width: 15em;" label="经办人" />

                <h:outputText value="经办人:" />
                <t:panelGroup colspan="3">
                    <p:inputText id="operator" readonly="true" value="#{obj.operator.displayName}" label="经办人" />
                    <p:commandButton value="..." update=":choosePersonDialog:form" onclick="waitbox.show()"
                        oncomplete="waitbox.hide();choosePersonDialog.show()">
                        <f:setPropertyActionListener target="#{choosePersonDialogBean.employee}"
                            value="true" />
                    </p:commandButton>
                </t:panelGroup>

                <h:outputText value="时间:" />
                <t:panelGroup colspan="3">
                    <p:calendar id="beginTime" label="时间" navigator="true" locale="zh_CN" pattern="yyyy-MM-dd"
                        value="#{obj.beginTime}" showOn="button" />
                </t:panelGroup>

                <h:outputText value="业务对象:" styleClass="e-link" onclick="#{obj.party.clickAction}" />
                <t:panelGroup colspan="3">
                    <p:inputText id="party" label="业务对象" value="#{obj.party.displayName}" readonly="true"
                        style="width:30em;" />
                    <p:commandButton value="..." oncomplete="choosePartyDialog.show()" disabled="#{not bean.editing}" />
                </t:panelGroup>

                <h:outputLabel value="金额:" />
                <p:inputText value="#{obj.value.value}" readonly="#{not bean.editing}" style="width: 15em;"
                    label="金额" />
                <h:outputLabel value="币种" />
                <p:selectOneMenu value="#{obj.value.currencyCode}" readonly="#{not bean.editing}" style="width: 15em;"
                    label="币种">
                    <f:selectItem itemValue="" itemLabel="--选择币种--" />
                    <f:selectItems value="#{monetary.currencySelectItems}" />
                </p:selectOneMenu>

                <h:outputText value="摘要:" />
                <t:panelGroup colspan="3">
                    <p:inputText value="#{obj.description}" readonly="#{not bean.editing}" style="width: 35em"
                        label="摘要" />
                </t:panelGroup>

                <h:outputText value="业务详细:" />
                <t:panelGroup colspan="3">
                    <p:inputTextarea style="width: 35em; height: 15em;" value="#{obj.text}" readonly="#{not bean.editing}"
                        label="业务详细" />
                </t:panelGroup>

                <h:outputText value="付款人:" />
                <t:panelGroup colspan="3">
                    <p:inputText id="whoPay" readonly="true" value="#{obj.whoPay.displayName}" label="付款人" />
                </t:panelGroup>
            </t:panelGrid>
        </p:panel>
    </ui:define>

    <ui:define name="dialogs">
        <sem:choosePartyDialog id="c_party" header="选择业务对象" target="#{obj.party}" update=":editDialog:form:party" />
        <sem:choosePersonDialog id="choosePersonDialog" var="choosePersonDialog" target="#{obj.operator}"
            update=":editDialog:form:operator" />
        <sem:choosePersonDialog id="chooseWhoPayDialog" var="chooseWhoPayDialog" target="#{bean.whoPay}"
            update=":payForm:whoPay" />

        <p:dialog id="d_payDialog" header="付款对话框" widgetVar="payDialog" modal="true">
            <h:form id="payForm">
                <t:panelGrid columns="3">
                    <h:outputText value="付款人" styleClass="e-link" onclick="#{bean.whoPay.clickAction}" />
                    <p:inputText id="whoPay" readonly="true" value="#{bean.whoPay.displayName}" label="付款人" />
                    <p:commandButton value="..." update=":chooseWhoPayDialog:form" onclick="waitbox.show()"
                        oncomplete="waitbox.hide();chooseWhoPayDialog.show()">
                        <f:setPropertyActionListener target="#{choosePersonDialogBean.employee}"
                            value="true" />
                    </p:commandButton>

                    <t:panelGroup colspan="3">
                        <p:commandButton value="保存" actionListener="#{bean.pay}" update=":editDialog:form:whoPay"
                            onclick="waitbox.show();" oncomplete="waitbox.hide();payDialog.hide();" />
                    </t:panelGroup>
                </t:panelGrid>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
