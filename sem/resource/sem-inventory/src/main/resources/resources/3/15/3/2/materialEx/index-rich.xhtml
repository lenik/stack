<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:pc="http://bee32.com/plover/core"
    xmlns:sem="http://bee32.com/sem/functions" xmlns:p="http://primefaces.org/ui"
    xmlns:t="http://myfaces.apache.org/tomahawk">
<ui:composition template="/template/primefaces.xhtml">

    <ui:define name="title">物料管理</ui:define>

    <ui:define name="content">

        <h:form id="mainForm">
            <p:toolbar>
                <p:toolbarGroup>
                    <p:commandButton value="新增物料"
                        oncomplete="editDialog.show();"
                        actionListener="#{materialExAdminBean.newMaterial}"
                        update="editForm:editPanel" />
                    <p:separator />
                    <p:commandButton value="查找物料" oncomplete="findMaterialDialog.show()" />
                </p:toolbarGroup>
            </p:toolbar>

            <t:panelGrid columns="2" columnClasses="alignTop, alignTop">
                <p:treeTable
                    id="categoryTree"
                    value="#{materialExAdminBean.root}"
                    var="category"
                    selectionMode="single"
                    selection="#{materialExAdminBean.selectedMaterialCategoryNode}"
                    scrollable="true" scrollHeight="480"
                    scrollWidth="250">

                    <p:ajax event="select" listener="#{materialExAdminBean.onCategorySelect}"
                        update="mainForm:materials" />

                    <p:column headerText="分类名称" style="width:150px;">
                        <h:outputText value="#{category.name}" />
                    </p:column>

                    <p:column headerText="物料数" style="width:50px;">
                        <h:outputText
                            value="#{category.materialCount}" />
                    </p:column>
                </p:treeTable>

                <p:dataTable
                    id="materials"
                    value="#{materialExAdminBean.materials}"
                    var="material"
                    paginator="true"
                    rowsPerPageTemplate="#{viewConfig.pageSizeTemplate}"
                    rows="#{viewConfig.pageSize}"
                    resizableColumns="true"
                    scrollable="true" scrollHeight="480"
                    scrollWidth="700"
                    rowIndexVar="rowIndex">

                    <p:column headerText="序号" style="width:20px;">
                        <h:outputText value="#{rowIndex+1}"/>
                    </p:column>

                    <p:column sortBy="#{material.label}" headerText="物料名称" style="width:100px;">
                        <h:outputText value="#{material.label}" />
                    </p:column>

                    <p:column headerText="规格型号" style="width:80px;">
                        <h:outputText value="#{material.modelSpec}" />
                    </p:column>
                    <p:column headerText="主单位" style="width:40px;">
                        <h:outputText value="#{material.unit.label}(#{material.unit.name})" />
                    </p:column>
                    <p:column headerText="基准价格" style="width:60px;">
                        <h:outputText value="#{material.currentPrice}" />
                    </p:column>
                    <p:column sortBy="#{material.createdDate}" headerText="创建日期" style="width:80px;">
                        <h:outputText value="#{material.createdDate}">
                            <f:convertDateTime pattern="yyyy-MM-dd"
                                timeZone="Asia/Shanghai" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="操作" style="width:150px;">
                        <p:commandLink title="修改"
                            update="editForm:editPanel"
                            oncomplete="editDialog.show()">
                            <f:setPropertyActionListener
                                value="#{material}"
                                target="#{materialExAdminBean.material}" />
                            <p:graphicImage
                                value="#{location.ICON}/etool16/editor_area.gif" />
                        </p:commandLink>
                        <p:commandLink
                            title="价格"
                            update="materialPriceForm:currMaterial materialPriceForm:prices"
                            oncomplete="materialPriceDialog.show()">
                            <f:setPropertyActionListener
                                value="#{material}"
                                target="#{materialExAdminBean.material}" />
                            <p:graphicImage
                                value="#{location.ICON}/obj16/prjversions_rep.gif" />
                        </p:commandLink>
                        <p:commandLink
                            title="单位换算表"
                            update="unitConvForm:currMaterial unitConvForm:unit unitConvForm:scaleMap"
                            oncomplete="unitConvDialog.show()">
                            <f:setPropertyActionListener
                                value="#{material}"
                                target="#{materialExAdminBean.material}" />
                            <p:graphicImage
                                value="#{location.ICON}/elcl16/toggledetailpane_co.gif" />
                        </p:commandLink>
                        <p:commandLink
                            title="自定义属性"
                            update="materialAttributeForm:currMaterial materialAttributeForm:attributes"
                            oncomplete="materialAttributeDialog.show()">
                            <f:setPropertyActionListener
                                value="#{material}"
                                target="#{materialExAdminBean.material}" />
                            <p:graphicImage
                                value="#{location.ICON}/obj16/native_lib_path_attrib.gif" />
                        </p:commandLink>
                        <p:commandLink
                            title="推荐库位"
                            update="preferredLocationForm:currMaterial preferredLocationForm:preferredLocations"
                            oncomplete="preferredLocationDialog.show()">
                            <f:setPropertyActionListener
                                value="#{material}"
                                target="#{materialExAdminBean.material}" />
                            <p:graphicImage
                                value="#{location.ICON}/cview16/filenav_nav.gif" />
                        </p:commandLink>
                        <p:commandLink
                            title="仓库选项"
                            update="warehouseOptionForm:currMaterial warehouseOptionForm:warehouseOptions"
                            oncomplete="warehouseOptionDialog.show()">
                            <f:setPropertyActionListener
                                value="#{material}"
                                target="#{materialExAdminBean.material}" />
                            <p:graphicImage
                                value="#{location.ICON}/elcl16/all_history_mode.gif" />
                        </p:commandLink>
                        <p:commandLink
                            title="附件"
                            update="userFileForm:currMaterial userFileForm:userFiles"
                            oncomplete="userFileDialog.show()">
                            <f:setPropertyActionListener
                                value="#{material}"
                                target="#{materialExAdminBean.material}" />
                            <p:graphicImage
                                value="#{location.ICON}/etool16/annotate.gif" />
                        </p:commandLink>
                        <p:commandLink title="删除" onclick="deleteConfirmDialog.show()">
                            <f:setPropertyActionListener
                                value="#{material}"
                                target="#{materialExAdminBean.material}" />
                            <p:graphicImage
                                value="#{location.ICON}/etool16/delete_edit.gif" />
                        </p:commandLink>
                    </p:column>
                </p:dataTable>
            </t:panelGrid>
        </h:form>

        <h:form id="editForm">
            <p:dialog header="新增修改物料" widgetVar="editDialog" height="480" width="640" modal="true">
                <t:panelGrid id="editPanel" columns="2">
                    <h:outputText value="物料分类:"/>
                    <t:panelGrid columns="2">
                        <p:inputText
                            id="materialCategory"
                            value="#{materialExAdminBean.material.category.name}" readonly="true"/>
                        <p:commandButton value="..." onclick="chooseMaterialCategoryDialog.show()"/>
                    </t:panelGrid>

                    <h:outputText value="物料名称:"/>
                    <p:inputText value="#{materialExAdminBean.material.label}" style="width:400px;"/>

                    <h:outputText value="主单位:"/>
                    <t:panelGrid columns="4">
                        <t:panelGrid columns="2">
                            <p:selectOneMenu
                                id="materialUnit"
                                value="#{materialExAdminBean.material.unit.id}"
                                style="width:100px;">
                                <f:selectItem itemLabel="--选择--" itemValue="" />
                                <f:selectItems
                                    value="#{materialExAdminBean.units}" />
                            </p:selectOneMenu>
                            <p:commandButton
                                actionListener="#{addUnitBean.newUnit}"
                                value="..."
                                onclick="addUnitDialog.show()" />
                        </t:panelGrid>
                        <h:outputText value="单位提示:"/>
                        <p:inputText value="#{materialExAdminBean.material.unitHint}"/>
                        <h:outputText value="(重量,长度等)"/>
                    </t:panelGrid>

                    <h:outputText value="条形码:"/>
                    <p:inputText value="#{materialExAdminBean.material.barCode}"/>

                    <h:outputText value="规格型号:"/>
                    <p:inputText value="#{materialExAdminBean.material.modelSpec}" style="width:400px;"/>

                    <h:outputText value="备注:"/>
                    <p:inputText value="#{materialExAdminBean.material.description}" style="width:400px;"/>

                    <t:panelGroup colspan="2">
                        <p:separator style="width:600px;height:2px" />
                    </t:panelGroup>

                    <t:panelGroup colspan="2">
                        <h:outputText value="包装运输相关" style="font-weight:bold;"/>
                    </t:panelGroup>

                    <h:outputText value="毛重(单位:克):"/>
                    <t:panelGrid columns="3">
                        <p:inputText value="#{materialExAdminBean.material.packageWeight}" style="width:50px;"/>
                        <h:outputText value="净重(单位:克):"/>
                        <p:inputText value="#{materialExAdminBean.material.netWeight}" style="width:50px;"/>
                    </t:panelGrid>

                    <h:outputText value="装箱尺寸:"/>
                    <t:panelGrid columns="7">
                        <h:outputText value="长"/>
                        <p:inputText value="#{materialExAdminBean.material.packageLength}" style="width:40px"/>
                        <h:outputText value="宽"/>
                        <p:inputText value="#{materialExAdminBean.material.packageWidth}" style="width:40px"/>
                        <h:outputText value="高"/>
                        <p:inputText value="#{materialExAdminBean.material.packageHeight}" style="width:40px"/>
                        <h:outputText value="(厘米)"/>
                    </t:panelGrid>

                    <t:panelGroup colspan="2">
                        <p:separator style="width:600px;height:2px" />
                    </t:panelGroup>

                    <p:commandButton
                        actionListener="#{materialExAdminBean.saveMaterial}"
                        update="mainForm:categoryTree mainForm:materials chooseMaterialCategoryForm:categoryTree"
                        value="保存"
                        oncomplete="editDialog.hide()"/>
                    <p:commandButton value="关闭" onclick="editDialog.hide()"/>
                </t:panelGrid>
            </p:dialog>
        </h:form>


        <ui:insert name="addUnit">
            <ui:include src="addUnit.xhtml">
                <ui:param name="updateObj" value="editForm:materialUnit"/>
            </ui:include>
        </ui:insert>


        <h:form id="chooseMaterialCategoryForm">
            <p:dialog header="挑选择物料分类"
                widgetVar="chooseMaterialCategoryDialog" height="480"
                width="640" modal="true">

                <p:treeTable
                    id="categoryTree"
                    value="#{materialExAdminBean.root}"
                    var="category"
                    selectionMode="single"
                    selection="#{materialExAdminBean.selectedMaterialCategoryNode}"
                    scrollable="true" scrollHeight="380"
                    scrollWidth="250">

                    <p:ajax event="select" listener="#{materialExAdminBean.onCategorySelect}"
                        update="mainForm:materials" />

                    <p:column headerText="分类名称" style="width:150px;">
                        <h:outputText value="#{category.name}" />
                    </p:column>

                    <p:column headerText="物料数" style="width:50px;">
                        <h:outputText
                            value="#{category.materialCount}" />
                    </p:column>
                </p:treeTable>

                <t:panelGrid columns="2">
                    <p:commandButton
                        value="确定"
                        update="editForm:materialCategory"
                        actionListener="#{materialExAdminBean.chooseMaterialCategory}"
                        oncomplete="chooseMaterialCategoryDialog.hide()" />
                    <p:commandButton value="关闭" onclick="chooseMaterialCategoryDialog.hide()"/>
                </t:panelGrid>
            </p:dialog>
        </h:form>

       <h:form id="deleteConfirmForm">
            <p:confirmDialog message="确定要删除吗?" width="200" header="删除确认"
                severity="alert" widgetVar="deleteConfirmDialog" modal="true">

                <p:commandButton value="确定"
                    update="mainForm:categoryTree mainForm:materials chooseMaterialCategoryForm:categoryTree"
                    actionListener="#{materialExAdminBean.deleteMaterial}"
                    oncomplete="deleteConfirmDialog.hide()" />
                <p:commandButton value="取消" onclick="deleteConfirmDialog.hide()"
                    type="button" />

            </p:confirmDialog>
        </h:form>

        <ui:insert name="materialPrice">
            <ui:include src="materialPrice.xhtml"/>
        </ui:insert>

        <ui:insert name="unitConv">
            <ui:include src="unitConv.xhtml"/>
        </ui:insert>

        <ui:insert name="materialAttribute">
            <ui:include src="materialAttribute.xhtml"/>
        </ui:insert>

        <ui:insert name="preferredLocation">
            <ui:include src="preferredLocation.xhtml"/>
        </ui:insert>

        <ui:insert name="warehouseOption">
            <ui:include src="warehouseOption.xhtml"/>
        </ui:insert>

        <ui:insert name="userFile">
            <ui:include src="userFile.xhtml"/>
        </ui:insert>

        <h:form id="findMaterialForm">
            <p:dialog header="查找物料" widgetVar="findMaterialDialog"
                height="480" width="640" modal="true">

                <t:panelGrid columns="2">
                    <h:outputText value="物料名称部份或全部:"/>
                    <p:inputText value="#{materialExAdminBean.materialPattern}" />
                </t:panelGrid>

                <p:commandButton
                    value="查找"
                    update="mainForm:materials"
                    actionListener="#{materialExAdminBean.findMaterial}"
                    oncomplete="findMaterialDialog.hide()"/>
            </p:dialog>
        </h:form>

    </ui:define>
</ui:composition>
</html>