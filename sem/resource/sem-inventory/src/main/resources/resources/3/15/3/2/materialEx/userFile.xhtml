<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:pc="http://bee32.com/plover/core"
    xmlns:sem="http://bee32.com/sem/functions" xmlns:p="http://primefaces.org/ui"
    xmlns:t="http://myfaces.apache.org/tomahawk">

<ui:composition>

    <h:form id="userFileForm">
        <p:dialog header="物料附件" widgetVar="userFileDialog" height="480"
            width="640" modal="true">

            <h:outputText
                id="currMaterial"
                value="当前物料:#{materialExAdminBean.material.label}"
                style="font-weight:bold;"/>

            <p:separator style="width:600px;height:2px" />


            <t:panelGrid columns="1" columnClasses="ftd,std">
                <p:fileUpload
                    fileUploadListener="#{materialExAdminBean.handleFileUpload}"
                    mode="advanced" update="userFileForm:userFiles"
                    multiple="true"
                    allowTypes="${viewConfig.allowTypes}" label="选择文件" />
            </t:panelGrid>
            <p:dataTable id="userFiles"
                value="#{materialExAdminBean.userFiles}"
                var="userFile" resizableColumns="true" scrollable="true"
                scrollHeight="350" scrollWidth="400"
                rowIndexVar="rowIndex">

                <p:column headerText="序号" style="width:30px;">
                    <h:outputText value="#{rowIndex+1}" />
                </p:column>

                <p:column headerText="附件标题" style="width:100px;">
                    <h:outputText value="#{userFile.label}"/>
                </p:column>

                <p:column headerText="附件名称" style="width:50px;">
                    <h:outputText value="#{userFile.name}" />
                </p:column>

                <p:column headerText="操作" style="width:100px;">
                    <p:commandLink
                        title="编辑"
                        update="editUserFileForm:editUserFilePanel"
                        oncomplete="editUserFileDialog.show()">
                        <f:setPropertyActionListener
                            value="#{userFile}"
                            target="#{materialExAdminBean.userFile}" />
                        <p:graphicImage
                            value="#{location.ICON}/etool16/editor_area.gif" />
                    </p:commandLink>
                    <p:commandLink title="删除" oncomplete="deleteUserFileConfirmDialog.show()">
                        <f:setPropertyActionListener
                            value="#{userFile}"
                            target="#{materialExAdminBean.userFile}" />
                        <p:graphicImage
                            value="#{location.ICON}/etool16/delete_edit.gif" />
                    </p:commandLink>
                    <a
                        href="#{location.WEB_APP}/3/15/1/6/file/download.do?id=#{userFile.id}"
                        title="下载">
                        <p:graphicImage
                            value="#{location.ICON}/etool16/group_by_file.gif" />
                    </a>
                </p:column>
            </p:dataTable>

        </p:dialog>
    </h:form>

    <h:form id="editUserFileForm">
        <p:dialog header="编辑物料附件" widgetVar="editUserFileDialog"
            height="480" width="640" modal="true">

            <t:panelGrid id="editUserFilePanel" columns="2">

                <t:panelGroup colspan="2">
                    <div align="center">
                        <img src="#{materialExAdminBean.userFile.imageHref}"
                            border="1" />
                    </div>
                </t:panelGroup>

                <h:outputText value="附件名:" />
                <t:panelGroup>
                    <p:inputText
                        value="#{materialExAdminBean.userFile.name}"
                        style="width:270px;" />
                </t:panelGroup>

                <h:outputText value="附件标题:" />
                <p:inputText value="#{materialExAdminBean.userFile.label}"
                    style="width:270px;" />

                <h:outputText value="附件描述:" />
                <p:inputTextarea
                    value="#{materialExAdminBean.userFile.description}"
                    style="width:270px;height:50px;" />

                <p:commandButton
                    actionListener="#{materialExAdminBean.updateUserFile}"
                    update="userFileForm:userFiles"
                    value="保存" oncomplete="editUserFileDialog.hide()" />
                <p:commandButton value="关闭" onclick="editUserFileDialog.hide()" />
            </t:panelGrid>
        </p:dialog>
    </h:form>

    <h:form id="deleteUserFileConfirmForm">
        <p:confirmDialog message="确定要删除吗?" width="200" header="删除确认"
            severity="alert" widgetVar="deleteUserFileConfirmDialog"
            modal="true">

            <p:commandButton value="确定"
                update="userFileForm:userFiles"
                actionListener="#{materialExAdminBean.deleteUserFile}"
                oncomplete="deleteUserFileConfirmDialog.hide()" />
            <p:commandButton value="取消"
                onclick="deleteUserFileConfirmDialog.hide()" type="button" />

        </p:confirmDialog>
    </h:form>

</ui:composition>

</html>