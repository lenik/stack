<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:pc="http://bee32.com/plover/core"
    xmlns:sem="http://bee32.com/sem/functions" xmlns:p="http://primefaces.org/ui"
    xmlns:t="http://myfaces.apache.org/tomahawk">

<ui:composition>

    <h:form id="preferredLocationForm">
        <p:dialog header="推荐库位" widgetVar="preferredLocationDialog" height="480"
            width="640" modal="true">

            <h:outputText
                id="currMaterial"
                value="当前物料:#{materialExAdminBean.material.label}"
                style="font-weight:bold;"/>

            <p:separator style="width:600px;height:2px" />


            <p:commandButton
                value="增加推荐库位"
                update="addPreferredLocationForm:addPreferredLocationPanel"
                actionListener="#{materialExAdminBean.newPreferredLocation}"
                onclick="addPreferredLocationDialog.show()"/>
            <p:dataTable id="preferredLocations"
                value="#{materialExAdminBean.preferredLocations}"
                var="preferredLocation" resizableColumns="true" scrollable="true"
                scrollHeight="350" scrollWidth="400"
                rowIndexVar="rowIndex">

                <p:column headerText="序号" style="width:30px;">
                    <h:outputText value="#{rowIndex+1}" />
                </p:column>

                <p:column headerText="仓库" style="width:100px;">
                    <h:outputText value="#{preferredLocation.location.nodeText}"/>
                </p:column>

                <p:column headerText="库位" style="width:50px;">
                    <h:outputText value="#{preferredLocation.location.warehouse.name}" />
                </p:column>

                <p:column headerText="操作" style="width:100px;">
                    <p:commandLink title="删除" oncomplete="deletePreferredLocationConfirmDialog.show()">
                        <f:setPropertyActionListener
                            value="#{preferredLocation}"
                            target="#{materialExAdminBean.preferredLocation}" />
                        <p:graphicImage
                            value="#{location.ICON}/etool16/delete_edit.gif" />
                    </p:commandLink>
                </p:column>
            </p:dataTable>

        </p:dialog>
    </h:form>

    <h:form id="addPreferredLocationForm">
        <p:dialog header="新增推荐库位" widgetVar="addPreferredLocationDialog"
            height="480" width="640" modal="true">

            <t:panelGrid id="addPreferredLocationPanel" columns="2">
                <h:outputText value="仓库" />
                <p:inputText value="#{materialExAdminBean.preferredLocation.location.warehouse.name}" readonly="true"/>

                <h:outputText value="库位" />
                <t:panelGroup colspan="2">
                    <p:inputText
                        value="#{materialExAdminBean.preferredLocation.location.nodeText}"
                        readonly="true" />
                    <p:commandButton value="..." oncomplete="choosePreferredLocationDialog.show()" />
                </t:panelGroup>

                <p:commandButton
                    actionListener="#{materialExAdminBean.addPreferredLocation}"
                    update="preferredLocationForm:preferredLocations"
                    value="保存" oncomplete="addPreferredLocationDialog.hide()" />
                <p:commandButton value="关闭" onclick="addPreferredLocationDialog.hide()" />
            </t:panelGrid>
        </p:dialog>
    </h:form>

    <h:form id="deletePreferredLocationConfirmForm">
        <p:confirmDialog message="确定要删除吗?" width="200" header="删除确认"
            severity="alert" widgetVar="deletePreferredLocationConfirmDialog"
            modal="true">

            <p:commandButton value="确定"
                update="preferredLocationForm:preferredLocations"
                actionListener="#{materialExAdminBean.deletePreferredLocation}"
                oncomplete="deletePreferredLocationConfirmDialog.hide()" />
            <p:commandButton value="取消"
                onclick="deletePreferredLocationConfirmDialog.hide()" type="button" />

        </p:confirmDialog>
    </h:form>

    <h:form id="choosePreferredLocationForm">
        <p:dialog header="挑选库位"
            widgetVar="choosePreferredLocationDialog" height="480"
            width="640" modal="true">


            <h:panelGrid columns="2">
                <h:outputText value="仓库:" />
                <p:selectOneMenu id="stockWarehouseId" value="#{stockLocationAdminBean.selectedWarehouse.id}" style="width:200px;">
                    <f:selectItem itemValue="" itemLabel="--选择仓库--" />
                    <f:selectItems value="#{stockLocationAdminBean.stockWarehouses}" />
                    <p:ajax
                        event="change"
                        listener="#{stockLocationAdminBean.onSwChange}"
                        update="choosePreferredLocationForm:stockLocationTable" />
                </p:selectOneMenu>
            </h:panelGrid>

            <p:treeTable id="stockLocationTable"
                value="#{stockLocationAdminBean.root}"
                var="stockLocation" selectionMode="single"
                selection="#{materialExAdminBean.selectedPreferredLocation}"
                scrollable="true"
                scrollHeight="350" scrollWidth="400">

                <p:column headerText="库位" style="width:150px;">
                    <h:outputText value="#{stockLocation.nodeText}" />
                </p:column>
                <p:column headerText="所属仓库" style="width:150px;">
                    <h:outputText
                        value="#{stockLocation.warehouse.name}" />
                </p:column>
            </p:treeTable>

            <t:panelGrid columns="2">
                <p:commandButton value="确定"
                    update="addPreferredLocationForm:addPreferredLocationPanel"
                    actionListener="#{materialExAdminBean.choosePreferredLocation}"
                    oncomplete="choosePreferredLocationDialog.hide()" />
                <p:commandButton value="取消"
                    onclick="choosePreferredLocationDialog.hide()"
                    type="button" />
            </t:panelGrid>
        </p:dialog>
    </h:form>

</ui:composition>

</html>