<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:pc="http://bee32.com/plover/core"
    xmlns:sem="http://bee32.com/sem/functions" xmlns:p="http://primefaces.prime.com.tr/ui"
    xmlns:t="http://myfaces.apache.org/tomahawk">
<!-- InstanceBegin template="/Templates/seccaJsf.dwt.jsp" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>

<ui:composition template="/template/primefaces.xhtml">

    <ui:define name="title">material</ui:define>

    <ui:define name="content">

        <h:form id="note">
            <p:growl id="growl" showDetail="true" />
        </h:form>

        <h:form id="main">
            <h:outputStylesheet>
                .column1{
                    vertical-align:top;
                    width:30%;
                }
                .column2{
                    vertical-align:top;
                    width:30%;
                }
                .column3{
                    vertical-align:top;
                    width:40%;
                }
            </h:outputStylesheet>

            <p:tabView>

                <p:tab title="物料分类设置">

                    <p:toolbar>
                        <p:toolbarGroup id="categoryToolbart">
                            <p:commandButton value="新增" title="新增分类"
                                actionListener="#{materialSettingsBean.createCategoryForm}"
                                oncomplete="categoryWizardDialog.show();" update="dialogForm:categoryForm" />
                            <p:commandButton id="editCategory" value="编辑" title="编辑分类"
                                actionListener="#{materialSettingsBean.editCategoryForm}"
                                update="dialogForm:categoryForm" oncomplete="categoryWizardDialog.show();"
                                disabled="#{!materialSettingsBean.categoryOptionable}" />
                            <p:commandButton id="deleteCategory" value="删除" title="删除分类"
                                actionListener="#{materialSettingsBean.destroyCategory}" update="main:mainTree,note"
                                disabled="#{!materialSettingsBean.categoryOptionable}" />
                        </p:toolbarGroup>
                    </p:toolbar>

                    <p:panel>
                        <p:tree id="mainTree" value="#{materialSettingsBean.materialCategoryMainTree.rootNode}"
                            var="node" dynamic="true" selectionMode="single"
                            selection="#{materialSettingsBean.materialCategoryMainTree.selectedNode}">
                            <p:ajax event="select" listener="#{materialSettingsBean.onCategoryNodeSelect}"
                                update="main:editCategory,main:deleteCategory" />
                            <p:ajax event="unselect" listener="#{materialSettingsBean.onCategoryNodeUnselect}"
                                update="main:editCategory,main:deleteCategory" />
                            <p:treeNode>
                                <h:outputText value="#{node.name}" />
                            </p:treeNode>
                        </p:tree>
                    </p:panel>

                </p:tab>

                <p:tab title="物料单位设置">

                    <p:toolbar>
                        <p:toolbarGroup>
                            <p:commandButton value="新增" title="新增单位"
                                actionListener="#{materialSettingsBean.createUnitForm}" oncomplete="unitDialog.show();"
                                update="dialogForm:unitForm" />
                        </p:toolbarGroup>
                    </p:toolbar>

                    <p:panel>
                        <h:outputText value="单位:" />
                        <p:dataTable var="unit" value="#{materialSettingsBean.unitList}" id="unitList">
                            <p:column headerText="单位名称">
                                <h:outputText value="#{unit.label}" />
                            </p:column>
                            <p:column headerText="单位代码">
                                <h:outputText value="#{unit.name}" />
                            </p:column>
                            <p:column headerText="标准单位">
                                <h:outputText value="#{unit.stdUnit.displayId}" />
                            </p:column>
                            <p:column headerText="倍率">
                                <h:outputText value="#{unit.scale}" />
                            </p:column>
                            <p:column headerText="操作">
                                <p:commandLink title="编辑" oncomplete="unitDialog.show();" update="dialogForm:unitForm"
                                    actionListener="#{materialSettingsBean.setDictNameCantEdit}">
                                    <p:graphicImage value="#{location.ICON}/etool16/editor_area.gif" />
                                    <f:setPropertyActionListener value="#{unit}"
                                        target="#{materialSettingsBean.selectedUnit}" />
                                </p:commandLink>
                                <p:commandLink title="删除" onclick="unitConfirmation.show();">
                                    <p:graphicImage value="#{location.ICON}/etool16/delete_edit.gif" />
                                    <f:setPropertyActionListener value="#{unit}"
                                        target="#{materialSettingsBean.selectedUnit}" />
                                </p:commandLink>
                            </p:column>
                        </p:dataTable>
                    </p:panel>

                </p:tab>

                <p:tab title="单位换算表设置">

                    <p:toolbar>
                        <p:toolbarGroup>
                            <p:commandButton value="新增" title="新增单位换算表"
                                actionListener="#{materialSettingsBean.createUnitConvForm}"
                                oncomplete="unitConvDialog.show();" update="dialogForm:unitConvForm" />
                        </p:toolbarGroup>
                    </p:toolbar>

                    <p:panel>
                        <h:outputText value="单位换算表:" />
                        <p:dataTable var="unitConv" value="#{materialSettingsBean.unitConvList}" id="unitConvList">
                            <p:column headerText="换算表代码">
                                <h:outputText value="#{unitConv.name}" />
                            </p:column>
                            <p:column headerText="还算表名称">
                                <h:outputText value="#{unitConv.label}" />
                            </p:column>
                            <p:column headerText="源单位">
                                <h:outputText value="#{unitConv.unit.name}" />
                            </p:column>
                            <p:column headerText="操作">
                                <p:commandLink title="详细" actionListener="#{materialSettingsBean.setUnitConvUneditable}"
                                    update="dialogForm:unitConvForm" oncomplete="unitConvDialog.show();">
                                    <f:setPropertyActionListener value="#{unitConv}"
                                        target="#{materialSettingsBean.activeUnitConv}" />
                                    <p:graphicImage value="#{location.ICON}/etool16/validate.gif" />
                                </p:commandLink>
                                <p:commandLink title="编辑" oncomplete="unitConvDialog.show();"
                                    actionListener="#{materialSettingsBean.setDictNameCantEdit}"
                                    update="dialogForm:unitConvForm">
                                    <p:graphicImage value="#{location.ICON}/etool16/editor_area.gif" />
                                    <f:setPropertyActionListener value="#{unitConv}"
                                        target="#{materialSettingsBean.selectedUnitConv}" />
                                </p:commandLink>
                                <p:commandLink title="删除" oncomplete="unitConvConfirmation.show();">
                                    <p:graphicImage value="#{location.ICON}/etool16/delete_edit.gif" />
                                    <f:setPropertyActionListener value="#{unitConv}"
                                        target="#{materialSettingsBean.selectedUnitConv}" />
                                </p:commandLink>
                            </p:column>
                        </p:dataTable>
                    </p:panel>

                </p:tab>

                <p:tab title="基础价格设置">
                    <p:toolbar>
                        <p:toolbarGroup>
                            <p:commandButton value="查找物料" />
                            <p:commandButton value="设置新价格" />
                        </p:toolbarGroup>
                    </p:toolbar>
                    <t:panelGrid columns="3" columnClasses="column1,column2,column3" style="width:100%;">
                        <t:panelGroup columns="1">
                            <p:tree value="#{materialSettingsBean.materialPriceTree.rootNode}" var="node" dynamic="true"
                                selectionMode="single"
                                selection="#{materialSettingsBean.materialPriceTree.selectedNode}">
                                <p:ajax event="select" listener="#{materialSettingsBean.materialPriceTree.onNodeSelect}"
                                    update="main:materialList" />
                                <p:treeNode>
                                    <h:outputText value="#{node.name}" />
                                </p:treeNode>
                            </p:tree>

                        </t:panelGroup>
                        <p:dataTable id="materialList" value="#{materialSettingsBean.materialList}" var="item"
                            selection="#{materialSettingsBean.selectedMaterial}" selectionMode="single">
                            <p:column headerText="物料名称">
                                <h:outputText value="#{item.name}" />
                            </p:column>
                            <p:column headerText="操作">
                                <p:commandLink title="设置价格" actionListener="#{materialSettingsBean.onRowSelect}"
                                    update="main:materialPriceList">
                                    <p:graphicImage value="#{location.ICON}/etool16/editor_area.gif" />
                                    <f:setPropertyActionListener value="#{item}"
                                        target="#{materialSettingsBean.selectedMaterial}" />
                                </p:commandLink>
                            </p:column>
                        </p:dataTable>

                        <p:dataTable id="materialPriceList" value="#{materialSettingsBean.selectedMaterial.prices}"
                            var="priceItem">
                            <p:column headerText="物料名称">
                                <h:outputText value="#{priceItem.material.name}" />
                            </p:column>
                            <p:column headerText="日期">
                                <h:outputText value="#{priceItem.date}" />
                            </p:column>
                            <p:column headerText="价格">
                                <h:outputText value="#{priceItem.price}" />
                            </p:column>
                        </p:dataTable>
                    </t:panelGrid>
                </p:tab>

            </p:tabView>
        </h:form>

        <h:form id="dialogForm">

            <p:confirmDialog message="确定要删除此单位吗?" showEffect="bounce" hideEffect="explode" header="提示" severity="alert"
                widgetVar="unitConfirmation">

                <p:commandButton value="确定" update="note,main:unitList" oncomplete="unitConfirmation.hide()"
                    actionListener="#{materialSettingsBean.destroyUnit}" />
                <p:commandButton value="取消" onclick="unitConfirmation.hide()" type="button" />

            </p:confirmDialog>

            <p:confirmDialog message="确定要删除此单位还算表吗?" showEffect="bounce" hideEffect="explode" header="提示"
                severity="alert" widgetVar="unitConvConfirmation">

                <p:commandButton value="确定" update="note,main:unitConvList" oncomplete="unitConvConfirmation.hide()"
                    actionListener="#{materialSettingsBean.destroyUnitConv}" />
                <p:commandButton value="取消" onclick="unitConvConfirmation.hide()" type="button" />

            </p:confirmDialog>

            <p:dialog header="单位" widgetVar="unitDialog" height="300" width="450" modal="true">
                <p:panel id="unitForm">
                    <t:panelGrid columns="2">
                        <h:outputText value="单位名称:" />
                        <p:inputText value="#{materialSettingsBean.activeUnit.label}" />

                        <h:outputText value="单位代码:" />
                        <p:inputText value="#{materialSettingsBean.activeUnit.name}"
                            readonly="#{materialSettingsBean.cantEdit}" />

                        <h:outputText value="标准单位:" />
                        <p:selectOneMenu value="#{materialSettingsBean.activeUnit.stdUnit.displayId}"
                            style="width:100px;">
                            <f:selectItem itemLabel="" itemValue="" />
                            <f:selectItems value="#{materialSettingsBean.standardUnits}" />
                        </p:selectOneMenu>

                        <h:outputText value="倍率:" />
                        <p:inputText value="#{materialSettingsBean.activeUnit.scale}" />
                    </t:panelGrid>
                    <p:commandButton value="保存" actionListener="#{materialSettingsBean.doSaveUnit}"
                        oncomplete="unitDialog.hide();" update="main:unitList,note" />
                    <p:commandButton value="取消" onclick="unitDialog.hide();" />
                </p:panel>
            </p:dialog>

            <p:dialog header="单位换算表" widgetVar="unitConvDialog" height="500" width="700" modal="true">
                <p:panel id="unitConvForm">
                    <t:panelGrid columns="2">
                        <h:outputText value="代码:" />
                        <p:inputText value="#{materialSettingsBean.activeUnitConv.name}"
                            readonly="#{materialSettingsBean.unitConvEditable or materialSettingsBean.cantEdit}" />

                        <h:outputText value="名称:" />
                        <p:inputText value="#{materialSettingsBean.activeUnitConv.label}"
                            readonly="#{materialSettingsBean.unitConvEditable}" />

                        <h:outputText value="源单位:" />
                        <p:selectOneMenu value="#{materialSettingsBean.activeUnitConv.unit.displayId}"
                            style="width:100px;" disabled="#{materialSettingsBean.unitConvEditable}">
                            <f:selectItem itemLabel="" itemValue="" />
                            <f:selectItems value="#{materialSettingsBean.units}" />
                        </p:selectOneMenu>
                    </t:panelGrid>
                    <h:outputText value="换算表:" />
                    <p:dataTable var="item" value="#{materialSettingsBean.activeUnitConv.itemList}" id="scaleList">
                        <p:column headerText="换算单位">
                            <h:outputText value="#{item.unit.label}" />
                        </p:column>
                        <p:column headerText="换算率">
                            <h:outputText value="#{item.scale}" />
                        </p:column>
                        <p:column headerText="操作" style="width:80px;">
                            <p:commandLink title="编辑" update="dialogForm:scaleList" oncomplete="scaleDialog.show();"
                                disabled="#{materialSettingsBean.unitConvEditable}">
                                <p:graphicImage value="#{location.ICON}/etool16/editor_area.gif" />
                                <f:setPropertyActionListener value="#{item}"
                                    target="#{materialSettingsBean.selectedScale}" />
                            </p:commandLink>
                            <p:commandLink title="删除" update="dialogForm:scaleList"
                                disabled="#{materialSettingsBean.unitConvEditable}">
                                <p:graphicImage value="#{location.ICON}/etool16/delete_edit.gif" />
                                <p:collector value="#{item}"
                                    removeFrom="#{materialSettingsBean.activeUnitConv.itemList}" />
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                    <p:commandButton value="添加条目" actionListener="#{materialSettingsBean.createScaleItem}"
                        oncomplete="scaleDialog.show();" update="scaleForm"
                        disabled="#{materialSettingsBean.unitConvEditable}" />
                    <p:separator />
                    <p:commandButton value="保存" actionListener="#{materialSettingsBean.doSaveUnitConv}"
                        oncomplete="unitConvDialog.hide();" update="main:unitConvList,note"
                        disabled="#{materialSettingsBean.unitConvEditable}" />
                    <p:commandButton value="取消" onclick="unitConvDialog.hide();" />
                </p:panel>
            </p:dialog>

            <p:dialog widgetVar="scaleDialog" height="300" width="400">
                <p:panel id="scaleForm">
                    <t:panelGrid columns="2">
                        <h:outputText value="换算单位" />
                        <p:selectOneMenu value="#{materialSettingsBean.activeScaleItem.unit.displayId}"
                            style="width:100px;">
                            <f:selectItem itemLabel="" itemValue="" />
                            <f:selectItems value="#{materialSettingsBean.units}" />
                        </p:selectOneMenu>

                        <h:outputText value="换算率" />
                        <p:inputText value="#{materialSettingsBean.activeScaleItem.scale}" />
                    </t:panelGrid>
                    <p:commandButton value="确定" actionListener="#{materialSettingsBean.doAddScaleItem}"
                        update="dialogForm:scaleList" oncomplete="scaleDialog.hide();" />
                    <p:commandButton value="取消" onclick="scaleDialog.hide();" />
                </p:panel>
            </p:dialog>

            <p:dialog header="物料分类" widgetVar="categoryWizardDialog" height="250" width="450" modal="true">
                <p:panel id="categoryForm">
                    <t:panelGrid columns="2">
                        <h:outputText value="上级分类:" />
                        <t:panelGroup colspan="1">
                            <p:inputText value="#{materialSettingsBean.activeCategory.parent.name}" readonly="true" />
                            <p:commandButton value="..." title="选择上级分类" onclick="categorySelectDialog.show();" />
                        </t:panelGroup>

                        <h:outputText value="分类名称:" />
                        <p:inputText value="#{materialSettingsBean.activeCategory.name}" />

                        <p:commandButton value="确认" actionListener="#{materialSettingsBean.doSaveCategory}"
                            oncomplete="categoryWizardDialog.hide();" update="main:mainTree,note" />
                        <p:commandButton value="取消" onclick="categoryWizardDialog.hide();" />

                    </t:panelGrid>
                </p:panel>
            </p:dialog>

            <p:dialog header="选择上级分类" widgetVar="categorySelectDialog" height="500" width="700" modal="true">
                <p:tree value="#{materialSettingsBean.materialCategorySelectTree.rootNode}" var="node" dynamic="true"
                    selectionMode="single" selection="#{materialSettingsBean.materialCategorySelectTree.selectedNode}"
                    style="width:100%;">
                    <p:treeNode>
                        <h:outputText value="#{node.name}" />
                    </p:treeNode>
                </p:tree>
                <p:commandButton value="选择"
                    actionListener="#{materialSettingsBean.materialCategorySelectTree.onNodeSelect}"
                    update="dialogForm:categoryForm" oncomplete="categorySelectDialog.hide();" />
            </p:dialog>

        </h:form>

    </ui:define>
</ui:composition>
</html>