<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fn="http://java.sun.com/jsp/jstl/functions"
    xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:icsf="http://java.sun.com/jsf/composite/3/7"
    xmlns:sem="http://java.sun.com/jsf/composite/3/15" template="/template/simple-entity.xhtml">

    <ui:param name="title" value="物料管理" />
    <ui:param name="sideBarWVisible" value="true" />
    <ui:param name="bean" value="${materialExAdminBean}" />

    <ui:define name="sideBarW">
        <h:form id="navigatorForm">
            <p:treeTable id="categoryTree" value="#{bean.root}" var="category" selectionMode="single"
                selection="#{bean.selectedMaterialCategoryNode}">

                <p:ajax event="select" listener="#{bean.refreshRowCount}" update=":mainForm:dataTable" />

                <p:column headerText="分类名称" style="width:150px;">
                    <h:outputText value="#{category.name}" />
                </p:column>

                <p:column headerText="物料数" style="width:50px;">
                    <h:outputText value="#{category.materialCount}" />
                </p:column>
            </p:treeTable>
        </h:form>
    </ui:define>

    <ui:define name="dataColumns">
        <p:column sortBy="#{entry.label}" headerText="物料名称" style="width:100px;">
            <h:outputText value="#{entry.label}" />
        </p:column>

        <p:column headerText="规格型号" style="width:80px;">
            <h:outputText value="#{entry.modelSpec}" />
        </p:column>

        <p:column headerText="主单位" style="width:40px;">
            <h:outputText value="#{entry.unit.label}(#{entry.unit.name})" />
        </p:column>

        <p:column headerText="基准价格" style="width:60px;">
            <h:outputText value="#{entry.currentPrice}" />
        </p:column>

        <p:column headerText="操作" style="width:150px;">
            <p:commandLink styleClass="icon-button" title="价格" update=":materialPriceDialog:form"
                oncomplete="materialPriceDialog.show()">
                <f:setPropertyActionListener value="#{entry}" target="#{bean.activeObject}" />
                <p:graphicImage value="#{location.ICON}/obj16/prjversions_rep.gif" />
            </p:commandLink>
            <p:commandLink styleClass="icon-button" title="单位换算表" update=":unitConvDialog:form"
                oncomplete="unitConvDialog.show()">
                <f:setPropertyActionListener value="#{entry}" target="#{bean.activeObject}" />
                <p:graphicImage value="#{location.ICON}/elcl16/toggledetailpane_co.gif" />
            </p:commandLink>
            <p:commandLink styleClass="icon-button" title="自定义属性" update=":materialAttributeDialog:form"
                oncomplete="materialAttributeDialog.show()">
                <f:setPropertyActionListener value="#{entry}" target="#{bean.activeObject}" />
                <p:graphicImage value="#{location.ICON}/obj16/native_lib_path_attrib.gif" />
            </p:commandLink>
            <p:commandLink styleClass="icon-button" title="推荐库位" update=":preferredLocationDialog:form"
                oncomplete="preferredLocationDialog.show()">
                <f:setPropertyActionListener value="#{entry}" target="#{bean.activeObject}" />
                <p:graphicImage value="#{location.ICON}/cview16/filenav_nav.gif" />
            </p:commandLink>
            <p:commandLink styleClass="icon-button" title="仓库选项" update=":warehouseOptionDialog:form"
                oncomplete="warehouseOptionDialog.show()">
                <f:setPropertyActionListener value="#{entry}" target="#{bean.activeObject}" />
                <p:graphicImage value="#{location.ICON}/elcl16/all_history_mode.gif" />
            </p:commandLink>
            <p:commandLink styleClass="icon-button" title="附件" update=":unitConvDialog:form" oncomplete="userFileDialog.show()">
                <f:setPropertyActionListener value="#{entry}" target="#{bean.activeObject}" />
                <p:graphicImage value="#{location.ICON}/etool16/annotate.gif" />
            </p:commandLink>
        </p:column>
    </ui:define>

    <ui:define name="editDialog">
        <p:dialog id="editDialog" header="新增修改物料" widgetVar="editDialog" height="480" width="640" modal="true">
            <c:set var="obj" value="#{bean.activeObject}" />
            <h:form id="form">
                <t:panelGrid id="editPanel" columns="2" rendered="${obj != null}">
                    <h:outputText value="物料分类:" />
                    <t:panelGrid columns="2">
                        <p:inputText id="materialCategory" value="#{obj.category.name}" readonly="true" />
                        <p:commandButton value="..." onclick="chooseMaterialCategoryDialog.show()" />
                    </t:panelGrid>

                    <h:outputText value="物料名称:" />
                    <p:inputText value="#{obj.label}" style="width:400px;" />

                    <h:outputText value="主单位:" />
                    <t:panelGrid columns="4">
                        <t:panelGrid columns="2">
                            <p:selectOneMenu id="materialUnit" value="#{obj.unit.id}" style="width:100px;">
                                <f:selectItem itemLabel="--选择--" itemValue="" />
                                <f:selectItems value="#{bean.units}" />
                            </p:selectOneMenu>
                            <p:commandButton actionListener="#{addUnitBean.newUnit}" value="..."
                                onclick="addUnitDialog.show()" />
                        </t:panelGrid>
                        <h:outputText value="单位提示:" />
                        <p:inputText value="#{obj.unitHint}" />
                        <h:outputText value="(重量,长度等)" />
                    </t:panelGrid>

                    <h:outputText value="条形码:" />
                    <p:inputText value="#{obj.barCode}" />

                    <h:outputText value="规格型号:" />
                    <p:inputText value="#{obj.modelSpec}" style="width:400px;" />

                    <h:outputText value="备注:" />
                    <p:inputText value="#{obj.description}" style="width:400px;" />

                    <t:panelGroup colspan="2">
                        <p:separator style="width:600px;height:2px" />
                    </t:panelGroup>

                    <t:panelGroup colspan="2">
                        <h:outputText value="包装运输相关" style="font-weight:bold;" />
                    </t:panelGroup>

                    <h:outputText value="毛重(单位:克):" />
                    <t:panelGrid columns="3">
                        <p:inputText value="#{obj.packageWeight}" style="width:50px;" />
                        <h:outputText value="净重(单位:克):" />
                        <p:inputText value="#{obj.netWeight}" style="width:50px;" />
                    </t:panelGrid>

                    <h:outputText value="装箱尺寸:" />
                    <t:panelGrid columns="7">
                        <h:outputText value="长" />
                        <p:inputText value="#{obj.packageLength}" style="width:40px" />
                        <h:outputText value="宽" />
                        <p:inputText value="#{obj.packageWidth}" style="width:40px" />
                        <h:outputText value="高" />
                        <p:inputText value="#{obj.packageHeight}" style="width:40px" />
                        <h:outputText value="(厘米)" />
                    </t:panelGrid>

                    <t:panelGroup colspan="2">
                        <p:separator style="width:600px;height:2px" />
                    </t:panelGroup>
                </t:panelGrid>
                <div align="right">
                    <p:commandButton id="save-validated" value="保存" actionListener="${bean.save}"
                        update=":mainForm:dataTable, :chooseMaterialCategoryForm:categoryTree" oncomplete="editDialog.hideValidated()" />
                    <p:commandButton id="cancel" value="取消" onclick="editDialog.hide()" />
                </div>
            </h:form>
        </p:dialog>

    </ui:define>

    <ui:define name="dialogs">
        <ui:include src="addUnit.xhtml">
            <ui:param name="update" value=":editDialog:form:materialUnit" />
        </ui:include>
        <ui:include src="materialPrice.xhtml" />
        <ui:include src="unitConv.xhtml" />
        <ui:include src="materialAttribute.xhtml" />
        <ui:include src="preferredLocation.xhtml" />
        <ui:include src="warehouseOption.xhtml" />
        <ui:include src="userFile.xhtml" />

        <p:dialog header="挑选择物料分类" widgetVar="chooseMaterialCategoryDialog" height="480" width="640" modal="true">
            <h:form id="chooseMaterialCategoryForm">
                <p:treeTable id="categoryTree" value="#{bean.root}" var="category" selectionMode="single"
                    selection="#{bean.choosedMaterialCategoryNode}" scrollable="true" scrollHeight="380" scrollWidth="250">

                    <p:column headerText="分类名称" style="width:150px;">
                        <h:outputText value="#{category.name}" />
                    </p:column>

                    <p:column headerText="物料数" style="width:50px;">
                        <h:outputText value="#{category.materialCount}" />
                    </p:column>
                </p:treeTable>

                <t:panelGrid columns="2">
                    <p:commandButton value="确定" update=":editDialog:form:materialCategory"
                        actionListener="#{bean.chooseMaterialCategory}" oncomplete="chooseMaterialCategoryDialog.hide()" />
                    <p:commandButton value="关闭" onclick="chooseMaterialCategoryDialog.hide()" />
                </t:panelGrid>
            </h:form>
        </p:dialog>
    </ui:define>

</ui:composition>
