<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:pc="http://bee32.com/plover/core"
    xmlns:sem="http://bee32.com/sem/functions" xmlns:p="http://primefaces.org/ui"
    xmlns:t="http://myfaces.apache.org/tomahawk">
<ui:composition template="/template/primefaces.xhtml">

    <ui:define name="title">物料管理</ui:define>

    <ui:define name="content">
        <h:head>
            <script language="javascript">
                function mainUnitCheck(xhr, status, args) {
                    if(!args.validationFailed || args.mainUnitSelected) {
                        unitConvDialog.show();
                    }
                }
            </script>
        </h:head>

        <h:form id="main">
            <t:panelGrid columns="2" width="100%" columnClasses="ftd,std">
                <t:panelGroup colspan="2">
                    <p:toolbar>
                         <p:toolbarGroup align="left">
                            <p:commandButton value="新增物料" oncomplete="materialDialog.show();"
                                actionListener="#{materialViewBean.createMaterialForm}" update=":dialogForm:material" />
                            <p:separator />
                            <p:commandButton value="查找物料" id="preSearchBtn"
                                actionListener="#{materialViewBean.searchForm}" update="main" />
                        </p:toolbarGroup>
                    </p:toolbar>
                </t:panelGroup>

                <p:treeTable id="categoryTree"
                    value="#{materialViewBean.materialCategoryTree.rootNode}"
                    var="node" dynamic="true" selectionMode="single"
                    selection="#{materialViewBean.materialCategoryTree.selectedNode}"
                    scrollable="true" scrollHeight="480"
                    scrollWidth="300">

                    <p:ajax event="select" listener="#{materialViewBean.materialCategoryTree.onNodeSelect}"
                        update=":main:materialList" />

                    <p:column>
                        <f:facet name="header">分类名称</f:facet>
                        <h:outputText value="#{node.name}" />
                    </p:column>
                </p:treeTable>



                <p:panel id="searchInfo">
                    <t:panelGrid columns="1">
                        <h:outputText value="查找条件:" />
                        <p:inputText value="#{materialViewBean.materialPattern}" />
                    </t:panelGrid>
                    <p:commandButton value="查找" id="searchBtn" actionListener="#{materialViewBean.doSearch}"
                        update="main" />
                    <p:commandButton value="取消" id="resetBtn" actionListener="#{materialViewBean.resetSearch}"
                        update="main" />
                </p:panel>
                <p:dataTable var="material" value="#{materialViewBean.materialList}" id="materialList" paginator="true"
                    rowsPerPageTemplate="#{viewConfig.pageSizeTemplate}" rows="#{viewConfig.pageSize}"
                    style="width:100%;">
                    <p:column sortBy="#{material.label}" headerText="物料名称">
                        <h:outputText value="#{material.label}" />
                    </p:column>
                    <p:column headerText="条形码">
                        <h:outputText value="#{material.barCode}" />
                    </p:column>
                    <p:column headerText="规格型号">
                        <h:outputText value="#{material.modelSpec}" />
                    </p:column>
                    <p:column headerText="主单位">
                        <h:outputText value="#{material.unit.label}(#{material.unit.name})" />
                    </p:column>
                    <p:column headerText="当前基价">
                        <h:outputText value="#{material.currentPrice}" />
                    </p:column>
                    <p:column headerText="附件数量">
                        <h:outputText value="#{fn:length(material.attachments)}" />
                    </p:column>
                    <p:column headerText="操作" style="width:80px;">
                        <p:commandLink title="详细" update=":dialogForm:material"
                            actionListener="#{materialViewBean.setMaterialDialogDisable}"
                            oncomplete="materialDialog.show();">
                            <f:setPropertyActionListener value="#{material}" target="#{materialViewBean.activeMaterial}" />
                            <p:graphicImage value="#{location.ICON}/etool16/validate.gif" />
                        </p:commandLink>
                        <p:commandLink title="编辑" update=":dialogForm:material"
                            actionListener="#{materialViewBean.setMaterialDialogEnable}"
                            oncomplete="materialDialog.show();">
                            <p:graphicImage value="#{location.ICON}/etool16/editor_area.gif" />
                            <f:setPropertyActionListener value="#{material}" target="#{materialViewBean.activeMaterial}" />
                        </p:commandLink>
                        <p:commandLink title="删除" oncomplete="deleteMaterialConfirm.show()">
                            <p:graphicImage value="#{location.ICON}/etool16/delete_edit.gif" />
                            <f:setPropertyActionListener value="#{material}" target="#{materialViewBean.activeMaterial}" />
                        </p:commandLink>
                        <p:commandLink title="附件管理" oncomplete="attachementsDialog.show();"
                            update=":attachForm:attachments">
                            <p:graphicImage value="#{location.ICON}/etool16/annotate.gif" />
                            <f:setPropertyActionListener value="#{material}" target="#{materialViewBean.activeMaterial}" />
                        </p:commandLink>
                    </p:column>
                </p:dataTable>
            </t:panelGrid>
        </h:form>

        <h:form id="dialogForm">
            <p:dialog widgetVar="scaleDialog" height="300" width="400" modal="true">
                <p:panel id="scaleForm">
                    <t:panelGrid columns="2">
                        <h:outputText value="换算单位" />
                        <p:selectOneMenu value="#{materialViewBean.activeScaleItem.unit.displayId}" style="width:150px;">
                            <f:selectItem itemValue="" itemLabel="--选择单位--"/>
                            <f:selectItems value="#{materialViewBean.units}" />
                        </p:selectOneMenu>

                        <h:outputText value="换算率" />
                        <p:inputText value="#{materialViewBean.activeScaleItem.scale}" />
                    </t:panelGrid>
                    <p:commandButton value="确定" actionListener="#{materialViewBean.doAddScaleItem}"
                        update="dialogForm:scaleList" oncomplete="scaleDialog.hide();" />
                    <p:commandButton value="取消" onclick="scaleDialog.hide();" />
                </p:panel>
            </p:dialog>

            <p:dialog header="单位换算表" widgetVar="unitConvDialog" height="500" width="700" modal="true">
                <p:panel id="unitConvForm">
                    <t:panelGrid columns="2">
                        <h:outputText value="源单位:" />
                        <h:outputText value="#{materialViewBean.activeUnitConv.unit.label}" />
                    </t:panelGrid>
                    <hr/>
                    <h:outputText value="换算表:" />
                    <p:dataTable var="item" value="#{materialViewBean.activeUnitConv.itemList}" id="scaleList">
                        <p:column headerText="换算单位">
                            <h:outputText value="#{item.unit.label}" />
                        </p:column>
                        <p:column headerText="换算率">
                            <h:outputText value="#{item.scale}" />
                        </p:column>
                        <p:column headerText="操作" style="width:80px;">
                            <p:commandLink title="编辑" update="dialogForm:scaleForm" oncomplete="scaleDialog.show();">
                                <p:graphicImage value="#{location.ICON}/etool16/editor_area.gif" />
                                <f:setPropertyActionListener value="#{item}" target="#{materialViewBean.selectedScale}" />
                            </p:commandLink>
                            <p:commandLink title="删除" update="dialogForm:scaleList">
                                <p:graphicImage value="#{location.ICON}/etool16/delete_edit.gif" />
                                <p:collector value="#{item}" removeFrom="#{materialViewBean.activeUnitConv.itemList}" />
                            </p:commandLink>
                        </p:column>
                    </p:dataTable>
                    <p:commandButton value="添加条目" actionListener="#{materialViewBean.createScaleItem}"
                        oncomplete="scaleDialog.show();" update="dialogForm:scaleForm" />
                    <p:separator />
                    <p:commandButton value="确定" actionListener="#{materialViewBean.doSaveUnitConv}"
                        oncomplete="unitConvDialog.hide();" update="dialogForm:selectUnitConv,dialogForm:unitConvForm" />
                    <p:commandButton value="取消" onclick="unitConvDialog.hide();" />
                    <br />
                    <h:outputText value="例如:" />
                    <br />
                    <h:outputText value="源单位:'米', 换算单位:'千克', 换算率:'0.08'. 一米 = 0.08千克" />
                </p:panel>
            </p:dialog>


            <p:dialog header="基础价格" widgetVar="materialPrice" height="400" width="600" modal="true">
                <p:panel>
                    <t:panelGrid columns="4" id="temp">
                        <h:outputText value="设置价格:" />
                        <p:inputText value="#{materialViewBean.value}" />

                        <h:outputText value="币种:" />
                        <p:selectOneMenu value="#{materialViewBean.currencyCode}" style="width:170px;">
                            <f:selectItems value="#{materialViewBean.currencies}" />
                        </p:selectOneMenu>
                    </t:panelGrid>
                    <p:commandButton value="添加" oncomplete="addPriceConfirm.show();" update="dialogForm:tempConfirm" />
                    <p:separator />
                    <h:outputText value="历史价格表:" />
                    <p:dataTable id="histPrice" var="item" value="#{materialViewBean.activeMaterial.prices}">
                        <p:column headerText="日期">
                            <h:outputText value="#{item.date}" />
                        </p:column>
                        <p:column headerText="价格">
                            <h:outputText value="#{item.price.value}" />
                        </p:column>
                        <p:column headerText="货币代码">
                            <h:outputText value="#{item.price.currency.currencyCode}" />
                        </p:column>
                    </p:dataTable>
                    <p:commandButton value="确定" update="dialogForm:currentPrice" oncomplete="materialPrice.hide();" />
                    <p:commandButton value="取消" onclick="materialPrice.hide();" />
                </p:panel>
            </p:dialog>

            <p:dialog header="自定义属性" widgetVar="attributeDialog" height="200" width="300" modal="true">
                <t:panelGrid columns="2" id="attribute">
                    <h:outputText value="属性名称" />
                    <p:inputText value="#{materialViewBean.activeAttr.name}" />

                    <h:outputText value="属性值" />
                    <p:inputText value="#{materialViewBean.activeAttr.value}" />

                    <p:commandButton value="确定" actionListener="#{materialViewBean.doAddAttr}"
                        update="dialogForm:attributeTable" oncomplete="attributeDialog.hide();" />
                    <p:commandButton value="取消" onclick="attributeDialog.hide();" />
                </t:panelGrid>
            </p:dialog>

            <p:dialog widgetVar="unitDialog" header="添加单位" height="300" width="270" modal="true">
                <t:panelGrid columns="3">
                    <h:outputText value="国际单位代码:" />
                    <t:panelGroup colspan="2">
                        <p:inputText value="#{materialViewBean.newUnit.name}" />
                    </t:panelGroup>
                    <h:outputText value="中文单位名称:" />
                    <t:panelGroup colspan="2">
                        <p:inputText value="#{materialViewBean.newUnit.label}" />
                    </t:panelGroup>
                    <h:outputText value="基本单位:" />
                    <t:panelGroup colspan="2">
                        <p:selectOneMenu value="#{materialViewBean.newUnit.stdUnit.id}" style="width:100px;">
                            <f:selectItems value="#{materialViewBean.standardUnits}" />
                            <f:selectItem itemLabel="" itemValue="" />
                        </p:selectOneMenu>
                    </t:panelGroup>
                    <h:outputText value="倍率:" />
                    <t:panelGroup colspan="2">
                        <p:inputText value="#{materialViewBean.newUnit.scale}" />
                    </t:panelGroup>
                    <t:panelGroup colspan="3">
                        <p:commandButton value="确定" actionListener="#{materialViewBean.doAddUhnit}"
                            update="dialogForm:selectUnit" oncomplete="unitDialog.hide();" />
                        <p:commandButton value="取消" onclick="unitDialog.hide();" />
                    </t:panelGroup>
                </t:panelGrid>
            </p:dialog>

            <p:dialog header="推荐库位" widgetVar="preferDialog" height="400" width="600" modal="true">
                <t:panelGrid columns="5" id="toUpdate">
                    <h:outputText value="库位:" />
                    <p:inputText value="#{materialViewBean.activePreferredLocation.location.address}" readonly="true" />
                    <h:outputText value="仓库:" />
                    <p:inputText value="#{materialViewBean.activePreferredLocation.location.warehouse.name}"
                        readonly="true" />
                    <p:commandButton value="..." title="选择库位" onclick="stockLocationTreeDialog.show();" />
                    <h:outputText value="备注:" />
                    <t:panelGroup colspan="4">
                        <p:inputTextarea value="#{materialViewBean.activePreferredLocation.description}"
                            style="width:300px;height:40px;" />
                    </t:panelGroup>
                </t:panelGrid>
                <p:commandButton value="添加" actionListener="#{materialViewBean.doAddPreferredLocation}"
                    update="dialogForm:preferredLocations" oncomplete="preferDialog.hide();" />
                <p:commandButton value="取消" onclick="preferDialog.hide();" />
            </p:dialog>

            <p:dialog header="仓库设置" widgetVar="optionDialog" height="300" width="400" modal="true">
                <t:panelGrid columns="2" id="option">
                    <h:outputText value="仓库:" />
                    <p:selectOneMenu value="#{materialViewBean.activeOption.warehouse.id}" style="width:150px;">
                        <f:selectItems value="#{materialViewBean.warehouses}" />
                    </p:selectOneMenu>

                    <h:outputText value="安全库存:" />
                    <p:inputText value="#{materialViewBean.activeOption.safetyStock}" />

                    <h:outputText value="循环盘点周期" />
                    <p:inputText value="#{materialViewBean.activeOption.stkPeriod}" />
                </t:panelGrid>
                <p:commandButton value="保存" actionListener="#{materialViewBean.doAddOption}"
                    oncomplete="optionDialog.hide();" update="dialogForm:optionTable" />
                <p:commandButton value="取消" onclick="optionDialog.hide();" />
            </p:dialog>



            <p:dialog id="materialDialog" header="物料" widgetVar="materialDialog" height="600" width="800" modal="true">
                <t:panelGrid columns="5" id="material"
                    columnClasses="material_dialog_label, material_dialog_txt,material_dialog_label, material_dialog_txt">

                    <h:outputText value="物料分类:" />
                    <t:panelGroup colspan="4">
                        <p:inputText id="materialCategory" value="#{materialViewBean.activeMaterial.category.name}"
                            readonly="true" />
                        <p:commandButton value="..." title="选择物料分类" onclick="categoryTreeDialog.show();"
                            disabled="#{materialViewBean.editable}" />
                    </t:panelGroup>

                    <h:outputText value="物料名称" />
                    <t:panelGroup colspan="4">
                        <p:inputText value="#{materialViewBean.activeMaterial.label}"
                            readonly="#{materialViewBean.editable}" style="width:430px;" />
                    </t:panelGroup>

                    <h:outputText value="条形码:" />
                    <p:inputText value="#{materialViewBean.activeMaterial.barCode}"
                        readonly="#{materialViewBean.editable}" />
                    <t:panelGroup colspan="3"/>

                    <h:outputText value="规格型号:" />
                    <t:panelGroup colspan="4">
                        <p:inputText value="#{materialViewBean.activeMaterial.modelSpec}"
                            readonly="#{materialViewBean.editable}" style="width:430px;" />
                    </t:panelGroup>

                    <h:outputText value="毛重(克):" />
                    <p:inputText value="#{materialViewBean.activeMaterial.packageWeight}"
                        readonly="#{materialViewBean.editable}" />
                    <h:outputText value="净重(克):" />
                    <p:inputText value="#{materialViewBean.activeMaterial.netWeight}"
                        readonly="#{materialViewBean.editable}" />
                    <t:panelGroup />

                    <h:outputText value="装箱尺寸:" />
                    <t:panelGroup colspan="4">
                        <h:outputText value="长" />
                        <p:inputText value="#{materialViewBean.activeMaterial.packageLength}" style="width:50px;"
                            readonly="#{materialViewBean.editable}" />
                        <h:outputText value=" X 宽" />
                        <p:inputText value="#{materialViewBean.activeMaterial.packageWidth}" style="width:50px;"
                            readonly="#{materialViewBean.editable}" />
                        <h:outputText value=" X 高" />
                        <p:inputText value="#{materialViewBean.activeMaterial.packageHeight}" style="width:50px;"
                            readonly="#{materialViewBean.editable}" />
                        <h:outputText value=" (厘米)" />
                    </t:panelGroup>

                    <h:outputText value="当前价格:" />
                    <h:outputText id="currentPrice" value="#{materialViewBean.activeMaterialPrice}" />
                    <t:panelGroup colspan="3">
                        <p:commandButton value="..." title="设置价格" actionListener="#{materialViewBean.createPriceForm}"
                            oncomplete="materialPrice.show();" disabled="#{materialViewBean.editable}"
                            update="dialogForm:temp,dialogForm:histPrice" />
                    </t:panelGroup>



                    <h:outputText value="主单位:" />
                    <t:panelGroup>
                        <p:selectOneMenu id="selectUnit"
                            widgetVar="selectUnit"
                            value="#{materialViewBean.selectedUnit}"
                            disabled="#{materialViewBean.editable}"
                            style="width:150px;"
                            update="dialogForm:selectUnitConv">
                            <f:selectItem itemLabel="--选择单位--"
                                itemValue="" />
                            <f:selectItem itemLabel="新增单位"
                                itemValue="new" />
                            <f:selectItems
                                value="#{materialViewBean.units}" />
                            <p:ajax
                                listener="#{materialViewBean.doSelectedUnit}"
                                update="dialogForm:unitConvForm" />
                        </p:selectOneMenu>
                        <h:outputScript>
                            jQuery(document).ready(function(){
                                selectUnit.jq.change(function() {
                                    if(document.getElementById("dialogForm:selectUnit_input").value == "new"){
                                        unitDialog.show();
                                    }
                                });
                            });
                        </h:outputScript>
                    </t:panelGroup>
                    <h:outputText value="单位提示:" />
                    <p:inputText value="#{materialViewBean.activeMaterial.unitHint}"
                        readonly="#{materialViewBean.editable}" />
                    <h:outputText value="(重量,长度等)" />

                    <h:outputText value="单位换算表:" />
                    <t:panelGroup colspan="4">
                        <p:commandButton value="..."
                            actionListener="#{materialViewBean.newUnitConv}"
                            oncomplete="unitConvDialog.show()"
                            update="dialogForm:unitConvForm" />
                    </t:panelGroup>

                    <h:outputText value="自定义属性:" />
                    <t:panelGroup colspan="3">
                        <p:dataTable id="attributeTable" var="attr"
                            value="#{materialViewBean.activeMaterial.attributes}">
                            <p:column headerText="名称">
                                <h:outputText value="#{attr.name}" />
                            </p:column>
                            <p:column headerText="值">
                                <h:outputText value="#{attr.value}" />
                            </p:column>
                            <p:column headerText="操作" style="width:80px;">
                                <p:commandLink title="编辑" oncomplete="attributeDialog.show();"
                                    update="dialogForm:attribute" disabled="#{materialViewBean.editable}">
                                    <p:graphicImage value="#{location.ICON}/etool16/editor_area.gif" />
                                    <f:setPropertyActionListener value="#{attr}" target="#{materialViewBean.activeAttr}" />
                                </p:commandLink>
                                <p:commandLink title="删除" disabled="#{materialViewBean.editable}"
                                    update="dialogForm:attributeTable">
                                    <p:graphicImage value="#{location.ICON}/etool16/delete_edit.gif" />
                                    <p:collector value="#{attr}"
                                        removeFrom="#{materialViewBean.activeMaterial.attributes}" />
                                </p:commandLink>
                            </p:column>
                        </p:dataTable>
                    </t:panelGroup>
                    <p:commandButton value="..." title="增加属性" disabled="#{materialViewBean.editable}"
                        oncomplete="attributeDialog.show();" update="dialogForm:attribute" />

                    <h:outputText value="推荐库位:" />
                    <t:panelGroup colspan="3">
                        <p:dataTable id="preferredLocations" var="preferredLocation"
                            value="#{materialViewBean.activeMaterial.preferredLocations}">
                            <p:column headerText="仓库">
                                <h:outputText value="#{preferredLocation.location.warehouse.name}" />
                            </p:column>
                            <p:column headerText="库位">
                                <h:outputText value="#{preferredLocation.location.address}" />
                            </p:column>
                            <p:column headerText="备注">
                                <h:outputText value="#{preferredLocation.description}" />
                            </p:column>
                            <p:column headerText="操作" style="width:80px;">
                                <p:commandLink title="编辑" disabled="#{materialViewBean.editable}"
                                    oncomplete="preferDialog.show();" update="dialogForm:toUpdate">
                                    <p:graphicImage value="#{location.ICON}/etool16/editor_area.gif" />
                                    <f:setPropertyActionListener value="#{preferredLocation}"
                                        target="#{materialViewBean.activePreferredLocation}" />
                                </p:commandLink>
                                <p:commandLink title="删除" disabled="#{materialViewBean.editable}"
                                    update="dialogForm:preferredLocations">
                                    <p:graphicImage value="#{location.ICON}/etool16/delete_edit.gif" />
                                    <p:collector value="#{preferredLocation}"
                                        removeFrom="#{materialViewBean.activeMaterial.preferredLocations}" />
                                </p:commandLink>
                            </p:column>
                        </p:dataTable>
                    </t:panelGroup>
                    <p:commandButton value="..." title="添加推荐库位" disabled="#{materialViewBean.editable}"
                        onclick="preferDialog.show();" />

                    <h:outputText value="仓库设置:" />
                    <t:panelGroup colspan="3">
                        <p:dataTable id="optionTable" var="opt" value="#{materialViewBean.activeMaterial.options}">
                            <p:column headerText="仓库">
                                <h:outputText value="#{opt.warehouse.name}" />
                            </p:column>
                            <p:column headerText="安全库存">
                                <h:outputText value="#{opt.safetyStock}" />
                            </p:column>
                            <p:column headerText="循环盘点周期" style="width:100px;">
                                <h:outputText value="#{opt.stkPeriod}" />
                            </p:column>
                            <p:column headerText="操作" style="width:80px;">
                                <p:commandLink title="编辑" disabled="#{materialViewBean.editable}"
                                    update="dialogForm:option" oncomplete="optionDialog.show();">
                                    <f:setPropertyActionListener value="#{opt}"
                                        target="#{materialViewBean.activeOption}" />
                                    <p:graphicImage value="#{location.ICON}/etool16/editor_area.gif" />
                                </p:commandLink>
                                <p:commandLink title="删除" disabled="#{materialViewBean.editable}"
                                    update="dialogForm:optionTable">
                                    <p:graphicImage value="#{location.ICON}/etool16/delete_edit.gif" />
                                    <p:collector value="#{opt}" removeFrom="#{materialViewBean.activeMaterial.options}" />
                                </p:commandLink>
                            </p:column>
                        </p:dataTable>
                    </t:panelGroup>
                    <p:commandButton value="..." title="添加物料设置" disabled="#{materialViewBean.editable}"
                        onclick="optionDialog.show();" />

                    <t:panelGroup id="btn1" colspan="5">
                        <p:commandButton value="保存" actionListener="#{materialViewBean.doAddMaterial}"
                            update=":main:materialList, dialogForm:btn1, " disabled="#{materialViewBean.editable}"
                            oncomplete="materialDialog.hide(); " />
                        <p:commandButton value="取消" disabled="#{materialViewBean.editable}"
                            onclick="materialDialog.hide();" />
                    </t:panelGroup>
                </t:panelGrid>

            </p:dialog>




            <p:dialog header="选择物料分类(右击选择)" widgetVar="categoryTreeDialog" height="480" width="640" modal="true">

                <h:panelGrid columns="1">
                    <p:treeTable id="categoryTree"
                        value="#{materialViewBean.selectCategoryTree.rootNode}"
                        var="node" dynamic="true" selectionMode="single"
                        selection="#{materialViewBean.selectCategoryTree.selectedNode}"
                        scrollable="true"
                        scrollHeight="380" scrollWidth="400">

                        <p:column>
                            <f:facet name="header">分类名称</f:facet>
                            <h:outputText value="#{node.name}" />
                        </p:column>
                    </p:treeTable>
                    <t:panelGrid columns="2">
                        <p:commandButton value="选择"
                            update=":dialogForm:materialCategory"
                            actionListener="#{materialViewBean.doSelectMaterialCategory}"
                            oncomplete="categoryTreeDialog.hide();" />
                        <p:commandButton value="取消"
                            onclick="categoryTreeDialog.hide();" />
                    </t:panelGrid>
                </h:panelGrid>
            </p:dialog>

            <p:dialog widgetVar="stockLocationTreeDialog" header="选择库位" height="500" width="700" modal="true">
                <p:tree value="#{materialViewBean.stockLocationTreeDialog.rootNode}" var="node" dynamic="true"
                    selectionMode="single" selection="#{materialViewBean.stockLocationTreeDialog.selectedNode}"
                    style="width:100%">
                    <p:treeNode>
                        <h:outputText value="#{node.nodeText}" />
                    </p:treeNode>
                </p:tree>
                <p:commandButton value="选择" actionListener="#{materialViewBean.doSelectStockLocation}"
                    update="dialogForm:toUpdate" oncomplete="stockLocationTreeDialog.hide();" />
                <p:commandButton value="取消" onclick="stockLocationTreeDialog.hide()" />
            </p:dialog>

            <p:confirmDialog message="您确定要删除此物料吗?" header="注意" severity="alert" widgetVar="deleteMaterialConfirm">

                <p:commandButton value="删除" update=":main:materialList" oncomplete="deleteMaterialConfirm.hide()"
                    actionListener="#{materialViewBean.destroyMaterial}" />
                <p:commandButton value="取消" onclick="deleteMaterialConfirm.hide()" type="button" />

            </p:confirmDialog>

            <p:dialog header="提示" severity="alert" widgetVar="addPriceConfirm" modal="true">

                <t:panelGrid columns="2" id="tempConfirm">
                    <h:outputText value="确认价格:" />
                    <h:outputText value="#{materialViewBean.value}" />

                    <h:outputText value="确认货币代码:" />
                    <h:outputText value="#{materialViewBean.currencyCode}" />
                </t:panelGrid>
                <p:commandButton value="确定" actionListener="#{materialViewBean.doAddMCValue}"
                    update="dialogForm:histPrice" oncomplete="addPriceConfirm.hide();" />
                <p:commandButton value="取消" onclick="addPriceConfirm.hide();" />

            </p:dialog>

        </h:form>
        <h:form id="attachForm" enctype="multipart/form-data">

            <p:dialog widgetVar="attachementsDialog" header="物料附件管理" width="600" height="400" modal="true">
                <t:panelGrid id="attachments" columns="2" columnClasses="material_dialog_label, material_dialog_txt"
                    style="width:100%">
                    <h:outputText value="附件列表:" />
                    <p:dataTable id="attachList" value="#{materialViewBean.activeMaterial.attachments}" var="attachment">
                        <p:column headerText="">
                            <a href="#{location.WEB_APP}/3/15/1/6/file/view.do?id=#{attachment.id}"> <h:graphicImage
                                    value="/3/15/1/6/file/view.do?id=#{attachment.id}" width="24" height="24" /> </a>
                        </p:column>

                        <p:column headerText="操作" style="width:80px;">
                            <p:commandLink title="删除" update="attachList">
                                <p:graphicImage value="#{location.ICON}/etool16/delete_edit.gif" />
                                <p:collector value="#{attachment}"
                                    removeFrom="#{materialViewBean.activeMaterial.attachments}" />
                            </p:commandLink>

                            <a href="#{location.WEB_APP}/3/15/1/6/file/download.do?id=#{attachment.id}"> <p:graphicImage
                                    value="#{location.ICON}/etool16/group_by_file.gif" /> </a>

                        </p:column>
                    </p:dataTable>
                    <t:panelGroup colspan="2">
                        <p:fileUpload fileUploadListener="#{materialViewBean.handleFileUpload}" mode="advanced"
                            update="attachList" multiple="true" label="上传附件" allowTypes="${viewConfig.allowTypes}" />
                    </t:panelGroup>
                </t:panelGrid>
                <t:panelGroup colspan="2">
                    <p:commandButton value="保存" actionListener="#{materialViewBean.doAddMaterial}"
                        oncomplete="attachementsDialog.hide(); " />
                    <p:commandButton value="取消" onclick="attachementsDialog.hide();" />
                </t:panelGroup>
            </p:dialog>
        </h:form>

    </ui:define>
</ui:composition>
</html>