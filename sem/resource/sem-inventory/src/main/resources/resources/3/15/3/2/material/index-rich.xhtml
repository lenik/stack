<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:pc="http://bee32.com/plover/core"
    xmlns:sem="http://bee32.com/sem/functions" xmlns:p="http://primefaces.prime.com.tr/ui"
    xmlns:t="http://myfaces.apache.org/tomahawk">
<!-- InstanceBegin template="/Templates/seccaJsf.dwt.jsp" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>

<ui:composition template="/template/primefaces.xhtml">

    <ui:define name="title">material</ui:define>

    <ui:define name="content">

        <h:form id="note">
            <p:growl id="growl" showDetail="true" />
        </h:form>

        <h:form id="main">

            <p:layout style="min-width:400px;min-height:200px;" id="layout">

                <p:layoutUnit position="north">
                    <p:commandButton value="新增物料" oncomplete="materialDialog.show();"
                        actionListener="#{materialViewBean.createMaterialForm}" update="dialogForm:material" />
                    <p:commandButton value="新增分类" actionListener="#{materialViewBean.createCategoryForm}" oncomplete="categoryDialog.show();"/>
                </p:layoutUnit>

                <p:layoutUnit position="west" header="物料树" resizable="true" size="200" minSize="40" collapsible="true">
                    <p:tree id="categoryTree" value="#{materialViewBean.materialCategoryTree.rootNode}" var="node"
                        dynamic="true" selectionMode="single"
                        selection="#{materialViewBean.materialCategoryTree.selectedNode}" style="width:150px;">
                        <p:ajax event="select" listener="#{materialViewBean.materialCategoryTree.onNodeSelect}"
                            update="main:materialList" />
                        <p:treeNode>
                            <h:outputText value="#{node.name}" />
                        </p:treeNode>
                    </p:tree>
                </p:layoutUnit>

                <p:layoutUnit position="center">
                    <p:dataTable var="material" value="#{materialViewBean.materialList}" id="materialList">
                        <p:column headerText="物料名称">
                            <h:outputText value="#{material.name}" />
                        </p:column>
                        <p:column headerText="序列号">
                            <h:outputText value="#{material.serial}" />
                        </p:column>
                        <p:column headerText="条形码">
                            <h:outputText value="#{material.barCode}" />
                        </p:column>
                        <p:column headerText="基本单位">
                            <h:outputText value="#{material.unit.name}" />
                        </p:column>
                        <p:column headerText="操作">
                            <p:commandLink value="详细"></p:commandLink>
                            <p:commandLink value="编辑"></p:commandLink>
                        </p:column>
                    </p:dataTable>
                </p:layoutUnit>
            </p:layout>

        </h:form>

        <h:form id="dialogForm">

            <p:dialog header="添加物料" widgetVar="materialDialog" height="600" width="700">
                <t:panelGrid columns="5" id="material">
                    <h:outputText value="物料名称" />
                    <t:panelGroup colspan="4">
                        <p:inputText value="#{materialViewBean.activeMaterial.name}" style="width:400px;" />
                    </t:panelGroup>

                    <h:outputText value="序列号:" />
                    <p:inputText value="#{materialViewBean.activeMaterial.serial}" />
                    <h:outputText value="条形码:" />
                    <p:inputText widgetVar="ttt" value="#{materialViewBean.activeMaterial.barCode}" />
                    <h:inputHidden value="" />

                    <h:outputText value="物料分类:" />
                    <t:panelGroup colspan="4">
                        <p:inputText id="materialCategory" value="#{materialViewBean.activeMaterial.category.name}"
                            readonly="true" />
                        <p:commandButton value="..." title="选择物料分类" onclick="categoryTreeDialog.show();" />
                    </t:panelGroup>

                    <h:outputText value="单位类型:" />
                    <p:inputText value="#{materialViewBean.activeMaterial.unitHint}" />
                    <h:outputText value="基础单位:" />
                    <p:selectOneMenu id="selectUnit" widgetVar="selectUnit"
                        value="#{materialViewBean.activeMaterial.unit.name}" style="width:120px;">
                        <f:selectItem itemLabel="新增单位" itemValue="new" />
                        <f:selectItems value="#{materialViewBean.units}" />
                    </p:selectOneMenu>
                    <h:inputHidden value="" />

                    <h:outputText value="单位还算表" />
                    <t:panelGroup colspan="4">
                        <p:selectOneMenu id="selectUnitConv" widgetVar="selectUnitConv"
                            value="#{materialViewBean.activeMaterial.unitConv.id}" style="width:180px;">
                            <f:selectItem itemLabel="新增单位还算表" itemValue="new" />
                            <f:selectItems value="#{materialViewBean.unitConvs}" />
                        </p:selectOneMenu>
                    </t:panelGroup>

                    <h:outputText value="自定义属性:" />
                    <t:panelGroup colspan="3">
                        <p:dataTable id="attributeTable" var="attr"
                            value="#{materialViewBean.activeMaterial.attributes}">
                            <p:column headerText="名称">
                                <h:outputText value="#{attr.name}" />
                            </p:column>
                            <p:column headerText="值">
                                <h:outputText value="#{attr.value}" />
                            </p:column>
                            <p:column headerText="操作" style="width:80px;">
                                <p:commandLink value="编辑" />
                                <p:commandLink value="删除" />
                            </p:column>
                        </p:dataTable>
                    </t:panelGroup>
                    <p:commandButton value="..." title="增加属性" oncomplete="attributeDialog.show();"
                        update="dialogForm:attribute" />

                    <h:outputText value="推荐库位" />
                    <t:panelGroup colspan="3">
                        <p:dataTable id="preferredLocations" var="location"
                            value="#{materialViewBean.activeMaterial.preferredLocations}">
                            <p:column headerText="仓库">
                                <h:outputText value="#{location.location.warehouse.name}" />
                            </p:column>
                            <p:column headerText="库位">
                                <h:outputText value="#{location.location.address}" />
                            </p:column>
                            <p:column headerText="备注">
                                <h:outputText value="#{location.description}" />
                            </p:column>
                            <p:column headerText="操作" style="width:80px;">
                                <p:commandLink value="编辑" />
                                <p:commandLink value="删除" />
                            </p:column>
                        </p:dataTable>
                    </t:panelGroup>
                    <p:commandButton value="..." title="添加推荐库位" onclick="preferDialog.show();" />

                    <h:outputText value="物料设置:" />
                    <t:panelGroup colspan="3">
                        <p:dataTable id="optionTable" var="opt" value="#{materialViewBean.activeMaterial.options}">
                            <p:column headerText="仓库">
                                <h:outputText value="#{opt.warehouse.name}" />
                            </p:column>
                            <p:column headerText="安全库存">
                                <h:outputText value="#{opt.safetyStock}" />
                            </p:column>
                            <p:column headerText="循环盘点周期">
                                <h:outputText value="#{opt.stkPeriod}" />
                            </p:column>
                            <p:column headerText="操作" style="width:80px;">
                                <p:commandLink value="编辑" />
                                <p:commandLink value="删除" />
                            </p:column>
                        </p:dataTable>
                    </t:panelGroup>
                    <p:commandButton value="..." title="添加物料设置" onclick="optionDialog.show();" />

                    <p:commandButton value="保存" actionListener="#{materialViewBean.doAddMaterial}"
                        update="main:categoryTree,main:materialList" oncomplete="materialDialog.hide();" />
                    <p:commandButton value="取消" onclick="materialDialog.hide();" />
                </t:panelGrid>
            </p:dialog>

            <p:dialog header="添加属性" widgetVar="attributeDialog" height="200" width="300">
                <t:panelGrid columns="2" id="attribute">
                    <h:outputText value="属性名称" />
                    <p:inputText value="#{materialViewBean.activeAttr.name}" />

                    <h:outputText value="属性值" />
                    <p:inputText value="#{materialViewBean.activeAttr.value}" />

                    <p:commandButton value="添加" actionListener="#{materialViewBean.doAddAttr}"
                        update="dialogForm:attributeTable,note" oncomplete="attributeDialog.hide();" />
                    <p:commandButton value="取消" onclick="attributeDialog.hide();" />
                </t:panelGrid>
            </p:dialog>

            <p:dialog widgetVar="unitDialog" header="添加单位" height="300" width="270">
                <t:panelGrid columns="3">
                    <h:outputText value="代码:" />
                    <t:panelGroup colspan="2">
                        <p:inputText value="#{materialViewBean.newUnit.name}" />
                    </t:panelGroup>
                    <h:outputText value="名称:" />
                    <t:panelGroup colspan="2">
                        <p:inputText value="#{materialViewBean.newUnit.label}" />
                    </t:panelGroup>
                    <h:outputText value="基本单位:" />
                    <t:panelGroup colspan="2">
                        <p:selectOneMenu value="#{materialViewBean.newUnit.stdUnit.id}" style="width:100px;">
                            <f:selectItems value="#{materialViewBean.standardUnits}" />
                        </p:selectOneMenu>
                    </t:panelGroup>
                    <h:outputText value="倍率:" />
                    <t:panelGroup colspan="2">
                        <p:inputText value="#{materialViewBean.newUnit.scale}" />
                    </t:panelGroup>
                    <t:panelGroup colspan="3">
                        <p:commandButton value="确定" actionListener="#{materialViewBean.doAddUhnit}"
                            update="dialogForm:selectUnit" oncomplete="unitDialog.hide();" />
                        <p:commandButton value="取消" onclick="unitDialog.hide();" />
                    </t:panelGroup>
                </t:panelGrid>
            </p:dialog>

            <p:dialog header="添加推荐库位" widgetVar="preferDialog" height="400" width="600">
                <t:panelGrid columns="5" id="toUpdate">
                    <h:outputText value="库位:" />
                    <p:inputText value="#{materialViewBean.tempPreferredLocation.location.address}" readonly="true" />
                    <h:outputText value="仓库:" />
                    <p:inputText value="#{materialViewBean.tempPreferredLocation.location.warehouse.name}"
                        readonly="true" />
                    <p:commandButton value="..." title="选择库位" onclick="stockLocationTreeDialog.show();" />
                    <h:outputText value="备注:" />
                    <t:panelGroup colspan="4">
                        <p:inputTextarea value="#{materialViewBean.tempPreferredLocation.description}"
                            style="width:300px;height:40px;" />
                    </t:panelGroup>
                </t:panelGrid>
                <p:commandButton value="添加" actionListener="#{materialViewBean.doAddPreferredLocation}"
                    update="dialogForm:preferredLocations" oncomplete="preferDialog.hide();" />
                <p:commandButton value="取消" onclick="preferDialog.hide();" />
            </p:dialog>

            <p:dialog header="添加仓库设置" widgetVar="optionDialog" height="300" width="400">
                <t:panelGrid columns="2">
                    <h:outputText value="仓库:" />
                    <p:selectOneMenu value="#{materialViewBean.option.warehouse.id}" style="width:150px;">
                        <f:selectItems value="#{materialViewBean.warehouses}" />
                    </p:selectOneMenu>

                    <h:outputText value="安全库存:" />
                    <p:inputText value="#{materialViewBean.option.safetyStock}" />

                    <h:outputText value="循环盘点周期" />
                    <p:inputText value="#{materialViewBean.option.stkPeriod}" />
                </t:panelGrid>
                <p:commandButton value="保存" actionListener="#{materialViewBean.doAddOption}"
                    oncomplete="optionDialog.hide();" update="dialogForm:optionTable" />
                <p:commandButton value="取消" onclick="optionDialog.hide();" />
            </p:dialog>

            <p:dialog header="选择物料分类" widgetVar="categoryTreeDialog" height="500" width="700" modal="true">
                <p:tree value="#{materialViewBean.materialCategoryTree.rootNode}" var="node" dynamic="true"
                    selectionMode="single" selection="#{materialViewBean.materialCategoryTree.selectedCategory}"
                    style="width:150px;">
                    <p:treeNode>
                        <h:outputText value="#{node.name}" />
                    </p:treeNode>
                </p:tree>
                <p:commandButton value="选择" actionListener="#{materialViewBean.materialCategoryTree.onCategorySelect}"
                    update="dialogForm:materialCategory" oncomplete="categoryTreeDialog.hide();" />
                <p:commandButton value="取消" onclick="categoryTreeDialog.hide();" />
            </p:dialog>

            <p:dialog widgetVar="stockLocationTreeDialog" header="选择库位" height="500" width="700" modal="true">
                <p:tree value="#{materialViewBean.stockLocationTreeDialog.rootNode}" var="node" dynamic="true"
                    selectionMode="single" selection="#{materialViewBean.stockLocationTreeDialog.selectedNode}">
                    <p:treeNode>
                        <h:outputText value="#{node.nodeText}" />
                    </p:treeNode>
                </p:tree>
                <p:commandButton value="选择" actionListener="#{materialViewBean.stockLocationTreeDialog.select}"
                    update="preferredLocation:toUpdate" oncomplete="stockLocationTreeDialog.hide();" />
                <p:commandButton value="取消" onclick="stockLocationTreeDialog.hide()" />
            </p:dialog>

            <p:dialog widgetVar="unitConvDialog" header="新增单位还算表" height="400" width="500">
                <t:panelGrid columns="2">

                    <h:outputText value="代码:" />
                    <p:inputText value="" />

                    <h:outputText value="名称:" />
                    <p:inputText value="" />

                    <h:outputText value="源单位:" />
                    <p:selectOneMenu value="" style="width:150px;">
                        <f:selectItems value="" />
                    </p:selectOneMenu>

                    <h:outputText value="换算表:" />
                    <p:dataTable var="ratioMap" value="">
                        <p:column headerText="换算单位">
                            <h:outputText value="" />
                        </p:column>

                        <p:column headerText="还算率">
                            <h:outputText value="" />
                        </p:column>

                        <p:column headerText="操作">
                            <p:commandLink value="编辑" />
                            <p:commandLink value="删除" />
                        </p:column>
                    </p:dataTable>
                </t:panelGrid>
                <p:commandButton value="..." title="添加还算条目" />
            </p:dialog>

            <p:dialog id="categoryDialog" header="添加分类" widgetVar="categoryDialog" height="200" width="300">
                <t:panelGrid columns="2">
                    <h:outputText value="上级分类" />
                    <p:inputText value="#{materialViewBean.activeCategory.parent.name}" />

                    <h:outputText value="分类名称" />
                    <p:inputText value="#{materialViewBean.activeCategory.name}"/>

                    <h:outputText value="代码生成器:" />
                    <p:selectOneMenu value="#{materialViewBean.activeCategory.codeGenerator.name}" style="width:100px;">
                        <f:selectItems value="#{materialViewBean.codeGeneratories}" />
                    </p:selectOneMenu>
                </t:panelGrid>
                <p:commandButton value="添加" actionListener="#{materialViewBean.doAddMaterialCategory}" oncomplete="categoryDialog.hide()"/>
                <p:commandButton value="取消" onclick="categoryDialog.hide()" />
            </p:dialog>
        </h:form>

        <script type="text/javascript">
                                    jQuery(document)
                                            .ready(
                                                    function() {
                                                        function getElement(id) {
                                                            return document
                                                                    .getElementById(id);
                                                        }
                                                        selectUnit.jq
                                                                .change(function() {
                                                                    if (document
                                                                            .getElementById("dialogForm:selectUnit_input").value == "new")
                                                                        unitDialog
                                                                                .show();
                                                                });
                                                        selectUnitConv.jq
                                                                .change(function() {
                                                                    if (document
                                                                            .getElementById("dialogForm:selectUnitConv_input").value == "new")
                                                                        unitConvDialog
                                                                                .show();
                                                                });

                                                    });
                                </script>
    </ui:define>
</ui:composition>
</html>