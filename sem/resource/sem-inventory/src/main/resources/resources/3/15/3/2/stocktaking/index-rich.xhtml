<ui:composition template="../stock-template.xhtml" xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:fr="http://java.sun.com/jsf/composite/frame"
    xmlns:sem="http://java.sun.com/jsf/composite/3/15">

    <ui:param name="sideBarNVisible" value="true" />
    <ui:param name="bean" value="#{stocktakingAdminBean}" />
    <ui:param name="title" value="库存盘点" />

    <ui:define name="sideBarN">
        <t:panelGrid columns="2">
            <h:outputText value="盘点步骤:" />
            <h:panelGroup style="font-weight:bold;">
                1.选择需要盘点的物料,查询库存，形成盘点表
                <p:spacer width="10" />
                2.打印盘点表
                <p:spacer width="10" />
                3.实际库存盘点
                <p:spacer width="10" />
                4.录入盘点数据
                <p:spacer width="10" />
                5.保存
                <p:spacer width="20" />
                (重复第4,5步,直到录入完成)
            </h:panelGroup>
        </t:panelGrid>
    </ui:define>

    <ui:define name="edit-pre">
        <p:panel id="materials" header="需要盘点的物料" toggleable="true" collapsed="true">
            <t:panelGrid columns="5">
                <t:panelGrid columns="2">
                    <h:outputText value="盘点帐面数量查询日期" />
                    <p:calendar id="queryDate" navigator="true" locale="zh_CN" pattern="yyyy-MM-dd" value="#{bean.queryDate}"
                        showOn="button" />
                </t:panelGrid>
                <h:outputText value="物料" />
                <t:panelGrid columns="1">
                    <t:panelGrid columns="2">
                        <p:selectBooleanCheckbox value="#{bean.queryAllMaterials}" />
                        <h:outputText value="所有物料" />
                    </t:panelGrid>
                    <p:selectOneListbox id="queryMaterials" value="#{bean.selectedMaterialId}" style="height:200px;width:300px">
                        <f:selectItems value="#{bean.queryMaterialSelectItems}" />
                    </p:selectOneListbox>
                </t:panelGrid>
                <t:panelGrid columns="1">
                    <p:commandButton value="增加" onclick="addMaterialDialog.show();" />
                    <p:commandButton value="删除" actionListener="#{bean.removeQueryMaterial}" update="materials" />
                </t:panelGrid>
                <p:commandButton value="查询" />
            </t:panelGrid>
        </p:panel>
    </ui:define>

    <ui:define name="dialogs.1">
        <sem:chooseMaterialDialog id="addMaterialDialog" var="addMaterialDialog" target="#{bean.chosenMaterial}"
            actionListener="#{bean.addQueryMaterial}" update=":editDialog:form:materials" />
    </ui:define>

    <ui:define name="item-quantity">
        <h:outputLabel value="帐面数量" />
        <p:inputText value="#{item.expected}" readonly="true" />

        <h:outputLabel value="盘点数量" />
        <t:panelGroup colspan="3">
            <p:inputText value="#{item.quantity}" />
            <h:outputText value="#{item.material.unit.name}" />
            <p:commandButton id="inputQuantity" value="..." oncomplete="inputQuantityDialog.show()">
                <f:setPropertyActionListener target="#{inputQuantityDialogBean.unitUnit}"
                    value="#{item.material.unit}" />
                <f:setPropertyActionListener target="#{inputQuantityDialogBean.unitQuantity}"
                    value="#{item.quantity}" />
                <f:setPropertyActionListener target="#{inputQuantityDialogBean.unitConv}"
                    value="#{item.material.unitConv}" />
            </p:commandButton>
        </t:panelGroup>

        <h:outputLabel value="盈亏数量" />
        <t:panelGroup colspan="3">
            <p:inputText value="#{item.diff}" readonly="true" />
        </t:panelGroup>
    </ui:define>

</ui:composition>