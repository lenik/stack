<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:cc="http://java.sun.com/jsf/composite"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui">

    <cc:interface>
        <!-- basic -->
        <cc:attribute name="var" default="chooseStockLocationDialog" />
        <cc:attribute name="target" type="java.lang.Object" required="true" />
        <cc:attribute name="multiple" type="java.lang.Boolean" default="false" />
        <cc:attribute name="actionListener" targets="form:ok" />
        <cc:attribute name="update" />

        <!-- ui overrides -->
        <cc:attribute name="caption" default="${chooseStockLocationDialogBean.caption}" />
        <cc:attribute name="style" default="max-height: 40em; margin: 1em" />
        <cc:attribute name="mode" default="table" shortDescription="table, list, tree" />

        <!-- internals -->
        <cc:attribute name="dialogBean" type="java.lang.Object" default="${chooseStockLocationDialogBean}" />

        <!-- facets -->
        <cc:facet name="search" />
        <cc:facet name="columns" />
        <cc:facet name="buttons" />
    </cc:interface>

    <cc:implementation>
        <ui:decorate template="/template/simple-entity-dialog.xhtml">
            <ui:param name="mainTabHeader" value="所有库位" />
            <ui:param name="var" value="${cc.attrs.var}" />
            <ui:param name="target" value="${cc.attrs.target}" />
            <ui:param name="multiple" value="${cc.attrs.multiple}" />
            <ui:param name="update" value="${cc.attrs.update}" />
            <ui:param name="var" value="${cc.attrs.var}" />
            <ui:param name="caption" value="${cc.attrs.caption}" />
            <ui:param name="style" value="${cc.attrs.style}" />
            <ui:param name="dialogBean" value="${cc.attrs.dialogBean}" />

            <ui:define name="columns">
            </ui:define>

            <ui:define name="main">
                <p:tree value="#{takeAdminBean.locationRoot}" var="stockLocation" selectionMode="single"
                    selection="#{takeAdminBean.selectedStockLocationNode}">
                    <p:treeNode>
                        <h:outputText value="#{stockLocation.nodeText}" />
                    </p:treeNode>
                </p:tree>
            </ui:define>

            <ui:define name="moreTabs">
                <p:tab id="preferredLocations" header="预设库位">
                    <p:dataTable id="preferredLocations" var="stockLocation" value="#{takeAdminBean.preferredLocations}"
                        resizableColumns="true" selection="#{takeAdminBean.selectedPreferredStockLocation}"
                        selectionMode="single" rowKey="#{stockLocation.id}" rowIndexVar="rowIndex">
                        <p:column>
                            <f:facet name="header">库位</f:facet>
                            <h:outputText value="#{stockLocation.nodeText}" />
                        </p:column>
                        <p:column>
                            <f:facet name="header">所属仓库</f:facet>
                            <h:outputText value="#{stockLocation.warehouse.name}" />
                        </p:column>
                    </p:dataTable>
                </p:tab>
            </ui:define>

            <ui:define name="actions">
                <f:setPropertyActionListener target="${dialogBean.selectPreferredLocation}"
                    value="???" />
            </ui:define>

        </ui:decorate>
    </cc:implementation>
</html>
