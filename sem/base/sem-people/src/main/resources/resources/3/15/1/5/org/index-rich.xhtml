<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:pc="http://bee32.com/plover/core"
      xmlns:sem="http://bee32.com/sem/functions"
      xmlns:p="http://primefaces.prime.com.tr/ui"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      >
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>

<ui:composition template="/template/primefaces.xhtml">

    <ui:define name="title">客户/供应商管理</ui:define>


    <ui:define name="content">

        <h:outputStylesheet>
            .detail_col_title {
                width:150px;
                text-align: right;
            }

            .detail_col_value {
            }
        </h:outputStylesheet>

        <h:form id="orgForm">
            <p:growl id="growl" showDetail="true" />

            <p:panel header="客户/供应商管理">
                <p:toolbar id="orgToolbar">
                    <p:toolbarGroup align="left">
                        <p:commandButton value="新增"
                            actionListener="#{orgAdminBean.doNew}"
                            disabled="#{orgAdminBean.editable}"
                            update="orgForm" async="true" />
                        <p:commandButton value="修改"
                            actionListener="#{orgAdminBean.doModify}"
                            disabled="#{orgAdminBean.editable}"
                            update="orgForm" async="true" />
                        <p:commandButton value="删除"
                            actionListener="#{orgAdminBean.doDelete}"
                            disabled="#{orgAdminBean.editable}"
                            update="orgForm" async="true" />
                        <p:divider />
                        <p:commandButton value="保存"
                            actionListener="#{orgAdminBean.doSave}"
                            disabled="#{!orgAdminBean.editable}"
                            update="orgForm" async="true" />
                        <p:commandButton value="取消"
                            actionListener="#{orgAdminBean.doCancel}"
                            disabled="#{!orgAdminBean.editable}"
                            update="orgForm" async="true" />
                        <p:divider />
                        <!--
                        <p:commandButton value="审核"
                            disabled="#{orgAdminBean.editable or (not orgAdminBean.orgSelected)}"
                            onclick="verifyDlg.show();" /> -->
                        <p:commandButton value="详细"
                            actionListener="#{orgAdminBean.doDetail}"
                            disabled="#{orgAdminBean.editable or (not orgAdminBean.orgSelected)}"
                            update="orgForm" async="true" />
                    </p:toolbarGroup>
                </p:toolbar>
                <p:tabView id="orgTab" style="width:100%;"
                    activeIndex="#{orgAdminBean.activeTab}">
                    <p:tab id="orgList" title="客户/供应商列表">
                        <p:dataTable id="orgs" var="org"
                            value="#{orgAdminBean.orgs}" paginator="true"
                            rows="10" lazy="true"
                            paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                            rowsPerPageTemplate="5,10,15" resizableColumns="true"
                            selection="#{orgAdminBean.selectedOrg}"
                            selectionMode="single" rowIndexVar="rowIndex">

                            <p:ajax event="rowSelect"
                                listener="#{orgAdminBean.onRowSelect}"
                                update="orgForm:orgToolbar" />
                            <p:ajax event="rowUnselect"
                                listener="#{orgAdminBean.onRowUnselect}"
                                update="orgForm:orgToolbar" />

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="序号" />
                                </f:facet>
                                <h:outputText value="#{rowIndex + 1}" />
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="客户/供应商名称" />
                                </f:facet>
                                <h:outputText value="#{org.name}" />
                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="成立日期" />
                                </f:facet>
                                <h:outputText value="#{org.birthday}">
                                    <f:convertDateTime pattern="yyyy-MM-dd"
                                        timeZone="Asia/Shanghai" />
                                </h:outputText>
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="公司类型" />
                                </f:facet>
                                <h:outputText value="#{org.type.label}" />
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="税务登记号" />
                                </f:facet>
                                <h:outputText value="#{org.sid}" />
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="公司规模" />
                                </f:facet>
                                <h:outputText value="#{org.size}" />
                            </p:column>

                        </p:dataTable>
                    </p:tab>
                    <p:tab title="客户/供应商详细">

                        <h:inputHidden id="orgId" value="#{orgAdminBean.org.id}"/>

                        <t:panelGrid columns="4"
                            columnClasses="detail_col_title,detail_col_value,detail_col_title,detail_col_value">

                            <h:outputLabel for="orgTags" value="标签" />
							<t:panelGroup colspan="3">
							    <h:panelGrid columns="2">
									<p:selectOneListbox id="orgTags" value="#{orgAdminBean.selectedTagId}" style="height:100px; width:300px;">
										<f:selectItems value="#{orgAdminBean.org.tags}" var="tag"
											itemLabel="#{tag.label}" itemValue="#{tag.id}" />
									</p:selectOneListbox>
									<h:panelGrid colums="1">
										<p:commandButton value="增加标签"
											disabled="#{orgAdminBean.org == null}"
											onclick="tagDlg.show();" />
										<p:commandButton value="删除标签"
											disabled="#{orgAdminBean.org == null}"
											actionListener="#{orgAdminBean.deleteTag}"
											update="orgForm:orgTags"
											/>
									</h:panelGrid>
								</h:panelGrid>
							</t:panelGroup>


							<h:outputLabel for="orgName" value="客户/供应商名称" />
                            <p:inputText id="orgName" value="#{orgAdminBean.org.name}"/>
                            <h:outputLabel for="orgFullName" value="全名" />
                            <p:inputText id="orgFullName" value="#{orgAdminBean.org.fullName}"/>

                            <h:outputLabel for="orgBirthday" value="成立日期"/>
                            <p:calendar
                                    id="orgBirthday"
                                    navigator="true"
                                    locale="zh_CN"
                                    pattern="yyyy-MM-dd"
                                    value="#{orgAdminBean.org.birthday}"
                                    showOn="button" />
                            <h:outputLabel for="orgType" value="公司类型" />
                            <p:selectOneMenu id="orgType"
                                value="#{orgAdminBean.org.type.id}"
                                style="width:150px;">
                                <f:selectItem itemValue="" itemLabel="--选择公司类型--" />
                                <f:selectItems value="#{orgAdminBean.orgTypes}" />
                            </p:selectOneMenu>

                            <h:outputLabel for="orgSid" value="税务登记号" />
                            <p:inputText id="orgSid" value="#{orgAdminBean.org.sid}"/>
                            <h:outputLabel for="orgSize" value="公司规模" />
                            <p:inputText id="orgSize" value="#{orgAdminBean.org.size}"/>

                            <h:outputLabel for="orgInterests" value="主营业务" />
                            <t:panelGroup colspan="3">
                                <p:inputText id="orgInterests" value="#{orgAdminBean.org.interests}"/>
                            </t:panelGroup>

							<h:outputLabel for="orgMemo" value="备注" />
							<t:panelGroup colspan="3">
								<p:inputTextarea id="orgMemo"
									value="#{orgAdminBean.org.memo}"
									style="width:300px;height:100px;" effectDuration="400" />
							</t:panelGroup>
						</t:panelGrid>

                        <p:panel header="联系方式" toggleable="true">
                            <p:toolbar id="contactToolbar">
                                <p:toolbarGroup align="left">
                                    <p:commandButton value="新增"
                                        disabled="#{orgAdminBean.org == null or orgAdminBean.org.id == null}"
                                        actionListener="#{orgAdminBean.doNewContact}"
                                        update="contactForm:contactHolder" async="true"
                                        onclick="contactHolderDlg.show();" />
                                    <p:commandButton value="修改"
                                        actionListener="#{orgAdminBean.doModifyContact}"
                                        disabled="#{not orgAdminBean.contactSelected}"
                                        update="contactForm:contactHolder" async="true"
                                        onclick="contactHolderDlg.show();" />
                                    <p:commandButton value="删除"
                                        actionListener="#{orgAdminBean.doDeleteContact}"
                                        disabled="#{not orgAdminBean.contactSelected}"
                                        update="contacts growl"
                                        async="true" />
                                    <p:divider />
                                </p:toolbarGroup>
                            </p:toolbar>
                            <p:dataTable id="contacts" var="contact"
                                value="#{orgAdminBean.contacts}" resizableColumns="true"
                                selection="#{orgAdminBean.selectedContact}"
                                selectionMode="single" rowIndexVar="rowIndex">

                                <p:ajax event="rowSelect"
                                    listener="#{orgAdminBean.onRowSelectContact}"
                                    update="orgForm:contactToolbar" />
                                <p:ajax event="rowUnselect"
                                    listener="#{orgAdminBean.onRowUnselectContact}"
                                    update="orgForm:contactToolbar" />

                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="序号" />
                                    </f:facet>
                                    <h:outputText value="#{rowIndex + 1}" />
                                </p:column>

                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="地址" />
                                    </f:facet>
                                    <h:outputText value="#{contact.category.label}" />
                                </p:column>

                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="地址" />
                                    </f:facet>
                                    <h:outputText value="#{contact.address}" />
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="邮编" />
                                    </f:facet>
                                    <h:outputText value="#{contact.postCode}" />
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="电话" />
                                    </f:facet>
                                    <h:outputText value="#{contact.tel}" />
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="移动电话" />
                                    </f:facet>
                                    <h:outputText value="#{contact.mobile}" />
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="传真" />
                                    </f:facet>
                                    <h:outputText value="#{contact.fax}" />
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="email" />
                                    </f:facet>
                                    <h:outputText value="#{contact.email}" />
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="网址" />
                                    </f:facet>
                                    <h:outputText value="#{contact.website}" />
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="QQ" />
                                    </f:facet>
                                    <h:outputText value="#{contact.qq}" />
                                </p:column>
                            </p:dataTable>
                        </p:panel>

                        <p:panel header="相关人员" toggleable="true">
                            <p:toolbar id="roleToolbar">
                                <p:toolbarGroup align="left">
                                    <p:commandButton value="新增"
                                        disabled="#{orgAdminBean.org == null or orgAdminBean.org.id == null}"
                                        actionListener="#{orgAdminBean.doNewRole}"
                                        update="roleForm:roleHolder" async="true"
                                        onclick="roleHolderDlg.show();" />
                                    <p:commandButton value="修改"
                                        actionListener="#{orgAdminBean.doModifyRole}"
                                        disabled="#{not orgAdminBean.roleSelected}"
                                        update="roleForm:roleHolder" async="true"
                                        onclick="roleHolderDlg.show();" />
                                    <p:commandButton value="删除"
                                        actionListener="#{orgAdminBean.doDeleteRole}"
                                        disabled="#{not orgAdminBean.roleSelected}" update="roles growl"
                                        async="true" />
                                    <p:divider />
                                </p:toolbarGroup>
                            </p:toolbar>
                            <p:dataTable id="roles" var="role"
                                value="#{orgAdminBean.roles}" resizableColumns="true"
                                selection="#{orgAdminBean.selectedRole}"
                                selectionMode="single" rowIndexVar="rowIndex">

                                <p:ajax event="rowSelect"
                                    listener="#{orgAdminBean.onRowSelectRole}"
                                    update="orgForm:roleToolbar" />
                                <p:ajax event="rowUnselect"
                                    listener="#{orgAdminBean.onRowUnselectRole}"
                                    update="orgForm:roleToolbar" />

                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="序号" />
                                    </f:facet>
                                    <h:outputText value="#{rowIndex + 1}" />
                                </p:column>


                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="所在部门" />
                                    </f:facet>
                                    <h:outputText value="#{role.orgUnit}" />
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="职务" />
                                    </f:facet>
                                    <h:outputText value="#{role.role}" />
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="负责业务" />
                                    </f:facet>
                                    <h:outputText value="#{role.roleDetail}" />
                                </p:column>

                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="姓名" />
                                    </f:facet>
                                    <h:outputText value="#{role.person.name}" />
                                </p:column>

                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="性别" />
                                    </f:facet>
                                    <h:outputText value="#{role.person.sexText}" />
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="生日" />
                                    </f:facet>
                                    <h:outputText value="#{role.person.birthday}">
                                        <f:convertDateTime pattern="yyyy-MM-dd"
                                            timeZone="Asia/Shanghai" />
                                    </h:outputText>
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="证件类型" />
                                    </f:facet>
                                    <h:outputText value="#{role.person.sidType.label}" />
                                </p:column>

                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="证件号码" />
                                    </f:facet>
                                    <h:outputText value="#{role.person.sid}" />
                                </p:column>

                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="户籍" />
                                    </f:facet>
                                    <h:outputText value="#{role.person.censusRegister}" />
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                    </p:tab>
                </p:tabView>
            </p:panel>
        </h:form>


        <h:form id="contactForm">
            <p:dialog header="联系方式编辑" widgetVar="contactHolderDlg" modal="true" height="500" width="640">
                <h:panelGroup id="contactHolder">

                    <p:growl id="growl1" showDetail="true" />

                    <h:inputHidden id="contactId" value="#{orgAdminBean.contact.id}"/>
                    <t:panelGrid columns="4"
                        columnClasses="detail_col_title,detail_col_value,detail_col_title,detail_col_value">

                        <h:outputLabel for="contactCategory" value="分类" />
                        <t:panelGroup colspan="3">
                            <p:selectOneMenu id="contactCategory"
                                value="#{orgAdminBean.contact.category.id}"
                                style="width:200px;">
                                <f:selectItem itemValue="" itemLabel="--选择联系方式分类--" />
                                <f:selectItems value="#{orgAdminBean.contactCategories}" />
                            </p:selectOneMenu>
                        </t:panelGroup>

                        <h:outputLabel for="contactAddress" value="地址" />
                        <p:inputText id="contactAddress" value="#{orgAdminBean.contact.address}"/>
                        <h:outputLabel for="contactPostCode" value="邮编" />
                        <p:inputText id="contactPostCode" value="#{orgAdminBean.contact.postCode}"/>

                        <h:outputLabel for="contactTel" value="电话" />
                        <p:inputText id="contactTel" value="#{orgAdminBean.contact.tel}"/>
                        <h:outputLabel for="contactMobile" value="移动电话" />
                        <p:inputText id="contactMobile" value="#{orgAdminBean.contact.mobile}"/>

                        <h:outputLabel for="contactFax" value="传真" />
                        <p:inputText id="contactFax" value="#{orgAdminBean.contact.fax}"/>
                        <h:outputLabel for="contactEmail" value="email" />
                        <p:inputText id="contactEmail" value="#{orgAdminBean.contact.email}"/>

                        <h:outputLabel for="contactWebsite" value="网址" />
                        <p:inputText id="contactWebsite" value="#{orgAdminBean.contact.website}"/>
                        <h:outputLabel for="contactQq" value="qq" />
                        <p:inputText id="contactQq" value="#{orgAdminBean.contact.qq}"/>

                        <h:panelGroup />
                        <t:panelGroup colspan="2">
                            <t:panelGrid columns="2">
                                <p:commandButton value="保存"
                                    actionListener="#{orgAdminBean.doSaveContact}"
                                    oncomplete="contactHolderDlg.hide();" async="true"
                                    update="orgForm:contacts orgForm:growl" />
                                <p:commandButton value="取消"
                                    oncomplete="contactHolderDlg.hide();" />
                            </t:panelGrid>
                        </t:panelGroup>
                        <h:panelGroup />

                    </t:panelGrid>
                </h:panelGroup>

            </p:dialog>
        </h:form>

        <h:form id="tagForm">
            <p:dialog header="标签添加" widgetVar="tagDlg" modal="true" height="500" width="640">
                <h:panelGroup id="tagHolder">

                    <p:growl id="growl1" showDetail="true" />

                    <p:selectManyMenu value="#{orgAdminBean.selectedTagsToAdd}" style="height:300px">
			            <f:selectItems value="#{orgAdminBean.tags}" />
			        </p:selectManyMenu>

                </h:panelGroup>
                <t:panelGrid columns="2">
                    <p:commandButton value="添加"
                        actionListener="#{orgAdminBean.addTags}"
                        oncomplete="tagDlg.hide();" async="true"
                        update="orgForm:orgTags orgForm:growl" />
                    <p:commandButton value="取消"
                        oncomplete="tagDlg.hide();" />
                </t:panelGrid>

            </p:dialog>
        </h:form>





        <h:form id="roleForm">
            <p:dialog header="相关人员设置" widgetVar="roleHolderDlg" modal="true" height="500" width="640">
                <h:panelGroup id="roleHolder">

                    <p:growl id="growl2" showDetail="true" />

                    <h:inputHidden id="roldId" value="#{orgAdminBean.role.id}"/>
                    <h:inputHidden id="roldOrgId" value="#{orgAdminBean.role.org.id}" />
                    <h:inputHidden id="roldPersonId" value="#{orgAdminBean.role.person.id}" />
                    <t:panelGrid columns="2"
                        columnClasses="detail_col_title,detail_col_value">


                        <h:outputLabel for="roleOrgName" value="对应公司" />
                        <h:outputText id="roleOrgName" value="#{orgAdminBean.role.org.name}"/>


                        <h:outputLabel for="rolePersonName" value="对应人员" />
                        <t:panelGrid columns="2">
                            <h:outputText id="rolePersonName" value="#{orgAdminBean.role.person.name}"/>
                            <p:commandButton value="..." onclick="personHolderDlg.show();"/>
                        </t:panelGrid>


                        <h:outputLabel for="roleOrgUnit" value="所在部门" />
                        <p:inputText id="roleOrgUnit" value="#{orgAdminBean.role.orgUnit}"/>

                        <h:outputLabel for="roleRole" value="职务" />
                        <p:inputText id="roleRole" value="#{orgAdminBean.role.role}"/>

                        <h:outputLabel for="roleRoleDetail" value="负责业务" />
                        <p:inputText id="roleRoleDetail" value="#{orgAdminBean.role.roleDetail}"/>

                        <h:outputLabel for="roleDescription" value="备注" />
                        <p:inputTextarea id="roleDescription" value="#{orgAdminBean.role.description}"/>



                        <t:panelGroup colspan="2">
                            <t:panelGrid columns="2">
                                <p:commandButton value="保存"
                                    actionListener="#{orgAdminBean.doSaveRole}"
                                    oncomplete="roleHolderDlg.hide();" async="true"
                                    update="orgForm:roles orgForm:growl" />
                                <p:commandButton value="取消"
                                    oncomplete="roleHolderDlg.hide();" />
                            </t:panelGrid>
                        </t:panelGroup>
                    </t:panelGrid>
                </h:panelGroup>

            </p:dialog>

            <p:dialog header="选择联系人" widgetVar="personHolderDlg" modal="true" height="400" width="640">
                <h:panelGroup>

                    <h:panelGrid columns="3">
                        <h:outputLabel value="联系人名字全部或部份:"/>
                        <p:inputText value="#{orgAdminBean.personPattern}"/>
                        <p:commandButton value="查找" actionListener="#{orgAdminBean.findPerson}" update="persons"
                                         async="true"/>
                    </h:panelGrid>
                    <p:dataTable
                            id="persons"
                            var="person"
                            value="#{orgAdminBean.persons}"
                            resizableColumns="true"
                            selection="#{orgAdminBean.selectedPerson}"
                            selectionMode="single"
                            rowIndexVar="rowIndex">

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="序号"/>
                            </f:facet>
                            <h:outputText value="#{rowIndex + 1}"/>
                        </p:column>

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="姓名"/>
                            </f:facet>
                            <h:outputText value="#{person.name}"/>
                        </p:column>

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="性别"/>
                            </f:facet>
                            <h:outputText value="#{person.sexText}"/>
                        </p:column>

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="生日"/>
                            </f:facet>
                            <h:outputText value="#{person.birthday}">
                                <f:convertDateTime pattern="yyyy-MM-dd"
                                                   timeZone="Asia/Shanghai"/>
                            </h:outputText>
                        </p:column>

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="证件类型"/>
                            </f:facet>
                            <h:outputText value="#{person.sidType.label}"/>
                        </p:column>

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="证件号码"/>
                            </f:facet>
                            <h:outputText value="#{person.sid}"/>
                        </p:column>

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="户籍"/>
                            </f:facet>
                            <h:outputText value="#{person.censusRegister}"/>
                        </p:column>

                    </p:dataTable>
                    <h:panelGrid columns="2">
                        <p:commandButton
                                value="确定"
                                actionListener="#{orgAdminBean.choosePerson}"
                                oncomplete="personHolderDlg.hide();"
                                update="roleHolder"
                                async="true"/>
                        <p:commandButton value="取消" oncomplete="personHolderDlg.hide();"/>
                    </h:panelGrid>
                </h:panelGroup>
            </p:dialog>
        </h:form>


    </ui:define>
</ui:composition>
</html>
