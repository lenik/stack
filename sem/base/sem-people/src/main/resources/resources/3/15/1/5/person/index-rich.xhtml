<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:p="http://primefaces.org/ui" xmlns:icsf="http://java.sun.com/jsf/composite/3/7" xmlns:sem="http://java.sun.com/jsf/composite/3/15"
    xmlns:t="http://myfaces.apache.org/tomahawk" template="/template/simple-entity.xhtml">

    <ui:param name="title" value="联系人信息" />
    <ui:param name="bean" value="#{personAdminBean}" />
    <ui:param name="obj" value="#{bean.openedObject}" />
    <ui:param name="people" value="#{peopleDictsBean}" />

    <ui:define name="dataColumns">
        <p:column headerText="类型">
            <h:outputText value="#{entry.types}" />
        </p:column>
        <p:column headerText="姓名" sortBy="#{entry.label}" styleClass="f-wrappable">
            <h:outputText value="#{entry.displayName}" />
        </p:column>
        <p:column headerText="性别">
            <h:outputText value="#{entry.sexText}" />
        </p:column>
        <p:column headerText="年龄" sortBy="#{entry.birthday}">
            <h:outputText value="#{entry.age}" />
        </p:column>
        <p:column headerText="联系电话" styleClass="f-wrappable" style="width: 10em">
            <h:outputText value="#{entry.contactsString}" />
        </p:column>
        <p:column headerText="户籍" sortBy="#{entry.censusRegister}" styleClass="f-wrappable">
            <h:outputText value="#{entry.censusRegister}" />
        </p:column>
        <p:column headerText="备注" styleClass="f-wrappable">
            <h:outputText value="#{entry.shortMemo}" />
        </p:column>
    </ui:define>

    <ui:define name="editDialogContent">
        <p:tabView id="tv" style="width:100%;">
            <p:tab id="tab1" title="详细信息">
                <t:panelGrid columns="4" columnClasses="field-label, field-content, field-label, field-content">
                    <h:outputLabel for="personName" value="姓名" />
                    <p:inputText id="personName" value="#{obj.name}" label="姓名" />
                    <h:outputLabel for="personFullName" value="全名" />
                    <p:inputText id="personFullName" value="#{obj.fullName}" label="全名" />

                    <h:outputText value="属性" />
                    <t:panelGroup colspan="3">
                        <t:panelGrid columns="3">
                            <t:panelGrid columns="2">
                                <p:selectBooleanCheckbox value="#{obj.employee}" label="属性" />
                                <h:outputText value="内部" />
                            </t:panelGrid>
                            <t:panelGrid columns="2">
                                <p:selectBooleanCheckbox value="#{obj.customer}" label="属性 " />
                                <h:outputText value="客户" />
                            </t:panelGrid>
                            <t:panelGrid columns="2">
                                <p:selectBooleanCheckbox value="#{obj.supplier}" label="属性" />
                                <h:outputText value="供应商" />
                            </t:panelGrid>
                        </t:panelGrid>
                    </t:panelGroup>

                    <h:outputLabel for="personBirthday" value="生日" />
                    <t:panelGroup colspan="3">
                        <p:calendar id="personBirthday" navigator="true" locale="zh_CN" pattern="yyyy-MM-dd"
                            value="#{obj.birthday}" showOn="button" label="生日" />
                    </t:panelGroup>

                    <h:outputLabel for="personSidType" value="证件类型" />
                    <p:selectOneMenu id="personSidType" value="#{obj.sidType.id}" style="width:150px;"
                        label="证件类型">
                        <f:selectItem itemValue="" itemLabel="--选择证件类型--" />
                        <f:selectItems value="#{bean.sidTypes}" />
                    </p:selectOneMenu>
                    <h:outputLabel for="personSid" value="证件号码" />
                    <p:inputText id="personSid" value="#{obj.sid}" label="证件号码" />

                    <h:outputLabel for="personSex" value="性别" />
                    <p:selectOneMenu id="personSex" value="#{obj.sex}" style="width:150px;" label="性别">
                        <f:selectItems value="#{bean.genders}" />
                    </p:selectOneMenu>
                    <h:outputLabel for="personCensusRegister" value="户籍" />
                    <p:inputText id="personCensusRegister" value="#{obj.censusRegister}" label="户籍" />

                    <h:outputLabel for="personInterests" value="兴趣爱好" />
                    <t:panelGroup colspan="3">
                        <p:inputText id="personInterests" value="#{obj.interests}" label="兴趣爱好" />
                    </t:panelGroup>

                    <h:outputLabel for="personTags" value="标签" />
                    <t:panelGroup colspan="3">
                        <t:panelGrid columns="2">
                            <p:selectOneListbox id="personTags" value="#{bean.selectedTagId}" style="height:80px; width:200px;"
                                label="标签">
                                <f:selectItems value="#{obj.tags}" var="tag" itemLabel="#{tag.label}"
                                    itemValue="#{tag.id}" />
                            </p:selectOneListbox>
                            <h:panelGrid colums="2">
                                <p:commandButton value="增加标签" disabled="#{obj == null}" onclick="tagDlg.show();" />
                                <p:commandButton value="删除标签" disabled="#{obj == null}" actionListener="#{bean.deleteTag}"
                                    update="personTags" />
                            </h:panelGrid>
                        </t:panelGrid>
                    </t:panelGroup>

                    <h:outputLabel for="personMemo" value="备注" />
                    <t:panelGroup colspan="3">
                        <p:inputTextarea id="personMemo" value="#{obj.memo}" style="width:300px;height:100px;"
                            effectDuration="400" label="备注" />
                    </t:panelGroup>
                </t:panelGrid>
            </p:tab>

            <p:tab id="tab2" title="联系方式">
                <p:toolbar id="contactToolbar">
                    <p:toolbarGroup align="left">
                        <p:commandButton value="新增" disabled="#{obj == null or obj.id == null}"
                            actionListener="#{bean.doNewContact}" update=":contactForm:contactHolder" async="true"
                            onclick="contactDialog.show();" />
                        <p:commandButton value="修改" actionListener="#{bean.doModifyContact}" disabled="#{not bean.contactSelected}"
                            update=":contactForm:contactHolder" async="true" onclick="contactDialog.show();" />
                        <p:commandButton value="删除" actionListener="#{bean.doDeleteContact}" disabled="#{not bean.contactSelected}"
                            update=":editDialog:form:tv:contacts" async="true" />
                        <p:separator />
                    </p:toolbarGroup>
                </p:toolbar>
                <p:dataTable id="contacts" var="contact" value="#{bean.contacts}" resizableColumns="true"
                    selection="#{bean.selectedContact}" selectionMode="single" rowKey="#{contact.id}" rowIndexVar="rowIndex">

                    <p:ajax event="rowSelect" listener="#{bean.onRowSelectContact}" update=":editDialog:form:tv:contactToolbar" />
                    <p:ajax event="rowUnselect" listener="#{bean.onRowUnselectContact}" update=":editDialog:form:tv:contactToolbar" />

                    <p:column headerText="序号">
                        <h:outputText value="#{rowIndex + 1}" />
                    </p:column>

                    <p:column headerText="分类">
                        <h:outputText value="#{contact.category.label}" />
                    </p:column>

                    <p:column headerText="地址">
                        <h:outputText value="#{contact.address}" />
                    </p:column>
                    <p:column headerText="邮编">
                        <h:outputText value="#{contact.postCode}" />
                    </p:column>
                    <p:column headerText="电话">
                        <h:outputText value="#{contact.tel}" />
                    </p:column>
                    <p:column headerText="移动电话">
                        <h:outputText value="#{contact.mobile}" />
                    </p:column>
                    <p:column headerText="传真">
                        <h:outputText value="#{contact.fax}" />
                    </p:column>
                    <p:column headerText="email">
                        <h:outputText value="#{contact.email}" />
                    </p:column>
                    <p:column headerText="网址">
                        <h:outputText value="#{contact.website}" />
                    </p:column>
                    <p:column headerText="QQ">
                        <h:outputText value="#{contact.qq}" />
                    </p:column>
                </p:dataTable>
            </p:tab>

            <p:tab id="tab3" title="相关客户/供应商">
                <p:dataTable id="roles" var="role" value="#{bean.roles}" resizableColumns="true"
                    selection="#{bean.selectedRole}" selectionMode="single" rowKey="#{role.id}" rowIndexVar="rowIndex">

                    <p:column headerText="序号">
                        <h:outputText value="#{rowIndex + 1}" />
                    </p:column>

                    <p:column headerText="所在部门">
                        <h:outputText value="#{role.orgUnit.label}" />
                    </p:column>

                    <p:column headerText="职务">
                        <h:outputText value="#{role.role}" />
                    </p:column>

                    <p:column headerText="负责业务">
                        <h:outputText value="#{role.roleDetail}" />
                    </p:column>

                    <p:column headerText="客户/供应商名称">
                        <h:outputText value="#{role.org.name}" />
                    </p:column>

                    <p:column headerText="成立日期">
                        <h:outputText value="#{role.org.birthday}">
                            <f:convertDateTime pattern="yyyy-MM-dd" timeZone="Asia/Shanghai" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="公司类型">
                        <h:outputText value="#{role.org.type.label}" />
                    </p:column>

                    <p:column headerText="税务登记号">
                        <h:outputText value="#{role.org.sid}" />
                    </p:column>

                    <p:column headerText="公司规模">
                        <h:outputText value="#{role.org.size}" />
                    </p:column>

                </p:dataTable>
            </p:tab>
        </p:tabView>
    </ui:define>

    <ui:define name="dialogs">
        <p:dialog header="标签添加" widgetVar="tagDlg" modal="true" height="500" width="640">
            <h:form id="tagForm">
                <h:panelGroup id="tagHolder">
                    <p:selectManyMenu value="#{bean.selectedTagsToAdd}" style="height:300px" label="标签容器">
                        <f:selectItems value="#{people.partyTagnameSelectItems}" />
                    </p:selectManyMenu>
                </h:panelGroup>
                <h:panelGrid columns="2">
                    <p:commandButton value="添加" actionListener="#{bean.addTags}" oncomplete="tagDlg.hide();"
                        async="true" update=":editDialog:form:tv:personTags" />
                    <p:commandButton value="取消" oncomplete="tagDlg.hide();" />
                </h:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog header="联系方式编辑" widgetVar="contactDialog" modal="true" height="500" width="640">
            <h:form id="contactForm">
                <h:panelGroup id="contactHolder">
                    <h:inputHidden id="contactId" value="#{bean.contact.id}" />
                    <h:panelGrid columns="4" columnClasses="field-label, field-content, field-label, field-content">

                        <h:outputLabel for="contactCategory" value="分类" />
                        <h:panelGroup colspan="3">
                            <p:selectOneMenu id="contactCategory" value="#{bean.contact.category.id}"
                                style="width:200px;" label="联系方式分类">
                                <f:selectItem itemValue="" itemLabel="--选择联系方式分类--" />
                                <f:selectItems value="#{people.contactCategorySelectItems}" />
                            </p:selectOneMenu>
                        </h:panelGroup>

                        <h:outputLabel for="contactAddress" value="地址" />
                        <p:inputText id="contactAddress" value="#{bean.contact.address}" label="地址" />
                        <h:outputLabel for="contactPostCode" value="邮编" />
                        <p:inputText id="contactPostCode" value="#{bean.contact.postCode}" label="邮编" />

                        <h:outputLabel for="contactTel" value="电话" />
                        <p:inputText id="contactTel" value="#{bean.contact.tel}" label="电话" />
                        <h:outputLabel for="contactMobile" value="移动电话" />
                        <p:inputText id="contactMobile" value="#{bean.contact.mobile}" label="移动电话" />

                        <h:outputLabel for="contactFax" value="传真" />
                        <p:inputText id="contactFax" value="#{bean.contact.fax}" label="传真" />
                        <h:outputLabel for="contactEmail" value="email" />
                        <p:inputText id="contactEmail" value="#{bean.contact.email}" label="email" />

                        <h:outputLabel for="contactWebsite" value="网址" />
                        <p:inputText id="contactWebsite" value="#{bean.contact.website}" label="网址" />
                        <h:outputLabel for="contactQq" value="qq" />
                        <p:inputText id="contactQq" value="#{bean.contact.qq}" />

                        <h:panelGroup />
                        <h:panelGroup colspan="2">
                            <h:panelGrid columns="2">
                                <p:commandButton value="保存" actionListener="#{bean.doSaveContact}"
                                    oncomplete="contactDialog.hide();" async="true" update=":editDialog:form:tv:contacts" />
                                <p:commandButton value="取消" oncomplete="contactDialog.hide();" />
                            </h:panelGrid>
                        </h:panelGroup>
                        <h:panelGroup />

                    </h:panelGrid>
                </h:panelGroup>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>
