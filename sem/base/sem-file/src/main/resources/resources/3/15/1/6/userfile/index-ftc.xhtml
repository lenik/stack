<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:pc="http://bee32.com/plover/core"
    xmlns:sem="http://bee32.com/sem/functions" xmlns:p="http://primefaces.prime.com.tr/ui"
    xmlns:t="http://myfaces.apache.org/tomahawk">
<!-- InstanceBegin template="/Templates/seccaJsf.dwt.jsp" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>

<ui:composition template="/template/primefaces.xhtml">

    <ui:define name="title">userFileAdmin</ui:define>

    <ui:define name="content">

        <h:outputStylesheet>
            .ftd{vertical-align:top;}
            .std{vertical-align:top;}
        </h:outputStylesheet>

        <h:form id="note">
            <p:growl id="message" showDetail="true" />
        </h:form>

        <h:form id="main">
            <p:selectManyCheckbox id="checkbox_tagId" value="#{userFileAdmin.selectedTags}">
                <f:selectItem itemLabel="无标签" itemValue="0" />
                <f:selectItems value="#{userFileAdmin.userFileTags}" />
                <p:ajax update="note:message,main:fileList" listener="#{userFileAdmin.addMessage}" />
            </p:selectManyCheckbox>

            <p:separator />


            <p:dataTable value="#{userFileAdmin.userFileList}" var="item" id="fileList">
                <p:column>
                    <img src="#{item.imageHref}" width="36" height="36" />
                </p:column>

                <p:column headerText="附件名称">
                    <h:outputText value="#{item.fileName}" />
                </p:column>

                <p:column headerText="文件标题">
                    <h:outputText value="#{item.subject}" />
                </p:column>
                <p:column headerText="附件标签">
                    <h:outputText value="#{item.tags_string}" />
                </p:column>

                <p:column headerText="操作">
                    <p:commandLink title="编辑" oncomplete="fileDialog.show();" update="dialogForm:fileDialogPanel">
                        <f:setPropertyActionListener value="#{item}" target="#{userFileAdmin.activeFile}" />
                        <p:graphicImage value="#{location.ICON}/etool16/editor_area.gif" />
                    </p:commandLink>

                    <p:commandLink title="删除" oncomplete="confirmation.show()" process="@this">
                        <p:graphicImage value="#{location.ICON}/etool16/delete_edit.gif" />
                        <f:setPropertyActionListener value="#{item}" target="#{userFileAdmin.activeFile}" />
                    </p:commandLink>
                </p:column>
            </p:dataTable>


            <!--             <p:dataGrid id="fileGrid" value="#{userFileAdmin.userFileList}" var="file" columns="5" rows="12" -->
            <!--                 paginator="true" effect="true" rowsPerPageTemplate="9,12,15" -->
            <!--                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"> -->

            <!--                 <p:column> -->
            <!--                     <p:panel header="#{file.fileName}"> -->
            <!--                         <t:panelGrid columns="2"> -->
            <!--                             <t:panelGroup colspan="2"> -->
            <!--                                 <img src="#{file.imageHref}" height="48" width="48" border="0" /> -->
            <!--                             </t:panelGroup> -->

            <!--                             <h:outputText value="标题:" /> -->
            <!--                             <h:outputText value="#{file.subject}" /> -->

            <!--                             <h:outputText value="标签:" /> -->
            <!--                             <h:outputText value="#{file.activeTag.tag}" /> -->

            <!--                             <h:outputText value="操作:" /> -->
            <!--                             <p:commandLink title="编辑" oncomplete="fileDialog.show();" -->
            <!--                                 update="dialogForm:fileDialogPanel"> -->
            <!--                                 <f:setPropertyActionListener value="#{file}" target="#{userFileAdmin.activeFile}" /> -->
            <!--                                 <p:graphicImage value="#{location.ICON}/etool16/editor_area.gif" /> -->
            <!--                             </p:commandLink> -->

            <!--                         </t:panelGrid> -->
            <!--                     </p:panel> -->
            <!--                 </p:column> -->

            <!--             </p:dataGrid> -->
            <p:commandButton value="标签管理" onclick="tagAdminDialog.show();" />
        </h:form>

        <h:form id="dialogForm">
            <p:confirmDialog message="您确定要删除此附件吗?" showEffect="bounce" hideEffect="explode" header="注意" severity="alert"
                widgetVar="confirmation">

                <p:commandButton value="删除" actionListener="#{userFileAdmin.removeFile}"
                    oncomplete="confirmation.hide();" update="main:fileList" />
                <p:commandButton value="取消" />

            </p:confirmDialog>

            <p:confirmDialog message="确定要删除此标签吗?" hideEffect="explode" header="提示" severity="alert"
                widgetVar="deleteTagConfirmation" modal="true">

                <p:commandButton value="删除" actionListener="#{userFileAdmin.deleteTag}"
                    oncomplete="deleteTagConfirmation.hide();" update="dialogForm:tagAdmin,note:message" />
                <p:commandButton value="取消" onclick="deleteTagConfirmation.hide()" />
            </p:confirmDialog>

            <p:dialog widgetVar="selectTagsDialog" width="300" height="400" head="选择标签">
                <p:selectManyMenu value="#{userFileAdmin.selectedTagsToAdd}">
                    <f:selectItems value="#{userFileAdmin.userFileTags}" />
                </p:selectManyMenu>
            </p:dialog>

            <p:dialog widgetVar="tagAdminDialog" height="400" width="600" header="标签管理">
                <t:panelGrid columns="2" columnClasses="ftd,std" style="width:100%;" id="tagAdmin">
                    <p:selectOneListbox value="#{userFileAdmin.activeTag.id}">
                        <f:selectItems value="#{userFileAdmin.userFileTags}" />
                    </p:selectOneListbox>
                    <t:panelGroup>
                        <p:commandButton value="新标签" actionListener="#{userFileAdmin.createNewTag}"
                            oncomplete="activeTagDialog.show();" update="dialogForm:activeTag,main:checkbox_tagId" />
                        <br />
                        <p:commandButton value="删除标签" onclick="deleteTagConfirmation.show();"
                            update="main:checkbox_tagId,dialogForm:activeTag" />
                        <br />

                    </t:panelGroup>
                </t:panelGrid>
            </p:dialog>

            <p:dialog widgetVar="activeTagDialog" height="300" width="400">
                <t:panelGrid columns="2" id="activeTag">
                    <h:outputText value="标签名称:" />
                    <p:inputText value="#{userFileAdmin.activeTag.tag}" />
                </t:panelGrid>
                <p:commandButton value="保存" actionListener="#{userFileAdmin.saveOrUpdateTag}"
                    oncomplete="activeTagDialog.hide()" update="dialogForm:tagAdmin,note:message" />
                <p:commandButton value="取消" onclick="activeTagDialog.hide();" />
            </p:dialog>

            <p:dialog widgetVar="fileDialog" height="500" width="700">
                <p:panel id="fileDialogPanel">
                    <t:panelGrid columns="2" style="width:100%;">

                        <t:panelGroup colspan="2">
                            <div align="center">
                                <img src="#{userFileAdmin.activeFile.imageHref}" border="1" />
                            </div>
                        </t:panelGroup>

                        <h:outputText value="文件名:" />
                        <p:inputText value="#{userFileAdmin.activeFile.fileName}" />

                        <h:outputText value="文件标题:" />
                        <p:inputText value="#{userFileAdmin.activeFile.subject}" />

                        <h:outputText value="选择标签:" />
                        <p:selectOneMenu value="#{userFileAdmin.activeFile.activeTag.id}" style="width:150px;">
                            <f:selectItems value="#{userFileAdmin.userFileTags}" />
                        </p:selectOneMenu>
                    </t:panelGrid>
                    <p:panel>
                        <p:selectOneListbox value="#{userFileAdmin.activeTag}">
                            <f:selectItems value="#{userFileAdmin.userFileTags}" />
                        </p:selectOneListbox>
                    </p:panel>

                    <p:commandButton value="确定" actionListener="#{userFileAdmin.editUserFile}"
                        oncomplete="fileDialog.hide();" update="main:fileGrid" />
                    <p:commandButton value="取消" onclick="fileDialog.hide();" />


                </p:panel>
            </p:dialog>
        </h:form>

        <h:form enctype="multipart/form-data">

            <p:fileUpload fileUploadListener="#{userFileAdmin.handleFileUpload}" mode="advanced"
                update="note:message,main:fileList" multiple="true" allowTypes="png,gif,jpg,doc,docx,xsl,xslx" />

        </h:form>

    </ui:define>
</ui:composition>
</html>