<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:pc="http://bee32.com/plover/core" xmlns:sem="http://bee32.com/sem/functions"
    xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk" template="/template/primefaces.xhtml">

    <ui:param name="_toolbar" value="${toolbar != null ? toolbar : viewConfig.toolbarPlacement}" />

    <ui:define name="title">${title}</ui:define>
    <ui:define name="styles">
        <c:if test="${fn:contains(_toolbar, 't')}">
            <style type="text/css">
                .ui-growl {
                top: auto;
                bottom: 20px;
                }
            </style>
        </c:if>
    </ui:define>

    <ui:define name="scripts.0.simple-entity">
        <h:outputScript library="frame" name="ajax-validation.js" target="head" />
        <h:outputScript library="frame" name="security-load.js" target="head" />
    </ui:define>

    <ui:define name="content">
        <div id="includes">
            <ui:insert name="includes" />
        </div>

        <h:outputStylesheet library="frame" name="layout.css" />
        <table id="layoutTable" cellspacing="0" cellpadding="0" border="0" style="table-layout: fixed; width: 100%">
            <tr>
                <c:if test="${sideBarWVisible != null}">
                    <td valign="top" id="sideBarW" style="width: 20em; ${sideBarWVisible == true ? '' : 'display: none'}">
                        <h:panelGroup id="sidePanelW">
                            <ui:insert name="sideBarW" />
                            <ui:insert name="sideBarW.1" />
                            <ui:insert name="sideBarWSupport" />
                        </h:panelGroup>
                    </td>
                    <td valign="center" id="sideBarWToggler" class="layout-side-toggler ui-state-default" style="width: 9px"
                        onclick="$('#sideBarW').toggle()" />
                </c:if>
                <td valign="top">
                    <ui:insert name="mainForm">
                        <h:form id="mainForm">
                            <c:if test="${fn:contains(_toolbar, 't')}">
                                <div id="toolbar">
                                    <ui:insert name="toolbar" />
                                </div>
                            </c:if>

                            <div id="dataContainer">
                                <ui:insert name="dataContainer">
                                    <p:dataTable id="dataTable" var="entry" value="${bean.dataModel}"
                                        selection="${bean.singleSelection}" selectionMode="single" paginator="true"
                                        rows="${viewConfig.pageSize}" paginatorTemplate="${viewConfig.paginatorTemplate}"
                                        rowsPerPageTemplate="${viewConfig.pageSizeTemplate}" resizableColumns="true"
                                        rowIndexVar="rowIndex">

                                        <p:ajax event="rowSelect" update=":mainForm:toolbar" />
                                        <p:ajax event="rowUnselect" update=":mainForm:toolbar" />

                                        <ui:insert name="dataTableHeader">
                                            <f:facet name="header">${title}</f:facet>
                                        </ui:insert>

                                        <p:column headerText="序号">
                                            <h:outputText value="#{rowIndex + 1}" />
                                        </p:column>

                                        <ui:insert name="dataColumns" />

                                        <ui:insert name="dataColumnsC">
                                            <p:column headerText="更新日期">
                                                <h:outputText value="${entry.lastModified}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd" timeZone="Asia/Shanghai" />
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="属主">
                                                <h:outputText value="${entry.owner.displayName}" />
                                            </p:column>
                                        </ui:insert>
                                    </p:dataTable>
                                </ui:insert>
                            </div>
                            <div id="dataContextMenu">
                                <ui:insert name="dataContextMenu" />
                            </div>

                            <c:if test="${fn:contains(_toolbar, 'b')}">
                                <div id="toolbar">
                                    <ui:insert name="toolbar" />
                                </div>
                            </c:if>
                        </h:form>
                    </ui:insert>
                </td>
                <td valign="center" id="sideBarEToggler" class="layout-side-toggler ui-state-default" style="width: 9px"
                    onclick="$('#sideBarE').toggle()"></td>
                <td valign="top" id="sideBarE" style="width: 20em; display: none">
                    <h:panelGroup id="sidePanelE">
                        <ui:insert name="sideBarE">
                            <h:form id="searchForm">
                                <ui:insert name="searchPanel" />
                                <ui:insert name="searchFragmentsPanel" />
                            </h:form>
                            <ui:insert name="sideBarE.1" />
                        </ui:insert>
                        <ui:insert name="sideBarESupport" />
                    </h:panelGroup>
                </td>
            </tr>
        </table>

        <div id="toolbarDialogs">
            <ui:insert name="toolbarDialogs" />
        </div>

        <div id="dialogs">
            <ui:insert name="dialogs.0" />
            <ui:insert name="dialogs" />
        </div>
    </ui:define>

</ui:composition>
