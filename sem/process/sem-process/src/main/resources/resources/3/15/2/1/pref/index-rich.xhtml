<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:pc="http://bee32.com/plover/core" xmlns:sem="http://bee32.com/sem/functions"
    xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk" template="/template/primefaces.xhtml">

    <ui:define name="title">审核策略配置项</ui:define>

    <ui:define name="content">
        <c:set var="bean" value="#{verifyPolicyPrefBean}" />

        <h:form id="main">
            <p:panel header="审核策略配置项">
                <p:toolbar id="toolbar">
                    <p:toolbarGroup align="left">
                        <p:commandButton value="新增" actionListener="#{bean.showCreateForm}" disabled="#{bean.editing}"
                            update="toolbar, :main:tabView" async="true" />
                        <p:commandButton value="修改" actionListener="#{bean.showEditForm}" disabled="#{!bean.selected || bean.editing }"
                            update="toolbar, :main:tabView" async="true" />
                        <p:commandButton value="删除" actionListener="#{bean.deleteSelection}" disabled="#{!bean.selected || bean.editing }"
                            update="toolbar, :main:tabView" async="true" />
                        <p:separator />
                        <p:commandButton id="save-validated" value="保存" actionListener="#{bean.save}"
                            disabled="#{!bean.editing}" update="toolbar, :main:tabView" async="true" />
                        <p:commandButton value="取消" actionListener="#{bean.showIndex}" disabled="#{!bean.actived}"
                            update="toolbar, :main:tabView" async="true" />
                        <p:separator />
                        <p:commandButton value="详细" actionListener="#{bean.showContentForm}" disabled="#{!bean.selected ||  bean.actived }"
                            update="toolbar, :main:tabView" async="true" />
                        <p:separator />
                    </p:toolbarGroup>
                </p:toolbar>

                <p:tabView id="tabView" style="width:100%;" activeIndex="#{bean.activeTab}">
                    <p:tab id="indexTab" title="配置项列表">
                        <p:dataTable id="dataTable" var="entry" value="#{bean.dataModel}" paginator="true"
                            rows="#{viewConfig.pageSize}" lazy="true" paginatorTemplate="#{viewConfig.paginatorTemplate}"
                            rowsPerPageTemplate="#{viewConfig.pageSizeTemplate}" resizableColumns="true"
                            selection="#{bean.selectionArray}" selectionMode="multiple" rowKey="#{entry.id}"
                            rowIndexVar="rowIndex">

                            <p:ajax event="rowSelect" listener="#{bean.dummy}" update=":main:toolbar" />
                            <p:ajax event="rowUnselect" listener="#{bean.dummy}" update=":main:toolbar" />

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="序号" />
                                </f:facet>
                                <h:outputText value="#{rowIndex + 1}" />
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="实体类型" />
                                </f:facet>
                                <h:outputText value="#{entry.displayName}" />
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="启用的审核策略" />
                                </f:facet>
                                <h:outputText value="#{entry.preferredPolicy.label}" />
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="备注" />
                                </f:facet>
                                <h:outputText value="#{entry.description}" />
                            </p:column>

                        </p:dataTable>
                    </p:tab>

                    <p:tab title="配置项" rendered="#{bean.actived}">
                        <c:set var="obj" value="#{bean.activeObject}" />
                        <p:panel header="对应关系">
                            <h:inputHidden id="id" value="#{obj.id}" />
                            <t:panelGrid columns="2" columnClasses="detail_col_title,detail_col_value">

                                <h:outputLabel for="typeId" value="实体类型" />
                                <h:selectOneMenu id="typeId" value="#{obj.typeId}">
                                    <f:selectItems value="#{bean.verifiableTypes}" var="type" itemValue="${type.id}"
                                        itemLabel="${type.displayName}" />
                                </h:selectOneMenu>

                                <h:outputLabel for="description" value="对应的审核策略" />
                                <h:panelGroup>
                                    <h:selectOneMenu id="preferredPolicyId" value="#{obj.preferredPolicy.id}">
                                        <f:selectItems value="${bean.candidates}" var="candidate"
                                            itemValue="${candidate.id}" itemLabel="${candidate.label} - ${candidate.description}" />
                                    </h:selectOneMenu>
                                    <p:commandButton value="Refresh" update=":main:tabView"
                                        actionListener="#{bean.refreshCandidates}" async="true" />
                                </h:panelGroup>

                                <h:outputLabel for="description" value="备注" />
                                <p:inputText id="description" value="#{obj.description}" />

                            </t:panelGrid>
                        </p:panel>
                    </p:tab>

                </p:tabView>
            </p:panel>
        </h:form>
    </ui:define>
</ui:composition>
