<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:pc="http://bee32.com/plover/core" xmlns:sem="http://bee32.com/sem/functions"
    xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk" template="/template/primefaces.xhtml">

    <ui:define name="title">单一审核人策略</ui:define>

    <ui:define name="content">
        <c:set var="bean" value="#{singleVerifierPolicyBean}" />

        <h:form id="main">
            <p:panel header="单一审核人策略">
                <p:toolbar id="toolbar">
                    <p:toolbarGroup align="left">
                        <p:commandButton value="新增" actionListener="#{bean.showCreateForm}" disabled="#{bean.editing}"
                            update="editForm" async="true" />
                        <p:commandButton value="修改" actionListener="#{bean.showEditForm}"
                            disabled="#{bean.editing || !bean.selected}" update="editForm" async="true" />
                        <p:commandButton value="删除" actionListener="#{bean.deleteSelection}"
                            disabled="#{bean.editing || !bean.selected}" update="editForm" async="true" />
                        <p:separator />
                        <p:commandButton id="save-validated" value="保存" actionListener="#{bean.save}"
                            disabled="#{!bean.editing}" update="editForm" async="true" />
                        <p:commandButton value="取消" actionListener="#{bean.showIndex}" disabled="#{!bean.editing}"
                            update="editForm" async="true" />
                        <p:separator />
                        <p:commandButton value="详细" actionListener="#{bean.showContentForm}"
                            disabled="#{bean.editing || !bean.selected}" update="editForm" async="true" />
                        <p:separator />
                    </p:toolbarGroup>
                </p:toolbar>

                <p:tabView id="tabView" style="width:100%;" activeIndex="#{bean.activeTab}">
                    <p:tab id="indexTab" title="策略列表">
                        <p:dataTable id="dataTable" var="entry" value="#{bean.dataModel}" paginator="true"
                            rows="#{viewConfig.pageSize}" lazy="true" paginatorTemplate="#{viewConfig.paginatorTemplate}"
                            rowsPerPageTemplate="#{viewConfig.pageSizeTemplate}" resizableColumns="true"
                            selection="#{bean.selectionArray}" selectionMode="multiple" rowKey="#{entry.id}" rowIndexVar="rowIndex">

                            <p:ajax event="rowSelect" listener="#{bean.dummy}" update="editForm:toolbar" />
                            <p:ajax event="rowUnselect" listener="#{bean.dummy}" update="editForm:toolbar" />

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="序号" />
                                </f:facet>
                                <h:outputText value="#{rowIndex + 1}" />
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="名称" />
                                </f:facet>
                                <h:outputText value="#{entry.label}" />
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="描述" />
                                </f:facet>
                                <h:outputText value="#{entry.description}" />
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="创建日期" />
                                </f:facet>
                                <h:outputText value="#{entry.createdDate}">
                                    <f:convertDateTime pattern="yyyy-MM-dd" timeZone="Asia/Shanghai" />
                                </h:outputText>
                            </p:column>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="所有人" />
                                </f:facet>
                                <h:outputText value="#{entry.owner.displayName}" />
                            </p:column>

                        </p:dataTable>
                    </p:tab>

                    <p:tab title="策略内容" rendered="#{bean.selected}">
                        <c:set var="selection" value="#{bean.selection[0]}" />
                        <p:panel header="策略内含物">
                            <h:inputHidden id="id" value="#{selection.id}" />
                            <t:panelGrid columns="4"
                                columnClasses="detail_col_title,detail_col_value,detail_col_title,detail_col_value">
                                <h:outputLabel for="label" value="名称" />
                                <p:inputText id="label" value="#{selection.label}" />
                                <h:outputLabel for="description" value="描述" />
                                <p:inputText id="description" value="#{selection.description}" />
                            </t:panelGrid>
                        </p:panel>

                    </p:tab>
                </p:tabView>
            </p:panel>
        </h:form>
    </ui:define>
</ui:composition>
