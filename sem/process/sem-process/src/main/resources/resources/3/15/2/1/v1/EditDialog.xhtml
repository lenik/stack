<h:panelGroup xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:p="http://primefaces.org/ui"
    xmlns:t="http://myfaces.apache.org/tomahawk">

    <c:set var="_caption" value="${caption != null ? caption : '白名单策略X'}" />
    <c:set var="_bean" value="${bean != null ? bean : singleVerifierPolicyBean}" />
    <c:set var="_var" value="${var != null ? var : 'editDialog'}" />
    <c:set var="_formId" value="${formId != null ? formId : 'editForm'}" />
    <c:set var="_listener" value="${listener != null ? listener : _bean}" />
    <c:set var="_update" value="${update != null ? update : viewConfig.defaultUpdateTarget}" />
    <c:set var="_addResponsibleDialogVar" value="${addResponsibleDialogVar != null ? addResponsibleDialogVar : 'addResponsibleDialog'}" />

    <ui:include src="/3/7/1/ChoosePrincipalDialog.xhtml">
        <ui:param name="caption" value="选择用户或组" />
        <ui:param name="var" value="addResponsibleDialog" />
        <ui:param name="listener" value="#{_bean.addResponsibleAdapter}" />
        <ui:param name="update" value="editForm:responsibleTable" />
    </ui:include>

    <p:dialog header="${_caption}" widgetVar="${_var}" modal="true">
        <c:set var="obj" value="${_bean.activeObject}" />
        <h:form id="${_formId}" style="max-height: 30em; margin: 1em">
            <t:panelGrid columns="2" columnClasses="detail_col_title,detail_col_value">

                <h:outputText value="名称" />
                <p:inputText value="${obj.label}" />

                <h:outputText value="描述" />
                <p:inputText value="${obj.description}" size="50" />

            </t:panelGrid>

            <p:fieldset legend="责任人列表" toggleable="false">
                <p:dataTable id="responsibleTable" value="${obj.responsibles}" var="responsible"
                    resizableColumns="true" rowIndexVar="rowIndex">
                    <f:facet name="header">策略包含的责任对象</f:facet>
                    <p:column headerText="序号" style="width: 4em;">
                        <h:outputText value="${rowIndex+1}" />
                    </p:column>

                    <p:column headerText="名称" style="width: 10em;">
                        <h:outputText value="${responsible.name}" />
                    </p:column>

                    <p:column headerText="类型" style="width: 5em;">
                        <h:outputText value="${responsible.typeName}" />
                    </p:column>

                    <p:column headerText="操作" style="width: 3em;">
                        <p:commandLink title="删除" action="${_bean.removeResponsible}" update="${_formId}:responsibleTable">
                            <f:setPropertyActionListener value="${responsible}"
                                target="${_bean.selectedResponsible}" />
                            <p:graphicImage value="${location.ICON}/etool16/delete_edit.gif" />
                        </p:commandLink>
                    </p:column>
                </p:dataTable>
                <p:commandButton value="增加责任人" update="responsibleTable" onclick="${_addResponsibleDialogVar}.show()" />
            </p:fieldset>

            <div align="right">
                <p:commandButton update="${_update}" value="保存" actionListener="${_bean.save}"
                    oncomplete="${_var}.hide()" />
                <p:commandButton value="取消" onclick="editDialog.hide()" />
            </div>
        </h:form>
    </p:dialog>

</h:panelGroup>
