<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:icsf="http://java.sun.com/jsf/composite/3/7"
    xmlns:sem="http://java.sun.com/jsf/composite/3/15" template="/template/simple-entity.xhtml">

    <ui:param name="_historicMode" value="${historicMode != null ? historicMode : false}" />
    <ui:param name="oo" value="${bean.openedObject}" />

    <ui:define name="toolbar.right.2">
        <p:commandButton id="completeButton" value="完成" rendered="${completable != null ? completable : true}"
            disabled="${not bean.selected}" actionListener="${bean.completeSelection}" update="${_indexUpdate}" onclick="waitbox.show()"
            oncomplete="waitbox.hide()" />
    </ui:define>

    <ui:define name="dataColumns">
        <p:column headerText="属主" sortBy="${entry.owner}">
            <h:outputText value="${entry.owner}" />
        </p:column>
        <p:column headerText="执行" sortBy="${entry.assignee}">
            <h:outputText value="${entry.assignee}" />
        </p:column>
        <p:column headerText="任务名称" sortBy="${entry.name}">
            <h:outputText value="${entry.name}" />
        </p:column>
        <p:column headerText="任务描述" sortBy="${entry.description}" styleClass="f-wrappable">
            <h:outputText value="${entry.description}" />
        </p:column>
        <p:column headerText="创建时间" sortBy="${entry.createTime}" rendered="${not _historicMode}">
            <h:outputText value="${entry.createTime}" />
        </p:column>
        <p:column headerText="开始时间" sortBy="${entry.startTime}" rendered="${_historicMode}">
            <h:outputText value="${entry.startTime}" />
        </p:column>
        <p:column headerText="到期时间" sortBy="${entry.dueDate}">
            <h:outputText value="${entry.dueDate}" />
        </p:column>
        <p:column headerText="结束时间" sortBy="${entry.endTime}" rendered="${_historicMode}">
            <h:outputText value="${entry.endTime}" />
        </p:column>
        <p:column headerText="所属过程" sortBy="${entry.processInstanceId}">
            <h:outputText value="${entry.processInstanceId}" />
        </p:column>
        <p:column headerText="定义" sortBy="${entry.processDefinitionId}">
            <h:outputText value="${entry.processDefinitionId}" />
        </p:column>
        <p:column headerText="委托状态" rendered="${not _historicMode}">
            <h:outputText value="${entry.delegationState}" />
        </p:column>
        <p:column headerText="删除标志" rendered="${not _historicMode}">
            <h:outputText value="${entry.deleted}" />
        </p:column>
        <p:column headerText="事件名称" rendered="${not _historicMode}">
            <h:outputText value="${entry.eventName}" />
        </p:column>
    </ui:define>

    <ui:define name="dataColumnsC">
    </ui:define>

    <ui:define name="searchPanels">
    </ui:define>

    <ui:define name="searchFragmentsPanel">
    </ui:define>

    <ui:define name="editDialogContent">
        <p:tabView id="tv">
            <p:tab title="任务信息">
                <table width="100%">
                    <tr>
                        <td width="60" rowspan="2">
                            <img src="${location.WEB_APP}/VAADIN/themes/activiti/img/task-50.png" />
                        </td>
                        <td>
                            <p:inplace emptyLabel="没有设置任务名称" editor="true" style="font-size: x-large;">
                                <p:inputText id="name" label="名称" value="${oo.name}" style="font-size: x-large;" />
                                <p:watermark for="name" value="输入任务的简短名称" />
                            </p:inplace>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <ul style="list-style: none; padding: 0">
                                <li style="float: left; margin: 0 2em 0 0">
                                    <img src="${location.WEB_APP}/VAADIN/themes/activiti/img/duedate-16.png" />
                                    到期时间：

                                    <p:inplace emptyLabel="无设置" editor="true">
                                        <p:calendar id="dueDate" label="到期时间" pattern="yyyy-MM-dd HH:mm"
                                            navigator="${true}" value="${oo.dueDate}" showOn="button" />
                                    </p:inplace>
                                </li>
                                <li style="float: left; margin: 0 2em 0 0">
                                    <img
                                        src="${location.WEB_APP}/VAADIN/themes/activiti/img/priority-${
                        oo.priority > 50 ? 'high' : oo.priority > 0 ? 'medium' : 'low' }-16.png" />
                                    优先级：
                                    <p:inplace editor="true">
                                        <p:selectOneMenu value="${oo.priority}" style="width: 6em">
                                            <f:selectItem itemLabel="低" itemValue="0" />
                                            <f:selectItem itemLabel="中等" itemValue="50" />
                                            <f:selectItem itemLabel="高" itemValue="100" />
                                        </p:selectOneMenu>
                                    </p:inplace>
                                </li>
                                <c:if test="${not _historicMode}">
                                    <li style="float: left; margin: 0 2em 0 0">
                                        <img src="${location.WEB_APP}/VAADIN/themes/activiti/img/create-time-16.png" />
                                        创建于：${bean.relativeDateTo(oo.createTime)}
                                    </li>
                                </c:if>
                            </ul>
                        </td>
                    </tr>
                </table>

                <p:separator />
                <p:inplace emptyLabel="此任务没有描述。" editor="true">
                    <p:inputTextarea id="description" label="描述" value="${oo.description}" style="width: 95%;" />
                    <p:watermark for="description" value="输入任务的描述信息" />
                </p:inplace>

                <p:separator />
                <h3>参与人</h3>
                <h:panelGrid id="headerGrid" columns="2" columnClasses="f-left, f-left">
                    <h:outputText value="所属人：" />
                    <p:inplace emptyLabel="无属主" editor="true">
                        <p:inputText id="owner" value="${oo.owner}" readonly="true" />
                        <p:commandButton value="转让" oncomplete="chooseOwnerDialog.show()">
                            <f:setPropertyActionListener target="${chooseOwnerDialog.stereo}"
                                value="U" />
                        </p:commandButton>
                    </p:inplace>

                    <h:outputText value="执行：" />
                    <p:inplace emptyLabel="尚未分配执行者。" editor="true">
                        <p:inputText id="assignee" value="${oo.assignee}" readonly="true" />
                        <p:commandButton value="重新分配" oncomplete="chooseAssigneeDialog.show()">
                            <f:setPropertyActionListener target="${chooseAssigneeDialog.stereo}"
                                value="U" />
                        </p:commandButton>
                        <p:commandButton value="分配给自己执行" onclick="waitbox.show()" oncomplete="waitbox.hide()"
                            actionListener="${bean.assignToMe}" update="${_contentUpdate}" />
                    </p:inplace>
                </h:panelGrid>

                <p:separator />
                <h3>动作</h3>
                <table border="0" width="100%">
                    <tr>
                        <td align="left">
                            <p:commandButton id="completeButton" value="完成/提交" styleClass="locker-bypass"
                                rendered="${ (completable != null ? completable : true) and not bean.creating}"
                                actionListener="${bean.complete}" onclick="waitbox.show()" oncomplete="waitbox.hide(); editdlg.hideValidated(args)"
                                update="${_indexUpdate} ${mirrorTargets}">
                                <f:attribute name="locking" value="never" />
                            </p:commandButton>
                        </td>
                    </tr>
                </table>
            </p:tab>

            <p:tab title="相关内容">
                此任务无附加内容。
            </p:tab>

        </p:tabView>
    </ui:define>

    <ui:define name="dialogs">
        <icsf:choosePrincipalDialog id="chooseOwnerDialog" var="chooseOwnerDialog" header="选择被转让任务的用户"
            stereo="U" target="${bean.newOwner}" update=":editDialog:form" />
        <icsf:choosePrincipalDialog id="chooseAssigneeDialog" var="chooseAssigneeDialog"
            header="选择任务的执行者" stereo="U" target="${bean.newAssignee}" update=":editDialog:form" />
        <ui:insert name="dialogs.taskTemplate" />
    </ui:define>

</ui:composition>
