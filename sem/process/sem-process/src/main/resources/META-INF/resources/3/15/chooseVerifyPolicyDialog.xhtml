<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:cc="http://java.sun.com/jsf/composite"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui">

    <cc:interface>
        <!-- basic -->
        <cc:attribute name="var" default="chooseVerifyPolicyDialog" />
        <cc:attribute name="selection" required="true" />
        <cc:attribute name="multiple" type="java.lang.Boolean" default="false" />
        <cc:attribute name="actionListener" targets="form:ok" default="${dialogBean.selected}" />
        <cc:attribute name="update" />

        <!-- ui overrides -->
        <cc:attribute name="caption" default="${chooseVerifyPolicyDialogBean.caption}" />
        <cc:attribute name="style" default="max-height: 40em; margin: 1em" />

        <!-- internals -->
        <cc:attribute name="dialogBean" type="java.lang.Object" default="${chooseVerifyPolicyDialogBean}" />
    </cc:interface>

    <cc:implementation>
        <c:set var="dialogBean" value="${cc.attrs.dialogBean}" />

        <p:dialog header="${cc.attrs.caption}" widgetVar="${cc.attrs.var}" modal="true">
            <h:form id="form" style="${cc.attrs.style}">

                <p:fieldset legend="搜索" toggleable="true" collapsed="true">
                    <h:panelGrid columns="3" columnClasses="">
                        <h:outputLabel for="${cc.clientId}:form:pattern" value="名称:" />
                        <p:inputText id="pattern" value="${dialogBean.labelPattern}" />
                        <p:commandButton value="添加条件" actionListener="${dialogBean.addLabelRestriction}"
                            update="@form" />
                    </h:panelGrid>
                </p:fieldset>

                <h:panelGroup id="searchFragments" style="display: block; padding: .2em 0em;">
                    <ui:repeat id="repeat" var="fragment" value="${dialogBean.searchFragments}">
                        <p:commandButton value="${fragment.entryLabel}" async="true" actionListener="${fragment.detach}"
                            update="@form" />
                    </ui:repeat>
                </h:panelGroup>

                <p:dataTable id="dataTable" var="entry" value="${dialogBean.dataModel}" selection="${cc.attrs.selection}"
                    selectionMode="${cc.attrs.multiple ? 'multiple' : 'single'}" paginator="true" rows="10" lazy="true"
                    paginatorTemplate="${viewConfig.paginatorTemplate}" rowsPerPageTemplate="${viewConfig.pageSizeTemplate}"
                    resizableColumns="true" rowIndexVar="rowIndex">

                    <p:column headerText="序号" style="width:1.5em;">
                        <h:outputText value="${rowIndex + 1}" />
                    </p:column>

                    <p:column headerText="名称">
                        <h:outputText value="#{entry.label}" />
                    </p:column>

                    <p:column headerText="描述">
                        <h:outputText value="#{entry.description}" />
                    </p:column>

                    <p:column headerText="创建日期">
                        <h:outputText value="#{entry.createdDate}">
                            <f:convertDateTime pattern="yyyy-MM-dd" timeZone="Asia/Shanghai" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="所有人">
                        <h:outputText value="#{entry.owner.displayName}" />
                    </p:column>
                </p:dataTable>

                <div align="right">
                    <p:commandButton id="ok" value="确定" oncomplete="${cc.attrs.var}.hide()" update="${cc.attrs.update}"
                        async="true" />
                    <p:commandButton id="cancel" value="关闭" oncomplete="${cc.attrs.var}.hide();" />
                </div>
            </h:form>
        </p:dialog>
    </cc:implementation>

</html>
