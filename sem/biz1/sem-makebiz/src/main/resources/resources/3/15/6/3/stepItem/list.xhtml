<ui:composition template="/template/simple-entity.xhtml" xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:fr="http://java.sun.com/jsf/composite/frame"
    xmlns:sem="http://java.sun.com/jsf/composite/3/15" xmlns:pf="http://bee32.com/plover/faces">

    <ui:param name="title" value="生产数据列表" />
    <ui:param name="bean" value="${makeStepItemListAdminBean}" />
    <ui:param name="obj" value="${bean.openedObject}" />
    <ui:param name="monetary" value="#{monetaryDictsBean}" />
    <ui:param name="thing" value="#{thingDictsBean}" />
    <ui:param name="deletable" value="false" />


    <ui:define name="dataColumns">
        <p:column headerText="时间" sortBy="${entry.createdDate}">
            <h:outputText value="${entry.createdDate}">
                <f:convertDateTime pattern="yyyy-MM-dd" timeZone="Asia/Shanghai" />
            </h:outputText>
        </p:column>
        <p:column headerText="简要" >
            <h:outputText value="${entry.label}" />
        </p:column>
        <p:column headerText="工艺流转单" >
            <h:outputText value="${entry.parent.parent.label}" />
        </p:column>
        <p:column headerText="计划数量" >
            <h:outputText value="${entry.planQuantity}" />
        </p:column>
        <p:column headerText="实际数量" >
            <h:outputText value="${entry.actualQuantity}" />
        </p:column>
        <p:column headerText="合格数量" >
            <h:outputText value="${entry.verifiedQuantity}" />
        </p:column>
        <p:column headerText="计划完成时间" sortBy="${entry.planDeadline}">
            <h:outputText value="${entry.planDeadline}">
                <f:convertDateTime pattern="yyyy-MM-dd" timeZone="Asia/Shanghai" />
            </h:outputText>
        </p:column>
        <p:column headerText="实际完成时间" sortBy="${entry.actualDeadline}">
            <h:outputText value="${entry.actualDeadline}">
                <f:convertDateTime pattern="yyyy-MM-dd" timeZone="Asia/Shanghai" />
            </h:outputText>
        </p:column>
        <p:column headerText="部门" >
            <h:outputText value="${entry.orgUnit.label}" />
        </p:column>
    </ui:define>

    <p:dialog widgetVar="stepDialog" modal="true">
        <h:form id="stepDialogForm">
            <p:tabView id="stepEditTab">
                <p:tab title="基本信息">

                    <t:panelGrid columns="4">
                        <h:outputText value="工艺名称:" />
                        <t:panelGroup colspan="3">
                            <h:outputText id="makeStepName" value="#{item.model.stepName.label}"/>
                        </t:panelGroup>

                        <h:outputText value="计划数量:" />
                        <p:inputText value="#{item.planQuantity}" label="计划数量" />
                        <h:outputText value="实际生产数量:" />
                        <p:inputText value="#{item.actualQuantity}" label="实际生产数量" />

                        <h:outputText value="合格数量:" />
                        <p:inputText value="#{item.verifiedQuantity}" label="合格数量" />
                        <h:panelGroup />
                        <h:panelGroup />

                        <h:outputText value="计划完成时间：" />
                        <p:calendar pattern="yyyy-MM-dd" value="#{item.planDeadline}" navigator="true"
                                    locale="zh_CN" showOn="button" label="计划完成时间" />

                        <h:outputText value="实际完成时间：" />
                        <p:calendar pattern="yyyy-MM-dd" value="#{item.actualDeadline}" navigator="true"
                                    locale="zh_CN" showOn="button" label="实际完成时间" />


                        <h:outputText value="部门:" styleClass="e-link" onclick="#{item.orgUnit.clickAction}"/>
                        <t:panelGroup>
                            <p:inputText id="orgUnit" label="对应部门" value="#{item.orgUnit.path}" readonly="true" />
                            <p:commandButton value="..." oncomplete="chooseOrgUnitDialog.show()" />
                        </t:panelGroup>
                        <h:outputText value="是否完成:" />
                        <p:selectBooleanCheckbox value="#{item.done}" />
                    </t:panelGrid>

                </p:tab>

                <p:tab title="操作员">
                    <fr:listView id="operatorIndexView" header="操作员" style="indexPanel"
                                 picker="choosePersonDialog"
                                 mbean="#{bean.operatorsMBean}" nested="true">
                        <f:facet name="columns">
                            <p:column headerText="姓名" sortBy="#{entry.label}" styleClass="f-wrappable">
                                <h:outputText value="#{entry.displayName}" />
                            </p:column>
                            <p:column headerText="性别">
                                <h:outputText value="#{entry.sexText}" />
                            </p:column>
                            <p:column headerText="年龄" sortBy="#{entry.birthday}">
                                <h:outputText value="#{entry.age}" />
                            </p:column>
                        </f:facet>
                        <f:facet name="picker-init">
                            <f:setPropertyActionListener target="#{choosePersonDialogBean.employee}" value="true" />
                        </f:facet>
                    </fr:listView>
                </p:tab>

                <p:tab title="质检结果">
                    <fr:listView id="qcResultParaIndexView" header="质检结果" style="indexPanel" editView=":qcResultParaEditView"
                                 mbean="#{bean.qcResultParasMBean}" nested="true">
                        <f:facet name="columns">
                            <p:column headerText="质检内容">
                                <h:outputText value="#{entry.key.label}" />
                            </p:column>
                            <p:column headerText="标准值" styleClass="f-right">
                                <h:outputText value="#{entry.key.value}" />
                            </p:column>
                            <p:column headerText="检测值" styleClass="f-right">
                                <h:outputText value="#{entry.value}" />
                            </p:column>
                        </f:facet>
                    </fr:listView>
                </p:tab>
            </p:tabView>

            <p:commandButton id="save-validated" value="保存" actionListener="${bean.save}"
                             onclick="waitbox.show()" oncomplete="waitbox.hide();stepDialog.hide();" />
            <p:commandButton id="cancel" value="关闭" onclick="stepDialog.hide();" />
        </h:form>
    </p:dialog>

    <sem:choosePersonDialog
            id="c_person" header="选择要关联的操作员" target="${bean.operatorsMBean.addition}"
            update=":stepDialogForm:stepEditTab:operatorIndexView:indexForm:body"/>
    <sem:chooseOrgUnitDialog id="c_orgunit" target="#{item.orgUnit}" update=":stepDialogForm:stepEditTab:orgUnit" />

    <fr:listView id="qcResultParaEditView" header="质检结果编辑" style="editDialog"
                 indexView=":stepDialogForm:stepEditTab:qcResultParaIndexView" mbean="#{bean.qcResultParasMBean}">
        <t:panelGrid columns="2">

            <h:outputText value="质检内容:" />
            <h:outputText value="#{item.key.label}" />

            <h:outputText value="标准值:" />
            <h:outputText value="#{item.key.value}" />

            <h:outputText value="标准描述:" />
            <h:outputText value="#{item.key.description}" />

            <h:outputText value="检测值:" />
            <p:inputText value="#{item.value}" label="检测值" />

            <h:outputText value="检测描述:" />
            <p:inputTextarea value="#{item.description}" rows="5" cols="30" label="标准描述" />

        </t:panelGrid>
    </fr:listView>


    <ui:define name="searchPanels.1">
        <ui:insert name="searchPanel.step">
            <p:panel header="按工艺步骤搜索" toggleable="true">
                <div align="center">
                    <p:inputText id="step" readonly="true" value="${bean.searchStep.model.stepName.label}" />
                    <p:commandButton id="chooseStep" value="..." onclick="chooseTaskToSearchDialog.show()" />
                    <p:commandButton id="filterTask" value="限定生产任务" actionListener="${bean.addTaskRestriction}"
                        update="@form, ${_searchUpdates}" />
                </div>
            </p:panel>
        </ui:insert>
    </ui:define>

    <ui:define name="searchSupport.1">
        <sem:chooseMakeTaskDialog id="c_searchTask" var="chooseTaskToSearchDialog" target="${bean.searchTask}"
            update=":searchForm" />
    </ui:define>



</ui:composition>
