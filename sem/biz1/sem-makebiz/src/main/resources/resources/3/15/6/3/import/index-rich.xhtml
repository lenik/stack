<ui:composition template="/template/custom-rich.xhtml" xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:sem="http://java.sun.com/jsf/composite/3/15">

    <ui:param name="title" value="物料导入" />
    <ui:param name="bean" value="${materialBatchImportBean}" />

    <ui:define name="styles">
        <link rel="stylesheet" type="text/css" href="bubble.css" />
    </ui:define>

    <ui:define name="content">

        <div style="background-color:white;overflow-y:auto;">

            <h:form id="mainForm">
                <t:div id="choosetarget">
                    <p:fieldset legend="STEP1:选择销售机会" toggleable="true" toggleSpeed="500">
                        <p:inputText id="chance" value="#{bean.target.subject}" readonly="true" />
                        <p:commandButton value="..." onclick="chooseChanceDialog.show();" />
                    </p:fieldset>
                </t:div>

                <t:div id="uploadView">
                    <p:fieldset legend="STEP2:选择导入文件" toggleable="true" toggleSpeed="500" rendered="#{bean.target != null}">
                        <h:outputText value="已上传文件：" rendered="#{bean.upload}" />
                        <h:outputText value="#{bean.uploadedFileName}" rendered="#{bean.upload}" />
                        <p:fileUpload fileUploadListener="#{bean.handleFileUpload}" mode="advanced"
                            update=":mainForm:analysis, :mainForm:uploadView, :mainForm:import," sizeLimit="100000"
                            allowTypes="/(\.|\/)(csv)$/" />
                    </p:fieldset>
                </t:div>
                <t:div id="analysis">
                    <p:fieldset legend="SETP3:解析文件" toggleable="true" toogleSpeed="500" rendered="#{bean.upload}">
                        <p:commandButton value="开始解析" actionListener="#{bean.doAnalysis}"
                            update=":mainForm:import, :mainForm:analysis" rendered="#{!bean.analysis}" />
                        <t:panelGrid columns="2" rendered="#{bean.analysis}">
                            <h:outputText value="解析得：" />
                            <h:outputText value="" />

                            <h:outputText value="物料 :" />
                            <h:outputText value="#{bean.materialSize}" />

                            <h:outputText value="构件 :" />
                            <h:outputText value="#{bean.compSize}" />

                            <h:outputText value="零件 :" />
                            <h:outputText value="#{bean.partSize}" />
                        </t:panelGrid>
                    </p:fieldset>
                </t:div>
                <t:div id="import">
                    <p:fieldset legend="SETP4:导入数据" toggleable="true" toogleSpeed="500" rendered="#{bean.analysis}">
                        <p:commandButton value="导入数据" actionListener="#{bean.doImport}" update=":mainForm:import"
                            rendered="#{!bean.imported}" onclick="waitbox.show();" oncomplete="waitbox.hide()"/>
                        <t:panelGrid columns="2" rendered="#{bean.imported}">
                            <h:outputText value="导入结果：" />
                            <h:outputText value="" />

                            <h:outputText value="导入物料：" />
                            <h:outputText value="#{bean.saveMaterialCount}" />

                            <h:outputText value="重复物料：" />
                            <h:outputText value="#{bean.existMaterialCount}(未导入)" />

                            <h:outputText value="导入BOM：" />
                            <h:outputText value="#{bean.savePartCount}" />

                            <h:outputText value="导入BOM：" />
                            <h:outputText value="#{bean.existPartCount}(未导入)" />
                        </t:panelGrid>
                    </p:fieldset>
                </t:div>
            </h:form>

            <sem:chooseChanceDialog id="chooseChanceDialog" target="${bean.target}"
                update=":mainForm:chance, :mainForm:uploadView" />

        </div>
    </ui:define>

</ui:composition>
