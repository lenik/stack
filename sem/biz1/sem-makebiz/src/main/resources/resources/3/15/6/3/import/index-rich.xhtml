<ui:composition template="/template/custom-rich.xhtml" xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:sem="http://java.sun.com/jsf/composite/3/15">

    <ui:param name="title" value="物料导入" />
    <ui:param name="bean" value="${materialBatchImportBean}" />

    <ui:define name="styles">
        <link rel="stylesheet" type="text/css" href="bubble.css" />
    </ui:define>

    <ui:define name="content">

        <div style="background-color:white;overflow-y:auto;">

            <h:form id="mainForm">
                <t:div id="choosetarget">
                    <p:fieldset legend="STEP1:选择销售机会" toggleable="true" toggleSpeed="500">
                        <p:inputText id="chance" value="#{bean.target.subject}" readonly="true" />
                        <p:commandButton value="..." onclick="chooseChanceDialog.show();" />
                    </p:fieldset>
                </t:div>

                <t:div id="uploadView">
                    <p:fieldset legend="STEP2:选择导入文件" toggleable="true" toggleSpeed="500" rendered="#{bean.target != null}">
                        <h:outputText value="已上传文件：" rendered="#{bean.upload}" />
                        <h:outputText value="#{bean.uploadedFileName}" rendered="#{bean.upload}" />
                        <p:fileUpload fileUploadListener="#{bean.handleFileUpload}" mode="advanced"
                            update=":mainForm:analysis, :mainForm:uploadView" sizeLimit="100000" allowTypes="/(\.|\/)(csv)$/" />
                    </p:fieldset>
                </t:div>
                <t:div id="analysis">
                    <p:fieldset legend="SETP3:分析文件" toggleable="true" toogleSpeed="500" rendered="#{bean.upload}">
                        <p:commandButton value="开始分析" actionListener="#{bean.doAnalysis}" update=":mainForm:import" />
                    </p:fieldset>
                </t:div>
                <t:div id="import">
                    <p:fieldset legend="SETP4:导入数据" toggleable="true" toogleSpeed="500" rendered="#{bean.analysis}">
                        <p:commandButton value="导入数据" actionListener="#{bean.doImport}" />
                    </p:fieldset>
                </t:div>
            </h:form>
            <sem:chooseChanceDialog id="chooseChanceDialog" target="${bean.target}"
                update=":mainForm:chance, :mainForm:uploadView" />

        </div>
    </ui:define>

</ui:composition>
