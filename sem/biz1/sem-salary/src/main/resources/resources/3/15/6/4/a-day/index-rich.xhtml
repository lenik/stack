<ui:composition template="/template/simple-entity.xhtml" xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:icsf="http://java.sun.com/jsf/composite/3/7"
    xmlns:sem="http://java.sun.com/jsf/composite/3/15" xmlns:pf="http://bee32.com/plover/faces">

    <ui:param name="title" value="每日出勤记录" />
    <ui:param name="bean" value="${attendanceMAdmin}" />
    <ui:param name="obj" value="${bean.openedObject}" />

    <ui:define name="toolbarContexts">
        <p:calendar value="#{bean.openDate}" navigator="true" locale="zh_CN" pattern="yyyy-MM-dd" showOn="button">
            <p:ajax event="dateSelect" listener="#{bean.addDateRestriction}" update=":searchForm:searchFragments, ${_searchUpdates}" />
        </p:calendar>
        <p:separator />
        <p:commandButton value="generator-attendance" oncomplete="batchDialog.show()" actionListener="${bean.inintAttendanceMR}"
            update=":batchForm" />
    </ui:define>

    <ui:define name="dataColumns">
        <p:column headerText="雇员">
            <h:outputText value="${entry.employee.personName}" />
        </p:column>
        <p:column headerText="安全">
            <h:outputText value="${entry.safe == 'true' ? '是' : '否'}" />
        </p:column>
        <p:column headerText="应出勤">
            <h:outputText value="${entry.arguments[0] / 2}" />
        </p:column>
        morning
        <p:column headerText="出勤">
            <h:outputText value="${entry.arguments[1] / 2}" />
        </p:column>
        <p:column headerText="应加班">
            <h:outputText value="${entry.arguments[3]}" />
        </p:column>
        <p:column headerText="加班">
            <h:outputText value="${entry.arguments[4]}" />
        </p:column>
        <p:column headerText="迟到">
            <h:outputText value="${entry.arguments[2]}" />
        </p:column>
    </ui:define>

    <ui:define name="editDialogContent">
        <h:outputText value="under developing" />

    </ui:define>

    <ui:define name="dialogs">
        <p:dialog header="批量生成出勤记录" widgetVar="batchDialog">
            <h:form id="batchForm">
                <p:dataTable value="${bean.attendances}" var="item">
                    <p:column headerText="雇员">
                        <h:outputText value="${item.employee.personName}" />
                    </p:column>

                    <p:column headerText="操作">
                        <p:commandButton id="viewTool" title="查看" icon="ui-icon-search"
                            actionListener="${bean.showEditingAttendance(item)}" oncomplete="singledlg.show();" update=":monthView" />
                    </p:column>

                </p:dataTable>

                <p:commandButton value="保存" actionListener="${bean.saveBatchAttendance}" oncomplete="batchDialog.hide();"/>
                <p:commandButton value="取消"  onclick="batchDialog.hide();"/>
            </h:form>
        </p:dialog>

        <p:dialog header="编辑出勤信息" widgetVar="singledlg">
            <h:form id="monthView">

                <table style="border:1px solid;width:400px;">
                    <tr>
                        <td class="attendance-calenda-table-header">星期天</td>
                        <td class="attendance-calenda-table-header">星期一</td>
                        <td class="attendance-calenda-table-header">星期二</td>
                        <td class="attendance-calenda-table-header">星期三</td>
                        <td class="attendance-calenda-table-header">星期四</td>
                        <td class="attendance-calenda-table-header">星期五</td>
                        <td class="attendance-calenda-table-header">星期六</td>
                    </tr>
                    <ui:repeat var="attendanceList" value="${bean.editingAttendance.monthView}">
                        <tr style="height:20px;">
                            <ui:repeat var="attendance" value="${attendanceList}">
                                <td id="${attendance.day}" class="${attendance.styleClass}">
                                    <a class="a-morning">${attendance.morning.value}</a>
                                    <a class="a-afternoon">${attendance.afternoon.value}</a>
                                    <a class="a-evening">${attendance.evening.value}</a>
                                </td>
                            </ui:repeat>
                        </tr>

                    </ui:repeat>


                </table>

                <table style="width:100%">
                    <tr>
                        <td>时间</td>
                        <td>图标</td>
                        <td>值</td>
                        <td>名称</td>
                        <td>候选项</td>
                    </tr>
                    <tr>
                        <td>上午</td>
                        <td class="a-m-icon"></td>
                        <td class="a-m-value"></td>
                        <td class="a-m-name"></td>
                        <td class="a-m-types">
                            <ui:repeat var="type" value="${bean.attendanceTypes}">
                                <a class="a-m-types-c">${type.value}</a>
                            </ui:repeat>
                        </td>
                    </tr>
                    <tr>
                        <td>下午</td>
                        <td class="a-a-icon"></td>
                        <td class="a-a-value"></td>
                        <td class="a-a-name"></td>
                        <td class="a-a-types">
                            <ui:repeat var="type" value="${bean.attendanceTypes}">
                                <a class="a-a-types-c">${type.value}</a>
                            </ui:repeat>
                        </td>
                    </tr>
                    <tr>
                        <td>晚上</td>
                        <td class="a-e-icon"></td>
                        <td class="a-e-value"></td>
                        <td class="a-e-name"></td>
                        <td class="a-e-types">
                            <ui:repeat var="type" value="${bean.attendanceTypes}">
                                <a class="a-e-types-c">${type.value}</a>
                            </ui:repeat>
                        </td>
                    </tr>
                </table>

                <t:panelGrid columns="4">
                    <h:outputText value="雇员:" />
                    <h:outputText value="${bean.editingAttendance.employee.personName}" />

                    <h:outputText value="安全月:" />
                    <p:selectBooleanCheckbox value="${bean.editingAttendance.safe}" />
                </t:panelGrid>

                <h:inputHidden id="editingAttendanceData" value="${bean.editingAttendance.attendanceData}" />

                <table>
                    <ui:repeat var="type" value="${bean.attendanceTypes}">
                        <tr class="a-types">
                            <td class="a-types-icon-td">
                                <a class="a-types-icon">
                                    ${type.iconSting}
                                </a>
                            </td>
                            <td class="a-types-value-td">
                                <a class="a-types-value">
                                    ${type.value}
                                </a>
                            </td>
                            <td class="a-types-name-td">
                                <a class="a-types-name">
                                    ${type.name}
                                </a>
                            </td>
                        </tr>
                    </ui:repeat>
                </table>

                <p:commandButton value="确定" actionListener="${bean.test}" oncomplete="singledlg.hide();"
                    update=":batchForm" />
                <p:commandButton value="取消" onclick="singledlg.hide();" />

                <script type="text/javascript" src="./jshashtable-2.1.js"></script>
                <script language="javascript" src="./attendance.js"></script>
                <script language="javascript" type="text/javascript">
                    $(".calendarView-available").each(function(){
                    });
                </script>
            </h:form>
        </p:dialog>

    </ui:define>


    <ui:define name="styles">
        <link rel="stylesheet" type="text/css" href="./attendance.css" />
    </ui:define>


</ui:composition>