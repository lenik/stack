<ui:composition template="/template/simple-entity.xhtml" xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:icsf="http://java.sun.com/jsf/composite/3/7"
    xmlns:sem="http://java.sun.com/jsf/composite/3/15">

    <ui:param name="title" value="工资管理" />
    <ui:param name="bean" value="${salaryAdmin}" />
    <ui:param name="obj" value="${bean.openedObject}" />

    <ui:define name="toolbar.left" />

    <ui:define name="toolbarContexts">
        <t:panelGrid>
            <p:calendar value="#{bean.targetDate}" navigator="true" locale="zh_CN" pattern="yyyy-MM-dd"
                showOn="button">
                <p:ajax event="dateSelect" listener="#{bean.addDateRestriction}" update=":searchForm:searchFragments, ${_searchUpdates}" />
            </p:calendar>
        </t:panelGrid>
    </ui:define>

    <ui:define name="dataColumns">
        <p:column headerText="时间">
            <h:outputText value="${entry.dateString}" />
        </p:column>
        <p:column headerText="员工">
            <h:outputText value="${entry.employee.person.name}" />
        </p:column>
        <p:column headerText="工资（合计）">
            <h:outputText value="${entry.total}" />
        </p:column>
    </ui:define>

    <ui:define name="editDialogContent">
        <p:panel header="工资明细">
            <table>
                <ui:repeat var="element" value="${obj.elements}" varStatus="status">
                    <tr>
                        <td>
                            <h:outputText value="${element.def.category}" />
                        </td>
                        <td>
                            <p:inputText value="${element.bonus}" />
                        </td>
                        <td>
                            <p:commandButton value="修改" oncomplete="edialog.show()" update=":elementDialog">
                                <f:setPropertyActionListener value="${element}" target="${bean.selectedElement}" />
                            </p:commandButton>
                        </td>
                    </tr>
                </ui:repeat>

                <tr>
                    <td>
                        <h:outputText value="总计" />
                    </td>
                    <td>
                        <h:outputText value="${obj.total}" />
                    </td>
                </tr>
            </table>

        </p:panel>
    </ui:define>

    <ui:define name="dialogs">
        <p:dialog id="elementDialog" header="${bean.selectedElement.def.category}" widgetVar="edialog">
            <t:panelGrid columns="2">
                <h:outputText value="${bean.selectedElement.def.category}" />
                <p:inputText value="${bean.selectedElement.bonus}" />
                <p:commandButton value="确定" />
                <p:commandButton value="取消" />
            </t:panelGrid>
        </p:dialog>
    </ui:define>
</ui:composition>
