<ui:composition template="/template/simple-entity.xhtml" xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:icsf="http://java.sun.com/jsf/composite/3/7"
    xmlns:sem="http://java.sun.com/jsf/composite/3/15" xmlns:fr="http://java.sun.com/jsf/composite/frame" xmlns:pf="http://bee32.com/plover/faces">

    <ui:param name="title" value="工资元素定义" />
    <ui:param name="bean" value="${salaryDefAdminBean}" />
    <ui:param name="obj" value="${bean.openedObject}" />

    <ui:define name="toolbarContexts">
        <p:commandButton value="生成工资" onclick="generateSalaryDialog.show();" />
    </ui:define>

    <ui:define name="dataColumns">
        <p:column headerText="启用时间">
            <h:outputText value="${entry.beginTime}" />
        </p:column>
        <p:column headerText="失效时间">
            <h:outputText value="${entry.endTime}" />
        </p:column>
        <p:column headerText="分类">
            <h:outputText value="${entry.category}" />
        </p:column>
        <p:column headerText="名称">
            <h:outputText value="${entry.label}" />
        </p:column>
        <p:column headerText="表达式">
            <h:outputText value="${entry.expr}" />
        </p:column>
    </ui:define>

    <ui:define name="editDialogBody">
        <!-- TODO: fr:disable applied=${not plainEditForm} -->
        <h:form id="form" styleClass="${(plainEditForm and bean.editing) ? 'form-editing' : ''}">
            <h:panelGroup rendered="${bean.openedObject == null}">
                （请选择要操作的对象。）
            </h:panelGroup>
            <h:panelGroup rendered="${bean.openedObject != null}">
                <h:panelGroup id="content" layout="block"
                    styleClass="${formStyleClass != null ? formStyleClass : 'ui-dialog-form'}">
                    <pf:locker id="locker" test="${not bean.editing}" layout="block"
                        styleClass="${bean.editing ? '' : 'locker-active'}">
                        <t:panelGrid columns="2">

                            <h:outputText value="启用时间" />
                            <p:calendar value="#{obj.beginTime}" navigator="true" locale="zh_CN" pattern="yyyy-MM-dd"
                                showOn="button" />

                            <h:outputText value="失效时间" />
                            <p:calendar value="#{obj.endTime}" navigator="true" locale="zh_CN" pattern="yyyy-MM-dd"
                                showOn="button" />

                            <h:outputText value="分类" />
                            <p:inputText value="${obj.category}" />

                            <h:outputText value="名称" />
                            <p:inputText value="${obj.label}" />

                            <h:outputText value="表达式" />
                            <t:panelGroup>
                                <p:inputText value="${obj.expr}" />
                                <p:commandButton icon="ui-icon-help" title="表达式提示" onclick="dlg1.show();" />
                            </t:panelGroup>
                        </t:panelGrid>
                    </pf:locker>
                </h:panelGroup>
            </h:panelGroup>
            <!-- Hide edit buttons in plain-edit-form/show-content mode. -->
            <table border="0" width="100%">
                <tr>
                    <td align="left">
                        <h:panelGroup rendered="${bean.openedObject != null and not bean.editing}">
                            <h:panelGroup title="如果要编辑请点击工具栏上的修改按钮。" style="font-size: 120%; color: green">
                                （您正在浏览数据中…）
                            </h:panelGroup>
                        </h:panelGroup>
                        <h:panelGroup rendered="${copyable and (bean.editing or not plainEditForm)}">
                            <p:commandButton id="dup-validated" value="创建副本" actionListener="${bean.saveDup}"
                                disabled="${not bean.editing}" update="${_contentUpdate} ${_indexUpdate} ${mirrorTargets}"
                                rendered="${not plainEditForm}" onclick="waitbox.show()" oncomplete="waitbox.hide(); editdlg.shakeOnFail(args)" />
                        </h:panelGroup>
                        <h:panelGroup rendered="${bean.creating}">
                            <p:selectBooleanCheckbox value="${bean.checkDuplicatesBeforeCreate}" />
                            避免重复
                        </h:panelGroup>
                        <h:panelGroup>
                            <p:commandButton value="预览" actionListener="${bean.getPreviewData}"
                                oncomplete="dlg2.show();" update=":dialogs:preview" />
                        </h:panelGroup>
                    </td>
                    <td align="right">
                        <h:panelGroup rendered="${bean.editing or not plainEditForm}">
                            <p:commandButton id="save-validated" value="保存" actionListener="${bean.save}"
                                disabled="${not bean.editing}" update="${_contentUpdate} ${_indexUpdate} ${mirrorTargets}"
                                onclick="waitbox.show()" oncomplete="waitbox.hide(); ${plainEditForm ? '' : 'editdlg.hideValidated(args)'}" />
                            <p:commandButton id="cancel" value="${bean.editing  ? '取消' : '关闭'}"
                                onclick="waitbox.show(); ${plainEditForm ? '' : 'editdlg.hide()'}" oncomplete="waitbox.hide()"
                                actionListener="${bean.showIndex}" update="${plainEditForm ? _contentUpdate : '@none'}" />
                        </h:panelGroup>
                    </td>
                </tr>
            </table>
        </h:form>
    </ui:define>
    <ui:define name="dialogs">
        <p:dialog header="表达式关键词" widgetVar="dlg1">
            <ui:repeat var="provider" value="${bean.providers}">
                <h:outputText value="${provider.entityType}" />
                <br />
                <ui:repeat var="key" value="${provider.variableNames}">
                    <h:outputText value="${key}" style="color:red" />
                    <br />
                </ui:repeat>
            </ui:repeat>
            <p:commandButton value="关闭" onclick="dlg1.hide();" style="float:right" />
        </p:dialog>

        <p:dialog header="preview" widgetVar="dlg2" modal="true" dynamic="${viewConfig.dynamicDialog}">
            <t:panelGroup id="preview">
                <p:dataTable var="preview" value="#{bean.previewData}">
                    <p:column headerText="雇员">
                        <h:outputText value="${preview.employee.personName}" />
                    </p:column>
                    <p:column headerText="元素工资">
                        <h:outputText value="${preview.previewValue}" />
                    </p:column>
                </p:dataTable>
            </t:panelGroup>
        </p:dialog>

        <p:dialog header="工资生成">
            <h:form>
                <t:panelGrid columns="2">
                    <h:outputText value="选择月份" />
                    <p:calendar value="#{bean.generateDate}" navigator="true" locale="zh_CN" pattern="yyyy-MM-dd"
                        showOn="button" />

                    <p:commandButton value="生成工资" actionListener="${bean.generateSalary}" />
                </t:panelGrid>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
