<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:pc="http://bee32.com/plover/core" xmlns:sem="http://bee32.com/sem/functions"
    xmlns:p="http://primefaces.org/ui" xmlns:t="http://myfaces.apache.org/tomahawk" template="/template/simple-entity.xhtml">

    <ui:param name="title" value="报价单" />
    <ui:param name="bean" value="#{chanceQuotationBean}" />

    <p:dialog header="报价单" widgetVar="quotationDialog" modal="true">
        <h:form id="quotationForm">
            <t:panelGrid columns="3" id="quotationGrid">
                <h:outputText value="标题:" />
                <t:panelGroup colspan="2">
                    <p:inputText id="quotationSubject" value="#{bean.subject}" style="width:300px;" />
                </t:panelGroup>

                <h:outputText value="机会:" />
                <t:panelGroup colspan="2">
                    <p:inputText id="quotationChance" value="#{bean.chance.subject}" style="width:300px;"
                        readonly="true" />
                </t:panelGroup>

                <h:outputText value="明细:" />

                <p:dataTable id="quotationItem" var="item" value="#{bean.items}" style="width:100%;">

                    <p:column headerText="产品" style="width:70px;">
                        <h:outputText value="#{item.material.label}" />
                    </p:column>

                    <p:column headerText="折扣" style="width:80px;">
                        <h:outputText value="#{item.discount}" />
                    </p:column>

                    <p:column headerText="基础价格" style="width:80px;">
                        <h:outputText value="#{item.basePrice.price}" />
                    </p:column>

                    <p:column headerText="单价" style="width:80px;">
                        <h:outputText value="#{item.price}" />
                    </p:column>

                    <p:column headerText="数目" style="width:50px;">
                        <h:outputText value="#{item.quantity}" />
                    </p:column>

                    <p:column headerText="操作" style="width:70px;">
                        <p:commandLink update=":quotationForm:quotationItemDetail" title="编辑"
                            oncomplete="quotationDetail.show();" style="padding:4px;">
                            <p:graphicImage value="#{location.ICON}/etool16/validate.gif" />
                            <f:setPropertyActionListener value="#{item}"
                                target="#{bean.selectedQuotationItem}" />
                        </p:commandLink>
                        <p:commandLink title="删除" onclick="itemConfirmation.show();" style="padding:4px;">
                            <p:graphicImage value="#{location.ICON}/etool16/delete_edit.gif" />
                            <f:setPropertyActionListener value="#{item}"
                                target="#{bean.selectedQuotationItem}" />
                        </p:commandLink>
                    </p:column>
                </p:dataTable>
                <p:commandButton value="..." title="添加明细" onclick="materialDlg.show();" />

                <h:outputText value="交付说明:" />
                <t:panelGroup colspan="2">
                    <p:inputTextarea id="quotationRecommend" value="#{bean.recommend}" style="width:300px;height:60px;" />
                </t:panelGroup>

                <h:outputText value="付款说明:" />
                <t:panelGroup colspan="2">
                    <p:inputTextarea id="quotationPayment" value="#{bean.payment}" style="width:300px;height:60px;" />
                </t:panelGroup>

                <t:panelGroup colspan="3">
                    <p:commandButton value="保存" actionListener="#{bean.save}" oncomplete="quotationDialog.hide();"
                        update=":chanceForm:mainTab:quotationList, :chanceForm:mainTab:quotationToolbar" />
                    <p:commandButton value="取消" onclick="quotationDialog.hide();" />
                </t:panelGroup>
            </t:panelGrid>
        </h:form>
    </p:dialog>

    <p:dialog header="编辑报价明细" modal="true" widgetVar="quotationDetail" height="300" width="350">
        <h:form>
            <t:panelGrid columns="3" id="quotationItemDetail">
                <h:outputText value="物料:" />
                <t:panelGroup colspan="2">
                    <h:outputText value="#{bean.selectedQuotationItem.material.label}" />
                </t:panelGroup>

                <h:outputText value="基础价格:" />
                <t:panelGroup colspan="2">
                    <h:outputText value="#{bean.selectedQuotationItem.basePrice.price}" />
                </t:panelGroup>

                <h:outputText value="折扣" />
                <t:panelGroup colspan="2">
                    <t:panelGrid columns="3" id="discount">
                        <p:inputText id="inputDiscount" value="#{bean.selectedQuotationItem.discount}" />
                    </t:panelGrid>
                </t:panelGroup>

                <h:outputText value="单价:" />
                <t:panelGroup id="unitPrice" colspan="2">
                    <t:panelGrid columns="3">
                        <p:inputText id="inputPrice" value="#{bean.selectedQuotationItem.viewPrice}" />
                    </t:panelGrid>
                </t:panelGroup>

                <h:outputText value="数量" />
                <t:panelGroup id="quantity" colspan="2">
                    <t:panelGrid columns="3">
                        <p:inputText id="outputQuantity" value="#{bean.selectedQuotationItem.quantity}" />
                    </t:panelGrid>
                </t:panelGroup>

                <t:panelGroup colspan="3">
                    <p:commandButton value="确定" actionListener="#{bean.editQuotationItem}" oncomplete="quotationDetail.hide();"
                        update=":quotationForm:quotationItem" />
                    <p:commandButton value="取消" actionListener="#{bean.uneditQuotationItem}" oncomplete="quotationDetail.hide();" />
                </t:panelGroup>
            </t:panelGrid>
        </h:form>
    </p:dialog>

</ui:composition>
