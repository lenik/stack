<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:p="http://primefaces.org/ui"
    xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:sem="http://java.sun.com/jsf/composite/3/15" template="/template/simple-entity.xhtml">

    <ui:param name="title" value="机会跟进日志" />
    <ui:param name="bean" value="${chanceActionBean}" />
    <ui:param name="obj" value="${bean.activeObject}" />
    <ui:param name="dicts" value="${chanceDictsBean}" />

    <ui:define name="toolbarPeripherals">
        <sem:singleVerifierSupportButton id="verifyButton" selection="#{bean.selection}" />
    </ui:define>

    <ui:define name="dataColumns">
        <p:column headerText="日期" style="width: 10em;">
            <h:outputText value="${entry.date}" />
        </p:column>
        <p:column headerText="时间段" style="width: 12em;">
            <h:outputText value="${entry.timeRange}" />
        </p:column>
        <p:column headerText="执行" style="width: 6em;">
            <h:outputText value="${entry.actor.displayName}" />
        </p:column>
        <p:column headerText="类型" style="width: 3em;">
            <h:outputText value="${entry.plan ? '计划' : '日至'}" />
        </p:column>
        <p:column headerText="洽谈类型" style="width: 7em;">
            <h:outputText value="${entry.style.label}" />
        </p:column>
        <p:column headerText="行动简略">
            <h:outputText value="${entry.subject}" />
        </p:column>
        <p:column headerText="对应机会">
            <h:outputText value="${entry.chance.subject}" />
        </p:column>
        <p:column headerText="阶段">
            <h:outputText value="${entry.stage.label}" />
        </p:column>
        <p:column headerText="壮态">
            <h:outputText value="${entry.verifyContext.verifyEvalState}" />
        </p:column>
    </ui:define>

    <ui:define name="editDialogContent">
        <t:panelGrid columns="4" columnClasses="detail_col_title, detail_col_value, detail_col_title, detail_col_value">
            <h:outputLabel for="beginTime" value="开始时间:" />
            <p:calendar id="beginTime" pattern="yyyy-MM-dd HH:mm" navigator="${true}" value="${obj.beginTime}"
                showOn="button" />
            <h:outputLabel for="endTime" value="结束时间:" />
            <p:calendar id="endTime" pattern="yyyy-MM-dd HH:mm" navigator="${true}" value="${obj.endTime}"
                showOn="button" />

            <h:outputLabel for="actionStyle" value="日志类型:" />
            <p:selectOneMenu id="actionStyle" value="${obj.plan}" style="width: 3em;">
                <f:selectItem itemLabel="计划" itemValue="${true}" />
                <f:selectItem itemLabel="日志" itemValue="${false}" />
            </p:selectOneMenu>

            <h:outputLabel for="style" value="洽谈方式:" />
            <p:selectOneMenu id="style" value="${obj.style.displayId}" style="width: 10em;">
                <f:selectItems value="${dicts.actionStyles}" var="it" itemLabel="${it.label}" itemValue="${it.id}" />
            </p:selectOneMenu>

            <h:outputLabel for="pgroup" value="拜访客户:" />
            <t:panelGroup colspan="3" id="pgroup">
                <h:panelGrid columns="2">
                    <p:dataList id="partiesList" var="it" value="${obj.parties}" effectSpeed="fast">
                        <p:column>
                            <h:outputText value="${it.displayName}" />
                            <p:commandLink title="删除客户" update="partiesList">
                                <p:collector value="${it}" removeFrom="${obj.parties}" />
                                <p:graphicImage value="${location.ICON}/etool16/delete_edit.gif" />
                            </p:commandLink>
                        </p:column>
                    </p:dataList>
                    <p:commandButton title="挑选拜访客户" value="..." onclick="choosePartyDialog.show();" />
                </h:panelGrid>
            </t:panelGroup>

            <h:outputLabel for="partnerGroup" value="工作伙伴" />
            <t:panelGroup colspan="3" id="partnerGroup">
                <h:panelGrid columns="2">
                    <p:dataList id="partnersList" var="it" value="${obj.partners}" effectSpeed="fast">
                        <p:column>
                            <h:outputText value="${it.displayName}" />
                            <p:commandLink title="删除伙伴" update="partnersList">
                                <p:graphicImage value="${location.ICON}/etool16/delete_edit.gif" />
                                <p:collector value="${it}" removeFrom="${obj.partners}" />
                            </p:commandLink>
                        </p:column>
                    </p:dataList>
                    <p:commandButton title="挑选工作伙伴" value="..." onclick="choosePartnerDialog.show();" />
                </h:panelGrid>
            </t:panelGroup>

            <h:outputLabel for="moreInfo" value="内容描述:" />
            <t:panelGroup colspan="3">
                <p:inputTextarea id="moreInfo" value="${obj.moreInfo}" style="width: 40em; height: 5em;" />
            </t:panelGroup>

            <h:outputLabel for="spending" value="花费详细:" />
            <t:panelGroup colspan="3">
                <p:inputTextarea id="spending" value="${obj.spending}" style="width: 40em; height: 5em;" />
            </t:panelGroup>

            <h:outputLabel for="chanceSubject" value="相关机会:" />
            <t:panelGroup id="correChance" colspan="3">
                <h:inputHidden id="chanceId" value="${obj.chance.id}" />
                <p:inputText id="chanceSubject" readonly="true" value="${obj.chance.subject}" style="width: 30em" />
                <p:commandButton title="挑选机会" value="..." onclick="chooseChanceDialog.show();" />
            </t:panelGroup>

            <h:outputLabel for="stage" value="机会阶段:" />
            <t:panelGroup colspan="3">
                <p:selectOneMenu id="stage" value="${obj.stage.displayId}" style="width: 20em;">
                    <f:selectItem itemLabel="--请选择机会阶段--" itemValue="" />
                    <f:selectItems value="${bean.chanceStages}" />
                </p:selectOneMenu>
            </t:panelGroup>

        </t:panelGrid>
    </ui:define>

    <ui:define name="dialogs">
        <sem:singleVerifierSupportDialog update="chanceActionForm" />
        <sem:chooseChanceDialog id="chooseChanceDialog" target="${obj.chance}" update=":editDialog:form" />
        <sem:choosePartyDialog id="choosePartyDialog" caption="选择客户" target="${bean.selectedParty}"
            actionListener="${bean.addParty}" update=":editDialog:form" />
        <sem:choosePrincipalDialog id="choosePartnerDialog" var="choosePartnerDialog" caption="选择工作伙伴"
            target="${bean.selectedPartner}" actionListener="${bean.addPartner}" update=":editDialog:form" />
    </ui:define>

</ui:composition>
