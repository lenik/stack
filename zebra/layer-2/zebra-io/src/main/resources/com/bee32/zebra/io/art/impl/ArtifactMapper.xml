<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper 
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bee32.zebra.io.art.impl.ArtifactMapper">

    <resultMap id="map1" type="com.bee32.zebra.io.art.Artifact" extends="co.mapUS">
        <result property="skuCode" column="sku" />
        <result property="barCode" column="barcode" />
        <result property="uomProperty" column="uomprop" />
        <result property="decimalDigits" column="digits" />
        <result property="spec" column="spec" />
        <result property="color" column="color" />
        <result property="caution" column="caution" />
        <result property="bbox.dx" column="dx" />
        <result property="bbox.dy" column="dy" />
        <result property="bbox.dz" column="dz" />
        <result property="weight" column="weight" />
        <result property="netWeight" column="netweight" />
        <result property="supplyMethod" column="supply" />
        <result property="supplyDelay" column="supplydelay" />
        <association property="category" javaType="com.bee32.zebra.io.art.ArtifactCategory">
            <id column="cat" />
            <result property="label" column="cat_label" />
        </association>
        <association property="uom" javaType="com.bee32.zebra.io.art.UOM">
            <id column="uom" />
            <result property="label" column="uom_label" />
        </association>
    </resultMap>

    <sql id="select1"><![CDATA[
        select
            a.*,
            artcat.label "cat_label",
            uom.label "uom_label",
            u.label "uid_label",
            g.label "gid_label"
        from art a
            left join artcat on a.cat=artcat.id
            left join uom on a.uom=uom.id
            left join "user" u on a.uid=u.id
            left join "group" g on a.gid=g.id
        ]]>
    </sql>

    <sql id="select2"><![CDATA[
        select
            a.*,
            artcat.label "cat_label",
            uom.label "uom_label",
            u.label "uid_label",
            g.label "gid_label"
        from art a
            left join artcat on a.cat=artcat.id
            left join uom on a.uom=uom.id
            left join "user" u on a.uid=u.id
            left join "group" g on a.gid=g.id
        ]]>
    </sql>

    <select id="all" resultMap="map1">
        <include refid="select1" />
    </select>

    <select id="filter" resultMap="map1">
        <include refid="select1" />
        <where>
            <if test="categoryId != null">and a.cat=#{categoryId}</if>
            <if test="uomId != null">and a.uom=#{uomId}</if>
            <if test="supplyMethod != null">and a.supply=#{supplyMethod}</if>
            <if test="noCategory">and a.cat is null</if>
            <if test="noSupplyMethod">and a.supply is null</if>
        </where>
    </select>

    <select id="select" parameterType="int" resultMap="map1">
        <include refid="select2" />
        <where>
            <if test="_parameter != null">a.id=#{id}</if>
        </where>
    </select>

    <select id="insert" resultType="long">
        <![CDATA[
        insert into art(code, label, description)
            values(#{codeName},#{label},#{description})
            returning id
    ]]></select>

    <update id="update">
        update art
        <set>
            <include refid="co.setUS" />
        </set>
        <where>
            <if test="id != null">id=#{id}, </if>
        </where>
    </update>

    <delete id="delete">
        delete from art where id=#{id}
    </delete>

    <select id="count" resultType="hashmap">
        select * from v_art_n
    </select>

</mapper>
